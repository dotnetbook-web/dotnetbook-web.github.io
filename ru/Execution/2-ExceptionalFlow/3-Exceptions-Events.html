<!DOCTYPE html>
<html lang="ru">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>.NET Platform Architecture</title>
</head>
<body>
    <script src="../../../ru/res/jquery.js"></script>
    <link rel="stylesheet" href="../../../ru/res/bootstrap.css">
    <link rel="stylesheet" href="../../../ru/res/awesome.css">
    <link rel="stylesheet" href="../../../ru/res/default.css">
   
    <header class="header fixed d-block d-lg-none">
        <p class="conflogo">KB</p> 

        <!-- mobile-menu -->

        <div class="hamburger-menu">
            <input id="menu__toggle" type="checkbox" />
            <label class="menu__btn" for="menu__toggle">
              <span></span>
            </label>
        
            <div class="menu__box">
                <p class="menu__header_current">На странице</p>
                <ol class="menu__list">
                    <li><a href="#appdomain.firstchanceexception" onclick="$('#menu__toggle').click(); return true;">
AppDomain.FirstChanceException</a></li>
<li><a href="#appdomain.unhandledexception" onclick="$('#menu__toggle').click(); return true;">
AppDomain.UnhandledException</a></li>

                </ol>
                <p class="menu__header_total">Содержание</p>
                <ul class="menu__header_list">
                    <li>
                        <p class="menu__header_total_sub">
                            Управление памятью
                        </p>
                        <p class="menu__header_total_sub2">
                            Теоретические вопросы:
                        </p>
                        <ol class="menu__list">
                            <li><p><a href="../../../ruru/Memory/01-00-MemoryManagement-Intro.html">
                                Общие слова
                            </a></p></li>
                            <li>
                                <p>
                                <a href="../../../ruru/Memory/01-02-MemoryManagement-Basics.html">Введение в управление памятью</a></p>
                            </li>
                            <li>
                                <p>
                                <a href="../../../ruru/Memory/01-04-MemoryManagement-ThreadStack.html">Стек потока</a></p>
                            </li>
                            <li>
                                <p>
                                <a href="../../../ruru/Memory/01-06-MemoryManagement-EntitiesLifetime.html">Время жизни сущности</a></p>
                            </li>
                            <li>
                                <p>
                                <a href="../../../ruru/Memory/01-08-MemoryManagement-RefVsValueTypes.html">RefTypes, ValueTypes, Boxing &amp; Unboxing</a></p>
                            </li>
                            <li>
                                <p>
                                <a href="../../../ruru/Memory/01-10-MemoryManagement-IDisposable.html">Шаблон IDisposable</a></p>
                            </li>
                            <li>
                                <p>
                                <a href="../../../ruru/Memory/01-12-MemoryManagement-Finalizer.html">Финализация</a></p>
                            </li>
                            <li>
                                <p>
                                <a href="../../../ruru/Memory/01-14-MemoryManagement-Results.html">Выводы</a></p>
                            </li>
                        </ol>
                        <p class="menu__header_total_sub2">
                            Практические вопросы:
                        </p>
                        <ol class="menu__list" start="9">
                            <li><p><a href="../../../ruru/Memory/02-02-MemoryManagement-MemorySpan.html">
                                Memory&lt;T&gt;, Span&lt;T&gt;
                            </a></p></li>
                        </ol> 
                    </li>
                    <li>
                        <p class="menu__header_total_sub">
                            Поток исполнения команд
                        </p>
                        <p class="menu__header_total_sub2">
                            Многопоточность:
                        </p>
                        <ol class="menu__list">
                            <li><p><a href="../../../ruru/Execution/1-Threads/1-OS/1-threadsScheduling.html">
                                Потоки и планирование потоков
                            </a></p></li>
                        </ol>
                        <p class="menu__header_total_sub2">
                            Искл­юч­ител­ьные си­ту­а­ции:
                        </p>
                        <ol class="menu__list" start="2">
                            <li><p><a href="../../../ruru/Execution/2-ExceptionalFlow/1-Exceptions-Intro.html">
                                Введение в исключительные ситуации
                            </a></p></li>
                            <li><p><a href="../../../ruru/Execution/2-ExceptionalFlow/2-Exceptions-Architecture.html">
                                Архитектура исключительной ситуации
                            </a></p></li>
                            <li><p><a href="../../../ruru/Execution/2-ExceptionalFlow/3-Exceptions-Events.html">
                                События об исключительных ситуациях
                            </a></p></li>
                            <li><p><a href="../../../ruru/Execution/2-ExceptionalFlow/4-Exceptions-Types.html">
                                Виды исключительных ситуаций
                            </a></p></li>
                        </ol>
                    </li>
                </ul>
            </div>
        </div>
    </header>

    <div class="book-container">
        <div class="article-container">
            <!--<p class="d-xs-block d-sm-none">XS</p>
            <p class="d-none d-xs-block d-sm-none">SM</p>
            <p class="d-none d-sm-block d-md-none">MD</p>
            <p class="d-none d-lg-block d-xl-none">LG</p>
            <p class="d-none d-xl-block">XL</p> -->
            <h2 id="section">Со&shy;бы&shy;тия<span class="spacer"> </span>об<span class="spacer"> </span>ис&shy;клю&shy;чит&shy;ель&shy;ных<span class="spacer"> </span>си&shy;ту&shy;а&shy;ци&shy;ях</h2>
<blockquote>
<p><a href="https://github.com/sidristij/dotnetbook/issues/51">Ссыл&shy;ка<span class="spacer"> </span>на<span class="spacer"> </span>об&shy;суж&shy;де&shy;ние</a></p>
</blockquote>
<div class="paragraph-container">
<div class="paragraph-left-side">01</div>
<p>В<span class="spacer"> </span>об&shy;щем<span class="spacer"> </span>слу&shy;чае<span class="spacer"> </span>мы<span class="spacer"> </span>не<span class="spacer"> </span>всег&shy;да<span class="spacer"> </span>зна&shy;ем<span class="spacer"> </span>о<span class="spacer"> </span>тех<span class="spacer"> </span>ис&shy;клю&shy;че&shy;ни&shy;ях,<span class="spacer"> </span>ко&shy;то&shy;рые<span class="spacer"> </span>про&shy;и&shy;зой&shy;дут<span class="spacer"> </span>в<span class="spacer"> </span>на&shy;ших<span class="spacer"> </span>прог&shy;рам&shy;мах<span class="spacer"> </span>по&shy;то&shy;му<span class="spacer"> </span>что<span class="spacer"> </span>прак&shy;тич&shy;ес&shy;ки<span class="spacer"> </span>всег&shy;да<span class="spacer"> </span>мы<span class="spacer"> </span>ис&shy;поль&shy;зу&shy;ем<span class="spacer"> </span>что-то,<span class="spacer"> </span>что<span class="spacer"> </span>на&shy;пи&shy;са&shy;но<span class="spacer"> </span>дру&shy;ги&shy;ми<span class="spacer"> </span>людь&shy;ми<span class="spacer"> </span>и<span class="spacer"> </span>что<span class="spacer"> </span>на&shy;ход&shy;ит&shy;ся<span class="spacer"> </span>в<span class="spacer"> </span>дру&shy;гих<span class="spacer"> </span>под&shy;сис&shy;те&shy;мах<span class="spacer"> </span>и<span class="spacer"> </span>биб&shy;ли&shy;о&shy;те&shy;ках.<span class="spacer"> </span>Ма&shy;ло<span class="spacer"> </span>то&shy;го<span class="spacer"> </span>что<span class="spacer"> </span>воз&shy;мож&shy;ны<span class="spacer"> </span>са&shy;мые<span class="spacer"> </span>раз&shy;ные<span class="spacer"> </span>си&shy;ту&shy;а&shy;ции<span class="spacer"> </span>в<span class="spacer"> </span>ва&shy;шем<span class="spacer"> </span>собст&shy;венном<span class="spacer"> </span>ко&shy;де,<span class="spacer"> </span>в<span class="spacer"> </span>ко&shy;де<span class="spacer"> </span>дру&shy;гих<span class="spacer"> </span>биб&shy;ли&shy;о&shy;тек,<span class="spacer"> </span>так<span class="spacer"> </span>ещё<span class="spacer"> </span>и<span class="spacer"> </span>сущ&shy;ес&shy;тву&shy;ет<span class="spacer"> </span>мно&shy;жес&shy;т&shy;во<span class="spacer"> </span>проб&shy;лем,<span class="spacer"> </span>свя&shy;зан&shy;ных<span class="spacer"> </span>с<span class="spacer"> </span>ис&shy;пол&shy;не&shy;ни&shy;ем<span class="spacer"> </span>ко&shy;да<span class="spacer"> </span>в<span class="spacer"> </span>изо&shy;ли&shy;ров&shy;ан&shy;ных<span class="spacer"> </span>до&shy;ме&shy;нах.<span class="spacer"> </span>И<span class="spacer"> </span>как<span class="spacer"> </span>раз<span class="spacer"> </span>в<span class="spacer"> </span>этом<span class="spacer"> </span>слу&shy;чае<span class="spacer"> </span>бы&shy;ло<span class="spacer"> </span>бы<span class="spacer"> </span>край&shy;не<span class="spacer"> </span>пол&shy;ез&shy;но<span class="spacer"> </span>уметь<span class="spacer"> </span>по&shy;лу&shy;чать<span class="spacer"> </span>дан&shy;ные<span class="spacer"> </span>о<span class="spacer"> </span>ра&shy;бо&shy;те<span class="spacer"> </span>изо&shy;ли&shy;ров&shy;ан&shy;ного<span class="spacer"> </span>ко&shy;да.<span class="spacer"> </span>Ведь<span class="spacer"> </span>впол&shy;не<span class="spacer"> </span>ре&shy;аль&shy;ной<span class="spacer"> </span>мо&shy;жет<span class="spacer"> </span>быть<span class="spacer"> </span>си&shy;ту&shy;а&shy;ция,<span class="spacer"> </span>ког&shy;да<span class="spacer"> </span>сто&shy;рон&shy;ний<span class="spacer"> </span>код<span class="spacer"> </span>пер&shy;ех&shy;ва&shy;ты&shy;ва&shy;ет<span class="spacer"> </span>все<span class="spacer"> </span>без<span class="spacer"> </span>ис&shy;клю&shy;че&shy;ния<span class="spacer"> </span>ошибки,<span class="spacer"> </span>заг&shy;лу&shy;шив<span class="spacer"> </span>их<span class="spacer"> </span><code>fault</code><span class="spacer"> </span>бло&shy;ком:</p>
<div class="paragraph-right-side">01</div>
</div>
<div class="lang-csharp editor-colors"><div style="color:Black;background-color:White;"><pre>
    <span style="color:Blue;">try</span> {
        <span style="color:Green;">// ...</span>
    } <span style="color:Blue;">catch</span> {
        <span style="color:Green;">// do nothing, just to make code call safer</span>
    }
</pre></div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">02</div>
<p>В<span class="spacer"> </span>та&shy;кой<span class="spacer"> </span>си&shy;ту&shy;а&shy;ции<span class="spacer"> </span>мо&shy;жет<span class="spacer"> </span>оказ&shy;аться,<span class="spacer"> </span>что<span class="spacer"> </span>вып&shy;ол&shy;не&shy;ние<span class="spacer"> </span>ко&shy;да<span class="spacer"> </span>уже<span class="spacer"> </span>не<span class="spacer"> </span>так<span class="spacer"> </span>бе&shy;зоп&shy;ас&shy;но<span class="spacer"> </span>как<span class="spacer"> </span>выг&shy;ля&shy;дит,<span class="spacer"> </span>но<span class="spacer"> </span>со&shy;об&shy;ще&shy;ний<span class="spacer"> </span>о<span class="spacer"> </span>том,<span class="spacer"> </span>что<span class="spacer"> </span>про&shy;и&shy;зош&shy;ли<span class="spacer"> </span>ка&shy;кие-то<span class="spacer"> </span>проб&shy;ле&shy;мы<span class="spacer"> </span>мы<span class="spacer"> </span>не<span class="spacer"> </span>имеем.<span class="spacer"> </span>Вто&shy;рой<span class="spacer"> </span>ва&shy;ри&shy;ант<span class="spacer"> </span> &mdash; <span class="spacer"> </span>ког&shy;да<span class="spacer"> </span>при&shy;ло&shy;же&shy;ние<span class="spacer"> </span>глу&shy;шит<span class="spacer"> </span>не&shy;ко&shy;то&shy;рое,<span class="spacer"> </span>пусть<span class="spacer"> </span>да&shy;же<span class="spacer"> </span>лег&shy;аль&shy;ное,<span class="spacer"> </span>ис&shy;клю&shy;че&shy;ние.<span class="spacer"> </span>А<span class="spacer"> </span>рез&shy;уль&shy;тат<span class="spacer"> </span> &mdash; <span class="spacer"> </span>сле&shy;ду&shy;ю&shy;щее<span class="spacer"> </span>ис&shy;клю&shy;че&shy;ние<span class="spacer"> </span>в<span class="spacer"> </span>слу&shy;чай&shy;ном<span class="spacer"> </span>мес&shy;те<span class="spacer"> </span>вы&shy;зо&shy;вет<span class="spacer"> </span>па&shy;де&shy;ние<span class="spacer"> </span>при&shy;ло&shy;же&shy;ния<span class="spacer"> </span>в<span class="spacer"> </span>не&shy;ко&shy;то&shy;ром<span class="spacer"> </span>бу&shy;ду&shy;щем<span class="spacer"> </span>от<span class="spacer"> </span>слу&shy;чай&shy;ной,<span class="spacer"> </span>ка&shy;за&shy;лось<span class="spacer"> </span>бы,<span class="spacer"> </span>ошибки.<span class="spacer"> </span>Тут<span class="spacer"> </span>хо&shy;те&shy;лось<span class="spacer"> </span>бы<span class="spacer"> </span>иметь<span class="spacer"> </span>предс&shy;тав&shy;ле&shy;ние,<span class="spacer"> </span>ка&shy;кая<span class="spacer"> </span>бы&shy;ла<span class="spacer"> </span>пре&shy;дыс&shy;то&shy;рия<span class="spacer"> </span>этой<span class="spacer"> </span>ошибки.<span class="spacer"> </span>Ка&shy;ков<span class="spacer"> </span>ход<span class="spacer"> </span>со&shy;бы&shy;тий<span class="spacer"> </span>привёл<span class="spacer"> </span>к<span class="spacer"> </span>та&shy;кой<span class="spacer"> </span>си&shy;ту&shy;а&shy;ции.<span class="spacer"> </span>И<span class="spacer"> </span>один<span class="spacer"> </span>из<span class="spacer"> </span>спо&shy;со&shy;бов<span class="spacer"> </span>сде&shy;лать<span class="spacer"> </span>это<span class="spacer"> </span>воз&shy;мож&shy;ным<span class="spacer"> </span> &mdash; <span class="spacer"> </span>ис&shy;поль&shy;зо&shy;вать<span class="spacer"> </span>доп&shy;ол&shy;нит&shy;ель&shy;ные<span class="spacer"> </span>со&shy;бы&shy;тия,<span class="spacer"> </span>ко&shy;то&shy;рые<span class="spacer"> </span>от&shy;нос&shy;ят&shy;ся<span class="spacer"> </span>к<span class="spacer"> </span>ис&shy;клю&shy;чит&shy;ель&shy;ным<span class="spacer"> </span>си&shy;ту&shy;а&shy;ци&shy;ям:<span class="spacer"> </span><code>App&shy;Domain&shy;.First&shy;Chance&shy;Exception</code><span class="spacer"> </span>и<span class="spacer"> </span><code>App&shy;Domain&shy;.Unhandled&shy;Exception</code>.</p>
<div class="paragraph-right-side">02</div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">03</div>
<p>Фак&shy;тич&shy;ес&shy;ки,<span class="spacer"> </span>ког&shy;да<span class="spacer"> </span>вы<span class="spacer"> </span>&laquo;бро&shy;са&shy;е&shy;те<span class="spacer"> </span>ис&shy;клю&shy;че&shy;ние&raquo;,<span class="spacer"> </span>то<span class="spacer"> </span>вы&shy;зы&shy;ва&shy;ет&shy;ся<span class="spacer"> </span>обыч&shy;ный<span class="spacer"> </span>ме&shy;тод<span class="spacer"> </span>не&shy;ко&shy;то&shy;рой<span class="spacer"> </span>внут&shy;рен&shy;ней<span class="spacer"> </span>под&shy;сис&shy;те&shy;мы<span class="spacer"> </span><code>Throw</code>,<span class="spacer"> </span>ко&shy;то&shy;рый<span class="spacer"> </span>внут&shy;ри<span class="spacer"> </span>се&shy;бя<span class="spacer"> </span>про&shy;де&shy;лы&shy;ва&shy;ет<span class="spacer"> </span>сле&shy;ду&shy;ю&shy;щие<span class="spacer"> </span>опе&shy;ра&shy;ции:</p>
<div class="paragraph-right-side">03</div>
</div>
<ul>
<li>Вы&shy;зы&shy;ва&shy;ет<span class="spacer"> </span><code>App&shy;Domain&shy;.First&shy;Chance&shy;Exception</code></li>
<li>Ищет<span class="spacer"> </span>в<span class="spacer"> </span>цеп&shy;оч&shy;ке<span class="spacer"> </span>об&shy;раб&shy;от&shy;чи&shy;ков<span class="spacer"> </span>под&shy;хо&shy;дя&shy;щий<span class="spacer"> </span>по<span class="spacer"> </span>филь&shy;т&shy;рам</li>
<li>Вы&shy;зы&shy;ва&shy;ет<span class="spacer"> </span>об&shy;раб&shy;от&shy;чик,<span class="spacer"> </span>пред&shy;ва&shy;рит&shy;ель&shy;но<span class="spacer"> </span>от&shy;ка&shy;тив<span class="spacer"> </span>стек<span class="spacer"> </span>на<span class="spacer"> </span>нуж&shy;ный<span class="spacer"> </span>кадр</li>
<li>Если<span class="spacer"> </span>об&shy;раб&shy;от&shy;чик<span class="spacer"> </span>най&shy;ден<span class="spacer"> </span>не<span class="spacer"> </span>был,<span class="spacer"> </span>вы&shy;зы&shy;ва&shy;ет&shy;ся<span class="spacer"> </span><code>App&shy;Domain&shy;.Unhandled&shy;Exception</code>,<span class="spacer"> </span>об&shy;ру&shy;ши&shy;вая<span class="spacer"> </span>по&shy;ток,<span class="spacer"> </span>в<span class="spacer"> </span>ко&shy;то&shy;ром<span class="spacer"> </span>про&shy;и&shy;зош&shy;ло<span class="spacer"> </span>ис&shy;клю&shy;че&shy;ние.</li>
</ul>
<div class="paragraph-container">
<div class="paragraph-left-side">04</div>
<p>Сра&shy;зу<span class="spacer"> </span>сле&shy;ду&shy;ет<span class="spacer"> </span>ого&shy;вор&shy;иться,<span class="spacer"> </span>от&shy;ве&shy;тив<span class="spacer"> </span>на<span class="spacer"> </span>му&shy;ча&shy;ю&shy;щий<span class="spacer"> </span>мно&shy;гие<span class="spacer"> </span>умы<span class="spacer"> </span>воп&shy;рос:<span class="spacer"> </span>есть<span class="spacer"> </span>ли<span class="spacer"> </span>воз&shy;мож&shy;ность<span class="spacer"> </span>как-то<span class="spacer"> </span>от&shy;ме&shy;нить<span class="spacer"> </span>ис&shy;клю&shy;че&shy;ние,<span class="spacer"> </span>воз&shy;ник&shy;шее<span class="spacer"> </span>в<span class="spacer"> </span>нек&shy;он&shy;тро&shy;ли&shy;ру&shy;е&shy;мом<span class="spacer"> </span>ко&shy;де,<span class="spacer"> </span>ко&shy;то&shy;рый<span class="spacer"> </span>ис&shy;пол&shy;ня&shy;ет&shy;ся<span class="spacer"> </span>в<span class="spacer"> </span>изо&shy;ли&shy;ров&shy;ан&shy;ном<span class="spacer"> </span>до&shy;ме&shy;не,<span class="spacer"> </span>не<span class="spacer"> </span>об&shy;ру&shy;ши&shy;вая<span class="spacer"> </span>тем<span class="spacer"> </span>са&shy;мым<span class="spacer"> </span>по&shy;ток,<span class="spacer"> </span>в<span class="spacer"> </span>ко&shy;то&shy;ром<span class="spacer"> </span>это<span class="spacer"> </span>ис&shy;клю&shy;че&shy;ние<span class="spacer"> </span>бы&shy;ло<span class="spacer"> </span>выб&shy;ро&shy;ше&shy;но?<span class="spacer"> </span>Ответ<span class="spacer"> </span>ла&shy;ко&shy;ни&shy;чен<span class="spacer"> </span>и<span class="spacer"> </span>прост:<span class="spacer"> </span>нет.<span class="spacer"> </span>Если<span class="spacer"> </span>ис&shy;клю&shy;че&shy;ние<span class="spacer"> </span>не<span class="spacer"> </span>пер&shy;ех&shy;ва&shy;ты&shy;ва&shy;ет&shy;ся<span class="spacer"> </span>на<span class="spacer"> </span>всем<span class="spacer"> </span>ди&shy;а&shy;па&shy;зо&shy;не<span class="spacer"> </span>выз&shy;ван&shy;ных<span class="spacer"> </span>ме&shy;то&shy;дов,<span class="spacer"> </span>оно<span class="spacer"> </span>не<span class="spacer"> </span>мо&shy;жет<span class="spacer"> </span>быть<span class="spacer"> </span>об&shy;ра&shy;бо&shy;та&shy;но<span class="spacer"> </span>в<span class="spacer"> </span>прин&shy;ци&shy;пе.<span class="spacer"> </span>Ина&shy;че<span class="spacer"> </span>воз&shy;ни&shy;ка&shy;ет<span class="spacer"> </span>стран&shy;ная<span class="spacer"> </span>си&shy;ту&shy;а&shy;ция:<span class="spacer"> </span>ес&shy;ли<span class="spacer"> </span>мы<span class="spacer"> </span>при<span class="spacer"> </span>по&shy;мо&shy;щи<span class="spacer"> </span><code>App&shy;Domain&shy;.First&shy;Chance&shy;Exception</code><span class="spacer"> </span>об&shy;ра&shy;ба&shy;ты&shy;ва&shy;ем<span class="spacer"> </span>(не&shy;кий<span class="spacer"> </span>син&shy;те&shy;тич&shy;ес&shy;кий<span class="spacer"> </span><code>catch</code>)<span class="spacer"> </span>ис&shy;клю&shy;че&shy;ние,<span class="spacer"> </span>то<span class="spacer"> </span>на<span class="spacer"> </span>ка&shy;кой<span class="spacer"> </span>кадр<span class="spacer"> </span>дол&shy;жен<span class="spacer"> </span>от&shy;кат&shy;ить&shy;ся<span class="spacer"> </span>стек<span class="spacer"> </span>по&shy;то&shy;ка?<span class="spacer"> </span>Как<span class="spacer"> </span>это<span class="spacer"> </span>за&shy;дать<span class="spacer"> </span>в<span class="spacer"> </span>рам&shy;ках<span class="spacer"> </span>пра&shy;вил<span class="spacer"> </span>.NET<span class="spacer"> </span>CLR?<span class="spacer"> </span>Ни&shy;как.<span class="spacer"> </span>Это<span class="spacer"> </span>прос&shy;то<span class="spacer"> </span>не<span class="spacer"> </span>воз&shy;мож&shy;но.<span class="spacer"> </span>Един&shy;ствен&shy;ное<span class="spacer"> </span>что<span class="spacer"> </span>мы<span class="spacer"> </span>мо&shy;жем<span class="spacer"> </span>сде&shy;лать<span class="spacer"> </span> &mdash; <span class="spacer"> </span>зап&shy;ро&shy;то&shy;ко&shy;ли&shy;ро&shy;вать<span class="spacer"> </span>по&shy;луч&shy;ен&shy;ную<span class="spacer"> </span>ин&shy;фор&shy;ма&shy;цию<span class="spacer"> </span>для<span class="spacer"> </span>бу&shy;ду&shy;щих<span class="spacer"> </span>ис&shy;сле&shy;до&shy;ва&shy;ний.</p>
<div class="paragraph-right-side">04</div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">05</div>
<p>Вто&shy;рое,<span class="spacer"> </span>о<span class="spacer"> </span>чем<span class="spacer"> </span>сле&shy;ду&shy;ет<span class="spacer"> </span>расс&shy;ка&shy;зать<span class="spacer"> </span>&laquo;на<span class="spacer"> </span>бе&shy;ре&shy;гу&raquo;<span class="spacer"> </span> &mdash; <span class="spacer"> </span>это<span class="spacer"> </span>по&shy;че&shy;му<span class="spacer"> </span>эти<span class="spacer"> </span>со&shy;бы&shy;тия<span class="spacer"> </span>вве&shy;де&shy;ны<span class="spacer"> </span>не<span class="spacer"> </span>у<span class="spacer"> </span><code>Thread</code>,<span class="spacer"> </span>а<span class="spacer"> </span>у<span class="spacer"> </span><code>App&shy;Domain</code>.<span class="spacer"> </span>Ведь<span class="spacer"> </span>ес&shy;ли<span class="spacer"> </span>сле&shy;до&shy;вать<span class="spacer"> </span>ло&shy;ги&shy;ке,<span class="spacer"> </span>ис&shy;клю&shy;че&shy;ния<span class="spacer"> </span>воз&shy;ни&shy;ка&shy;ют<span class="spacer"> </span>где?<span class="spacer"> </span>В<span class="spacer"> </span>по&shy;то&shy;ке<span class="spacer"> </span>ис&shy;пол&shy;не&shy;ния<span class="spacer"> </span>ком&shy;анд.<span class="spacer"> </span>Т.е.<span class="spacer"> </span>фак&shy;тич&shy;ес&shy;ки<span class="spacer"> </span>у<span class="spacer"> </span><code>Thread</code>.<span class="spacer"> </span>Так<span class="spacer"> </span>по&shy;че&shy;му<span class="spacer"> </span>же<span class="spacer"> </span>проб&shy;ле&shy;мы<span class="spacer"> </span>воз&shy;ни&shy;ка&shy;ют<span class="spacer"> </span>у<span class="spacer"> </span>до&shy;ме&shy;на?<span class="spacer"> </span>Ответ<span class="spacer"> </span>очень<span class="spacer"> </span>прост:<span class="spacer"> </span>для<span class="spacer"> </span>ка&shy;ких<span class="spacer"> </span>си&shy;ту&shy;а&shy;ций<span class="spacer"> </span>соз&shy;да&shy;ва&shy;лись<span class="spacer"> </span><code>App&shy;Domain&shy;.First&shy;Chance&shy;Exception</code><span class="spacer"> </span>и<span class="spacer"> </span><code>App&shy;Domain&shy;.Unhandled&shy;Exception</code>?<span class="spacer"> </span>По&shy;ми&shy;мо<span class="spacer"> </span>все&shy;го<span class="spacer"> </span>про&shy;че&shy;го<span class="spacer"> </span> &mdash; <span class="spacer"> </span>для<span class="spacer"> </span>соз&shy;да&shy;ния<span class="spacer"> </span>пес&shy;оч&shy;ниц<span class="spacer"> </span>для<span class="spacer"> </span>пла&shy;ги&shy;нов.<span class="spacer"> </span>Т.е.<span class="spacer"> </span>для<span class="spacer"> </span>си&shy;ту&shy;а&shy;ций,<span class="spacer"> </span>ког&shy;да<span class="spacer"> </span>есть<span class="spacer"> </span>не&shy;кий<span class="spacer"> </span><code>App&shy;Domain</code>,<span class="spacer"> </span>ко&shy;то&shy;рый<span class="spacer"> </span>нас&shy;тро&shy;ен<span class="spacer"> </span>на<span class="spacer"> </span>Partial&shy;Trust&shy;.<span class="spacer"> </span>Внут&shy;ри<span class="spacer"> </span>этого<span class="spacer"> </span>App&shy;Domain<span class="spacer"> </span>мо&shy;жет<span class="spacer"> </span>про&shy;ис&shy;хо&shy;дить<span class="spacer"> </span>что<span class="spacer"> </span>угодно:<span class="spacer"> </span>там<span class="spacer"> </span>в<span class="spacer"> </span>лю&shy;бой<span class="spacer"> </span>мом&shy;ент<span class="spacer"> </span>мо&shy;гут<span class="spacer"> </span>соз&shy;дав&shy;ать&shy;ся<span class="spacer"> </span>по&shy;то&shy;ки,<span class="spacer"> </span>или<span class="spacer"> </span>ис&shy;поль&shy;зов&shy;ать&shy;ся<span class="spacer"> </span>уже<span class="spacer"> </span>сущ&shy;ес&shy;тву&shy;ю&shy;щие<span class="spacer"> </span>из<span class="spacer"> </span>Thread&shy;Pool&shy;.<span class="spacer"> </span>Тог&shy;да<span class="spacer"> </span>по&shy;лу&shy;ча&shy;ет&shy;ся<span class="spacer"> </span>что<span class="spacer"> </span>мы,<span class="spacer"> </span>бу&shy;ду&shy;чи<span class="spacer"> </span>на&shy;хо&shy;дясь<span class="spacer"> </span>сна&shy;ру&shy;жи<span class="spacer"> </span>от<span class="spacer"> </span>этого<span class="spacer"> </span>про&shy;цес&shy;са<span class="spacer"> </span>(не<span class="spacer"> </span>мы<span class="spacer"> </span>пи&shy;са&shy;ли<span class="spacer"> </span>тот<span class="spacer"> </span>код)<span class="spacer"> </span>не<span class="spacer"> </span>мо&shy;жем<span class="spacer"> </span>ни&shy;как<span class="spacer"> </span>под&shy;пис&shy;ать&shy;ся<span class="spacer"> </span>на<span class="spacer"> </span>со&shy;бы&shy;тия<span class="spacer"> </span>внут&shy;рен&shy;них<span class="spacer"> </span>по&shy;то&shy;ков.<span class="spacer"> </span>Прос&shy;то<span class="spacer"> </span>по&shy;то&shy;му<span class="spacer"> </span>что<span class="spacer"> </span>мы<span class="spacer"> </span>по&shy;ня&shy;тия<span class="spacer"> </span>не<span class="spacer"> </span>имеем<span class="spacer"> </span>что<span class="spacer"> </span>там<span class="spacer"> </span>за<span class="spacer"> </span>по&shy;то&shy;ки<span class="spacer"> </span>бы&shy;ли<span class="spacer"> </span>соз&shy;да&shy;ны.<span class="spacer"> </span>За&shy;то<span class="spacer"> </span>мы<span class="spacer"> </span>гар&shy;ан&shy;ти&shy;ров&shy;ан&shy;но<span class="spacer"> </span>имеем<span class="spacer"> </span><code>App&shy;Domain</code>,<span class="spacer"> </span>ко&shy;то&shy;рый<span class="spacer"> </span>ор&shy;га&shy;ни&shy;зу&shy;ет<span class="spacer"> </span>пес&shy;оч&shy;ни&shy;цу<span class="spacer"> </span>и<span class="spacer"> </span>ссыл&shy;ка<span class="spacer"> </span>на<span class="spacer"> </span>ко&shy;то&shy;рый<span class="spacer"> </span>у<span class="spacer"> </span>нас<span class="spacer"> </span>есть.</p>
<div class="paragraph-right-side">05</div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">06</div>
<p>Итак,<span class="spacer"> </span>по<span class="spacer"> </span>фак&shy;ту<span class="spacer"> </span>нам<span class="spacer"> </span>пре&shy;дос&shy;тав&shy;ля&shy;ет&shy;ся<span class="spacer"> </span>два<span class="spacer"> </span>кра&shy;е&shy;вых<span class="spacer"> </span>со&shy;бы&shy;тия:<span class="spacer"> </span>что-то<span class="spacer"> </span>про&shy;и&shy;зош&shy;ло,<span class="spacer"> </span>че&shy;го<span class="spacer"> </span>не<span class="spacer"> </span>пред&shy;по&shy;ла&shy;га&shy;лось<span class="spacer"> </span>(<code>First&shy;Chance&shy;Execption</code>)<span class="spacer"> </span>и<span class="spacer"> </span>&laquo;все<span class="spacer"> </span>пло&shy;хо&raquo;,<span class="spacer"> </span>ник&shy;то<span class="spacer"> </span>не<span class="spacer"> </span>об&shy;ра&shy;бо&shy;тал<span class="spacer"> </span>ис&shy;клю&shy;чит&shy;ель&shy;ную<span class="spacer"> </span>си&shy;ту&shy;а&shy;цию:<span class="spacer"> </span>она<span class="spacer"> </span>ока&shy;за&shy;лась<span class="spacer"> </span>не<span class="spacer"> </span>пре&shy;дус&shy;мот&shy;рен&shy;ной.<span class="spacer"> </span>А<span class="spacer"> </span>по&shy;то&shy;му<span class="spacer"> </span>по&shy;ток<span class="spacer"> </span>ис&shy;пол&shy;не&shy;ния<span class="spacer"> </span>ком&shy;анд<span class="spacer"> </span>не<span class="spacer"> </span>имеет<span class="spacer"> </span>смыс&shy;ла<span class="spacer"> </span>и<span class="spacer"> </span>он<span class="spacer"> </span>(<code>Thread</code>)<span class="spacer"> </span>бу&shy;дет<span class="spacer"> </span>от&shy;гру&shy;жен.</p>
<div class="paragraph-right-side">06</div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">07</div>
<p>Что<span class="spacer"> </span>мож&shy;но<span class="spacer"> </span>по&shy;лу&shy;чить,<span class="spacer"> </span>имея<span class="spacer"> </span>дан&shy;ные<span class="spacer"> </span>со&shy;бы&shy;тия<span class="spacer"> </span>и<span class="spacer"> </span>по&shy;че&shy;му<span class="spacer"> </span>пло&shy;хо<span class="spacer"> </span>что<span class="spacer"> </span>раз&shy;раб&shy;от&shy;чи&shy;ки<span class="spacer"> </span>об&shy;хо&shy;дят<span class="spacer"> </span>эти<span class="spacer"> </span>со&shy;бы&shy;тия<span class="spacer"> </span>сто&shy;ро&shy;ной?</p>
<div class="paragraph-right-side">07</div>
</div>
<h3 id="appdomain.firstchanceexception">App&shy;Domain&shy;.First&shy;Chance&shy;Exception</h3>
<div class="paragraph-container">
<div class="paragraph-left-side">08</div>
<p>Это<span class="spacer"> </span>со&shy;бы&shy;тие<span class="spacer"> </span>по<span class="spacer"> </span>сво&shy;ей<span class="spacer"> </span>су&shy;ти<span class="spacer"> </span>но&shy;сит<span class="spacer"> </span>чис&shy;то<span class="spacer"> </span>ин&shy;фор&shy;ма&shy;ци&shy;он&shy;ный<span class="spacer"> </span>хар&shy;ак&shy;тер<span class="spacer"> </span>и<span class="spacer"> </span>не<span class="spacer"> </span>мо&shy;жет<span class="spacer"> </span>быть<span class="spacer"> </span>&laquo;об&shy;ра&shy;бо&shy;та&shy;но&raquo;.<span class="spacer"> </span>Его<span class="spacer"> </span>за&shy;да&shy;ча<span class="spacer"> </span> &mdash; <span class="spacer"> </span>уве&shy;до&shy;мить<span class="spacer"> </span>вас,<span class="spacer"> </span>что<span class="spacer"> </span>в<span class="spacer"> </span>рам&shy;ках<span class="spacer"> </span>дан&shy;но&shy;го<span class="spacer"> </span>до&shy;ме&shy;на<span class="spacer"> </span>про&shy;и&shy;зош&shy;ло<span class="spacer"> </span>ис&shy;клю&shy;че&shy;ние,<span class="spacer"> </span>и<span class="spacer"> </span>оно<span class="spacer"> </span>пос&shy;ле<span class="spacer"> </span>об&shy;раб&shy;от&shy;ки<span class="spacer"> </span>со&shy;бы&shy;тия<span class="spacer"> </span>начнёт<span class="spacer"> </span>об&shy;ра&shy;ба&shy;тыв&shy;ать&shy;ся<span class="spacer"> </span>ко&shy;дом<span class="spacer"> </span>при&shy;ло&shy;же&shy;ния.<span class="spacer"> </span>Его<span class="spacer"> </span>ис&shy;пол&shy;не&shy;ние<span class="spacer"> </span>несёт<span class="spacer"> </span>за<span class="spacer"> </span>со&shy;бой<span class="spacer"> </span>па&shy;ру<span class="spacer"> </span>особ&shy;ен&shy;нос&shy;тей,<span class="spacer"> </span>о<span class="spacer"> </span>ко&shy;то&shy;рых<span class="spacer"> </span>не&shy;об&shy;хо&shy;ди&shy;мо<span class="spacer"> </span>пом&shy;нить<span class="spacer"> </span>во<span class="spacer"> </span>вре&shy;мя<span class="spacer"> </span>про&shy;ек&shy;ти&shy;ро&shy;ва&shy;ния<span class="spacer"> </span>об&shy;раб&shy;от&shy;чи&shy;ка.</p>
<div class="paragraph-right-side">08</div>
</div>
<p>Но<span class="spacer"> </span>дав&shy;ай&shy;те<span class="spacer"> </span>для<span class="spacer"> </span>на&shy;ча&shy;ла<span class="spacer"> </span>пос&shy;мот&shy;рим<span class="spacer"> </span>на<span class="spacer"> </span>прос&shy;той<span class="spacer"> </span>син&shy;те&shy;тич&shy;ес&shy;кий<span class="spacer"> </span>при&shy;мер<span class="spacer"> </span>его<span class="spacer"> </span>об&shy;раб&shy;от&shy;ки:</p>
<div class="lang-csharp editor-colors"><div style="color:Black;background-color:White;"><pre>
<span style="color:Blue;">void</span> Main()
{
    <span style="color:Blue;">var</span> counter = 0;

    AppDomain.CurrentDomain.FirstChanceException += (_, args) =&gt; {
        Console.WriteLine(args.Exception.Message);
        <span style="color:Blue;">if</span>(++counter == 1) {
            <span style="color:Blue;">throw</span> <span style="color:Blue;">new</span> ArgumentOutOfRangeException();
        }
    };

    <span style="color:Blue;">throw</span> <span style="color:Blue;">new</span> Exception(<span style="color:#A31515;">&quot;Hello!&quot;</span>);
}
</pre></div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">09</div>
<p>Чем<span class="spacer"> </span>при&shy;ме&shy;ча&shy;те&shy;лен<span class="spacer"> </span>дан&shy;ный<span class="spacer"> </span>код?<span class="spacer"> </span>Где<span class="spacer"> </span>бы<span class="spacer"> </span>не&shy;кий<span class="spacer"> </span>код<span class="spacer"> </span>ни<span class="spacer"> </span>сге&shy;не&shy;ри&shy;ро&shy;вал<span class="spacer"> </span>бы<span class="spacer"> </span>ис&shy;клю&shy;че&shy;ние<span class="spacer"> </span>пер&shy;вое<span class="spacer"> </span>что<span class="spacer"> </span>про&shy;и&shy;зойдёт<span class="spacer"> </span> &mdash; <span class="spacer"> </span>это<span class="spacer"> </span>его<span class="spacer"> </span>ло&shy;ги&shy;ро&shy;ва&shy;ние<span class="spacer"> </span>в<span class="spacer"> </span>кон&shy;соль.<span class="spacer"> </span>Т.е.<span class="spacer"> </span>да&shy;же<span class="spacer"> </span>ес&shy;ли<span class="spacer"> </span>вы<span class="spacer"> </span>за&shy;бу&shy;де&shy;те<span class="spacer"> </span>или<span class="spacer"> </span>не<span class="spacer"> </span>смо&shy;же&shy;те<span class="spacer"> </span>пре&shy;дус&shy;мот&shy;реть<span class="spacer"> </span>об&shy;раб&shy;от&shy;ку<span class="spacer"> </span>не&shy;ко&shy;то&shy;ро&shy;го<span class="spacer"> </span>ти&shy;па<span class="spacer"> </span>ис&shy;клю&shy;че&shy;ния<span class="spacer"> </span>оно<span class="spacer"> </span>все<span class="spacer"> </span>рав&shy;но<span class="spacer"> </span>по&shy;я&shy;вит&shy;ся<span class="spacer"> </span>в<span class="spacer"> </span>жур&shy;на&shy;ле<span class="spacer"> </span>со&shy;бы&shy;тий,<span class="spacer"> </span>ко&shy;то&shy;рое<span class="spacer"> </span>вы<span class="spacer"> </span>ор&shy;га&shy;ни&shy;зу&shy;е&shy;те.<span class="spacer"> </span>Вто&shy;рое<span class="spacer"> </span> &mdash; <span class="spacer"> </span>нес&shy;коль&shy;ко<span class="spacer"> </span>стран&shy;ное<span class="spacer"> </span>ус&shy;ло&shy;вие<span class="spacer"> </span>выб&shy;ро&shy;са<span class="spacer"> </span>внут&shy;рен&shy;не&shy;го<span class="spacer"> </span>ис&shy;клю&shy;че&shy;ния.<span class="spacer"> </span>Все<span class="spacer"> </span>де&shy;ло<span class="spacer"> </span>в<span class="spacer"> </span>том,<span class="spacer"> </span>что<span class="spacer"> </span>внут&shy;ри<span class="spacer"> </span>об&shy;раб&shy;от&shy;чи&shy;ка<span class="spacer"> </span><code>First&shy;Chance&shy;Exception</code><span class="spacer"> </span>вы<span class="spacer"> </span>не<span class="spacer"> </span>мо&shy;же&shy;те<span class="spacer"> </span>прос&shy;то<span class="spacer"> </span>взять<span class="spacer"> </span>и<span class="spacer"> </span>бро&shy;сить<span class="spacer"> </span>ещё<span class="spacer"> </span>од&shy;но<span class="spacer"> </span>ис&shy;клю&shy;че&shy;ние.<span class="spacer"> </span>Ско&shy;рее<span class="spacer"> </span>да&shy;же<span class="spacer"> </span>так:<span class="spacer"> </span>внут&shy;ри<span class="spacer"> </span>об&shy;раб&shy;от&shy;чи&shy;ка<span class="spacer"> </span>First&shy;Chance&shy;Exception<span class="spacer"> </span>вы<span class="spacer"> </span><em>не<span class="spacer"> </span>име&shy;ете<span class="spacer"> </span>воз&shy;мож&shy;нос&shy;ти</em><span class="spacer"> </span>бро&shy;сить<span class="spacer"> </span>хоть<span class="spacer"> </span>ка&shy;кое-ли&shy;бо<span class="spacer"> </span>ис&shy;клю&shy;че&shy;ние.<span class="spacer"> </span>Если<span class="spacer"> </span>вы<span class="spacer"> </span>так<span class="spacer"> </span>сде&shy;ла&shy;е&shy;те,<span class="spacer"> </span>воз&shy;мож&shy;ны<span class="spacer"> </span>два<span class="spacer"> </span>ва&shy;ри&shy;ан&shy;та<span class="spacer"> </span>со&shy;бы&shy;тий.<span class="spacer"> </span>При<span class="spacer"> </span>пер&shy;вом,<span class="spacer"> </span>ес&shy;ли<span class="spacer"> </span>бы<span class="spacer"> </span>не<span class="spacer"> </span>бы&shy;ло<span class="spacer"> </span>ус&shy;ло&shy;вия<span class="spacer"> </span><code>if(++counter<span class="spacer"> </span>==<span class="spacer"> </span>1)</code>,<span class="spacer"> </span>мы<span class="spacer"> </span>бы<span class="spacer"> </span>по&shy;лу&shy;чи&shy;ли<span class="spacer"> </span>бес&shy;кон&shy;еч&shy;ный<span class="spacer"> </span>выб&shy;рос<span class="spacer"> </span><code>First&shy;Chance&shy;Exception</code><span class="spacer"> </span>для<span class="spacer"> </span>все<span class="spacer"> </span>но&shy;вых<span class="spacer"> </span>и<span class="spacer"> </span>но&shy;вых<span class="spacer"> </span><code>Argument&shy;Out&shy;Of&shy;Range&shy;Exception</code>.<span class="spacer"> </span>А<span class="spacer"> </span>что<span class="spacer"> </span>это<span class="spacer"> </span>зна&shy;чит?<span class="spacer"> </span>Это<span class="spacer"> </span>зна&shy;чит,<span class="spacer"> </span>что<span class="spacer"> </span>на<span class="spacer"> </span>оп&shy;ре&shy;делённом<span class="spacer"> </span>этапе<span class="spacer"> </span>мы<span class="spacer"> </span>бы<span class="spacer"> </span>по&shy;лу&shy;чи&shy;ли<span class="spacer"> </span><code>Stack&shy;Overflow&shy;Exception</code>:<span class="spacer"> </span><code>throw<span class="spacer"> </span>new<span class="spacer"> </span>Exception&shy;("Hello&shy;!")</code><span class="spacer"> </span>вы&shy;зы&shy;ва&shy;ет<span class="spacer"> </span>CLR<span class="spacer"> </span>ме&shy;тод<span class="spacer"> </span>Throw&shy;,<span class="spacer"> </span>ко&shy;то&shy;рый<span class="spacer"> </span>вы&shy;зы&shy;ва&shy;ет<span class="spacer"> </span><code>First&shy;Chance&shy;Exception</code>,<span class="spacer"> </span>ко&shy;то&shy;рый<span class="spacer"> </span>вы&shy;зы&shy;ва&shy;ет<span class="spacer"> </span><code>Throw</code><span class="spacer"> </span>уже<span class="spacer"> </span>для<span class="spacer"> </span><code>Argument&shy;Out&shy;Of&shy;Range&shy;Exception</code><span class="spacer"> </span>и<span class="spacer"> </span>да&shy;лее<span class="spacer"> </span> &mdash; <span class="spacer"> </span>по<span class="spacer"> </span>рек&shy;ур&shy;сии.<span class="spacer"> </span>Вто&shy;рой<span class="spacer"> </span>ва&shy;ри&shy;ант:<span class="spacer"> </span>мы<span class="spacer"> </span>за&shy;щи&shy;ти&shy;лись<span class="spacer"> </span>по<span class="spacer"> </span>глу&shy;би&shy;не<span class="spacer"> </span>рек&shy;ур&shy;сии<span class="spacer"> </span>при<span class="spacer"> </span>по&shy;мо&shy;щи<span class="spacer"> </span>ус&shy;ло&shy;вия<span class="spacer"> </span>по<span class="spacer"> </span><code>counter</code>.<span class="spacer"> </span>Т.е.<span class="spacer"> </span>в<span class="spacer"> </span>дан&shy;ном<span class="spacer"> </span>слу&shy;чае<span class="spacer"> </span>мы<span class="spacer"> </span>бро&shy;са&shy;ем<span class="spacer"> </span>ис&shy;клю&shy;че&shy;ние<span class="spacer"> </span>толь&shy;ко<span class="spacer"> </span>один<span class="spacer"> </span>раз.<span class="spacer"> </span>Рез&shy;уль&shy;тат<span class="spacer"> </span>бо&shy;лее<span class="spacer"> </span>чем<span class="spacer"> </span>не&shy;о&shy;жид&shy;ан&shy;ный:<span class="spacer"> </span>мы<span class="spacer"> </span>по&shy;лу&shy;чим<span class="spacer"> </span>ис&shy;клю&shy;чит&shy;ель&shy;ную<span class="spacer"> </span>си&shy;ту&shy;а&shy;цию,<span class="spacer"> </span>ко&shy;то&shy;рая<span class="spacer"> </span>фак&shy;тич&shy;ес&shy;ки<span class="spacer"> </span>от&shy;ра&shy;ба&shy;ты&shy;ва&shy;ет<span class="spacer"> </span>внут&shy;ри<span class="spacer"> </span>инстр&shy;укции<span class="spacer"> </span><code>Throw</code>.<span class="spacer"> </span>А<span class="spacer"> </span>что<span class="spacer"> </span>под&shy;хо&shy;дит<span class="spacer"> </span>бо&shy;лее<span class="spacer"> </span>все&shy;го<span class="spacer"> </span>для<span class="spacer"> </span>дан&shy;но&shy;го<span class="spacer"> </span>ти&shy;па<span class="spacer"> </span>ошибки?<span class="spacer"> </span>Сог&shy;лас&shy;но<span class="spacer"> </span>ECMA-335<span class="spacer"> </span>ес&shy;ли<span class="spacer"> </span>инстр&shy;укция<span class="spacer"> </span>бы&shy;ла<span class="spacer"> </span>вве&shy;де&shy;на<span class="spacer"> </span>в<span class="spacer"> </span>ис&shy;клю&shy;чит&shy;ель&shy;ное<span class="spacer"> </span>по&shy;ло&shy;же&shy;ние,<span class="spacer"> </span>дол&shy;ж&shy;но<span class="spacer"> </span>быть<span class="spacer"> </span>выб&shy;ро&shy;ше&shy;но<span class="spacer"> </span><code>Execution&shy;Engine&shy;Exception</code>!<span class="spacer"> </span>А<span class="spacer"> </span>эту<span class="spacer"> </span>ис&shy;клю&shy;чит&shy;ель&shy;ную<span class="spacer"> </span>си&shy;ту&shy;а&shy;цию<span class="spacer"> </span>мы<span class="spacer"> </span>об&shy;ра&shy;бо&shy;тать<span class="spacer"> </span>ни&shy;как<span class="spacer"> </span>не<span class="spacer"> </span>в<span class="spacer"> </span>сос&shy;то&shy;я&shy;нии.<span class="spacer"> </span>Она<span class="spacer"> </span>при&shy;во&shy;дит<span class="spacer"> </span>к<span class="spacer"> </span>пол&shy;но&shy;му<span class="spacer"> </span>вы&shy;ле&shy;ту<span class="spacer"> </span>из<span class="spacer"> </span>при&shy;ло&shy;же&shy;ния.<span class="spacer"> </span>Ка&shy;кие<span class="spacer"> </span>же<span class="spacer"> </span>ва&shy;ри&shy;ан&shy;ты<span class="spacer"> </span>бе&shy;зоп&shy;ас&shy;ной<span class="spacer"> </span>об&shy;раб&shy;от&shy;ки<span class="spacer"> </span>у<span class="spacer"> </span>нас<span class="spacer"> </span>есть?</p>
<div class="paragraph-right-side">09</div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">10</div>
<p>Пер&shy;вое,<span class="spacer"> </span>что<span class="spacer"> </span>при&shy;хо&shy;дит<span class="spacer"> </span>в<span class="spacer"> </span>го&shy;ло&shy;ву<span class="spacer"> </span> &mdash; <span class="spacer"> </span>это<span class="spacer"> </span>выс&shy;та&shy;вить<span class="spacer"> </span><code>try-catch</code><span class="spacer"> </span>блок<span class="spacer"> </span>на<span class="spacer"> </span>весь<span class="spacer"> </span>код<span class="spacer"> </span>об&shy;раб&shy;от&shy;чи&shy;ка<span class="spacer"> </span><code>First&shy;Chance&shy;Exception</code>:</p>
<div class="paragraph-right-side">10</div>
</div>
<div class="lang-csharp editor-colors"><div style="color:Black;background-color:White;"><pre>
<span style="color:Blue;">void</span> Main()
{
    <span style="color:Blue;">var</span> fceStarted = <span style="color:Blue;">false</span>;
    <span style="color:Blue;">var</span> sync = <span style="color:Blue;">new</span> <span style="color:Blue;">object</span>();
    EventHandler&lt;FirstChanceExceptionEventArgs&gt; handler;
    handler = <span style="color:Blue;">new</span> EventHandler&lt;FirstChanceExceptionEventArgs&gt;((_, args) =&gt;
    {
        <span style="color:Blue;">lock</span> (sync)
        {
            <span style="color:Blue;">if</span> (fceStarted)
            {
                <span style="color:Green;">// Этот код по сути - заглушка, призванная уведомить что исключение по своей сути - родилось не в основном коде приложения, </span>
                <span style="color:Green;">// а в try блоке ниже.</span>
                Console.WriteLine($<span style="color:#A31515;">&quot;FirstChanceException inside FirstChanceException ({args.Exception.GetType().FullName})&quot;</span>);
                <span style="color:Blue;">return</span>;
            }
            fceStarted = <span style="color:Blue;">true</span>;

            <span style="color:Blue;">try</span>
            {
                <span style="color:Green;">// не безопасное логгирование куда угодно. Например, в БД</span>
                Console.WriteLine(args.Exception.Message);
                <span style="color:Blue;">throw</span> <span style="color:Blue;">new</span> ArgumentOutOfRangeException();
            }
            <span style="color:Blue;">catch</span> (Exception exception)
            {
                <span style="color:Green;">// это логгирование должно быть максимально безопасным</span>
                Console.WriteLine(<span style="color:#A31515;">&quot;Success&quot;</span>);
            }
            <span style="color:Blue;">finally</span>
            {
                fceStarted = <span style="color:Blue;">false</span>;
            }
        }
    });
    AppDomain.CurrentDomain.FirstChanceException += handler;

    <span style="color:Blue;">try</span>
    {
        <span style="color:Blue;">throw</span> <span style="color:Blue;">new</span> Exception(<span style="color:#A31515;">&quot;Hello!&quot;</span>);
    } <span style="color:Blue;">finally</span> {
        AppDomain.CurrentDomain.FirstChanceException -= handler;
    }
}

OUTPUT:

Hello!
Specified argument was <span style="color:Blue;">out</span> of the range of valid values.
FirstChanceException inside FirstChanceException (System.ArgumentOutOfRangeException)
Success

!Exception: Hello!
</pre></div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">11</div>
<p>Т.е.<span class="spacer"> </span>с<span class="spacer"> </span>од&shy;ной<span class="spacer"> </span>сто&shy;ро&shy;ны<span class="spacer"> </span>у<span class="spacer"> </span>нас<span class="spacer"> </span>есть<span class="spacer"> </span>код<span class="spacer"> </span>об&shy;раб&shy;от&shy;ки<span class="spacer"> </span>со&shy;бы&shy;тия<span class="spacer"> </span><code>First&shy;Chance&shy;Exception</code>,<span class="spacer"> </span>а<span class="spacer"> </span>с<span class="spacer"> </span>дру&shy;гой<span class="spacer"> </span> &mdash; <span class="spacer"> </span>доп&shy;ол&shy;нит&shy;ель&shy;ный<span class="spacer"> </span>код<span class="spacer"> </span>об&shy;раб&shy;от&shy;ки<span class="spacer"> </span>ис&shy;клю&shy;че&shy;ний<span class="spacer"> </span>в<span class="spacer"> </span>са&shy;мом<span class="spacer"> </span><code>First&shy;Chance&shy;Exception</code>.<span class="spacer"> </span>Одна&shy;ко<span class="spacer"> </span>ме&shy;то&shy;ди&shy;ки<span class="spacer"> </span>лог&shy;ги&shy;ро&shy;ва&shy;ния<span class="spacer"> </span>обеих<span class="spacer"> </span>си&shy;ту&shy;а&shy;ций<span class="spacer"> </span>дол&shy;ж&shy;ны<span class="spacer"> </span>от&shy;лич&shy;ать&shy;ся.<span class="spacer"> </span>Если<span class="spacer"> </span>ло&shy;ги&shy;ро&shy;ва&shy;ние<span class="spacer"> </span>об&shy;раб&shy;от&shy;ки<span class="spacer"> </span>со&shy;бы&shy;тия<span class="spacer"> </span>мо&shy;жет<span class="spacer"> </span>ид&shy;ти<span class="spacer"> </span>как<span class="spacer"> </span>угодно,<span class="spacer"> </span>то<span class="spacer"> </span>об&shy;раб&shy;от&shy;ка<span class="spacer"> </span>ошибки<span class="spacer"> </span>ло&shy;ги&shy;ки<span class="spacer"> </span>об&shy;раб&shy;от&shy;ки<span class="spacer"> </span><code>First&shy;Chance&shy;Exception</code><span class="spacer"> </span>дол&shy;ж&shy;но<span class="spacer"> </span>ид&shy;ти<span class="spacer"> </span>без<span class="spacer"> </span>ис&shy;клю&shy;чит&shy;ель&shy;ных<span class="spacer"> </span>си&shy;ту&shy;а&shy;ций<span class="spacer"> </span>в<span class="spacer"> </span>прин&shy;ци&shy;пе.<span class="spacer"> </span>Вто&shy;рое,<span class="spacer"> </span>что<span class="spacer"> </span>вы<span class="spacer"> </span>нав&shy;ер&shy;ня&shy;ка<span class="spacer"> </span>за&shy;ме&shy;ти&shy;ли<span class="spacer"> </span> &mdash; <span class="spacer"> </span>это<span class="spacer"> </span>синх&shy;ро&shy;ни&shy;за&shy;ция<span class="spacer"> </span>меж&shy;ду<span class="spacer"> </span>по&shy;то&shy;ка&shy;ми.<span class="spacer"> </span>Тут<span class="spacer"> </span>мо&shy;жет<span class="spacer"> </span>воз&shy;ник&shy;нуть<span class="spacer"> </span>воп&shy;рос:<span class="spacer"> </span>за&shy;чем<span class="spacer"> </span>она<span class="spacer"> </span>тут,<span class="spacer"> </span>ес&shy;ли<span class="spacer"> </span>лю&shy;бое<span class="spacer"> </span>ис&shy;клю&shy;че&shy;ние<span class="spacer"> </span>рож&shy;де&shy;но<span class="spacer"> </span>в<span class="spacer"> </span>ка&shy;ком-ли&shy;бо<span class="spacer"> </span>по&shy;то&shy;ке,<span class="spacer"> </span>а<span class="spacer"> </span>зна&shy;чит<span class="spacer"> </span><code>First&shy;Chance&shy;Exception</code><span class="spacer"> </span>по<span class="spacer"> </span>идее<span class="spacer"> </span>дол&shy;жен<span class="spacer"> </span>быть<span class="spacer"> </span>по&shy;то&shy;ко&shy;бе&shy;зоп&shy;ас&shy;ным.<span class="spacer"> </span>Одна&shy;ко,<span class="spacer"> </span>все<span class="spacer"> </span>не<span class="spacer"> </span>так<span class="spacer"> </span>жиз&shy;не&shy;рад&shy;ос&shy;т&shy;но.<span class="spacer"> </span><code>First&shy;Chance&shy;Exception</code><span class="spacer"> </span>у<span class="spacer"> </span>нас<span class="spacer"> </span>воз&shy;ни&shy;ка&shy;ет<span class="spacer"> </span>у<span class="spacer"> </span>App&shy;Domain&shy;.<span class="spacer"> </span>А<span class="spacer"> </span>это<span class="spacer"> </span>зна&shy;чит,<span class="spacer"> </span>что<span class="spacer"> </span>он<span class="spacer"> </span>воз&shy;ни&shy;ка&shy;ет<span class="spacer"> </span>для<span class="spacer"> </span>лю&shy;бо&shy;го<span class="spacer"> </span>по&shy;то&shy;ка,<span class="spacer"> </span>стар&shy;тов&shy;ан&shy;но&shy;го<span class="spacer"> </span>в<span class="spacer"> </span>оп&shy;ре&shy;делённом<span class="spacer"> </span>до&shy;ме&shy;не.<span class="spacer"> </span>Т.е.<span class="spacer"> </span>ес&shy;ли<span class="spacer"> </span>у<span class="spacer"> </span>нас<span class="spacer"> </span>есть<span class="spacer"> </span>до&shy;мен,<span class="spacer"> </span>внут&shy;ри<span class="spacer"> </span>ко&shy;то&shy;ро&shy;го<span class="spacer"> </span>стар&shy;то&shy;ва&shy;но<span class="spacer"> </span>нес&shy;коль&shy;ко<span class="spacer"> </span>по&shy;то&shy;ков,<span class="spacer"> </span>то<span class="spacer"> </span><code>First&shy;Chance&shy;Exception</code><span class="spacer"> </span>мо&shy;гут<span class="spacer"> </span>ид&shy;ти<span class="spacer"> </span>в<span class="spacer"> </span>пар&shy;ал&shy;лель.<span class="spacer"> </span>А<span class="spacer"> </span>это<span class="spacer"> </span>зна&shy;чит,<span class="spacer"> </span>что<span class="spacer"> </span>нам<span class="spacer"> </span>не&shy;об&shy;хо&shy;ди&shy;мо<span class="spacer"> </span>как-то<span class="spacer"> </span>за&shy;щи&shy;тить<span class="spacer"> </span>се&shy;бя<span class="spacer"> </span>синх&shy;ро&shy;ни&shy;за&shy;ци&shy;ей:<span class="spacer"> </span>нап&shy;ри&shy;мер<span class="spacer"> </span>при<span class="spacer"> </span>по&shy;мо&shy;щи<span class="spacer"> </span><code>lock</code>.</p>
<div class="paragraph-right-side">11</div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">12</div>
<p>Вто&shy;рой<span class="spacer"> </span>спо&shy;соб<span class="spacer"> </span> &mdash; <span class="spacer"> </span>поп&shy;ро&shy;бо&shy;вать<span class="spacer"> </span>увести<span class="spacer"> </span>об&shy;раб&shy;от&shy;ку<span class="spacer"> </span>в<span class="spacer"> </span>сос&shy;ед&shy;ний<span class="spacer"> </span>по&shy;ток,<span class="spacer"> </span>при&shy;над&shy;ле&shy;жа&shy;щий<span class="spacer"> </span>дру&shy;го&shy;му<span class="spacer"> </span>до&shy;ме&shy;ну<span class="spacer"> </span>при&shy;ло&shy;же&shy;ний.<span class="spacer"> </span>Одна&shy;ко<span class="spacer"> </span>тут<span class="spacer"> </span>сто&shy;ит<span class="spacer"> </span>ого&shy;вор&shy;иться,<span class="spacer"> </span>что<span class="spacer"> </span>при<span class="spacer"> </span>та&shy;кой<span class="spacer"> </span>ре&shy;а&shy;ли&shy;за&shy;ции<span class="spacer"> </span>мы<span class="spacer"> </span>дол&shy;ж&shy;ны<span class="spacer"> </span>пос&shy;тро&shy;ить<span class="spacer"> </span>вы&shy;дел&shy;ен&shy;ный<span class="spacer"> </span>до&shy;мен<span class="spacer"> </span>именно<span class="spacer"> </span>под<span class="spacer"> </span>эту<span class="spacer"> </span>за&shy;да&shy;чу<span class="spacer"> </span>что&shy;бы<span class="spacer"> </span>не<span class="spacer"> </span>по&shy;лу&shy;чи&shy;лось<span class="spacer"> </span>так,<span class="spacer"> </span>что<span class="spacer"> </span>этот<span class="spacer"> </span>до&shy;мен<span class="spacer"> </span>мо&shy;гут<span class="spacer"> </span>по&shy;ло&shy;жить<span class="spacer"> </span>дру&shy;гие<span class="spacer"> </span>по&shy;то&shy;ки,<span class="spacer"> </span>ко&shy;то&shy;рые<span class="spacer"> </span>яв&shy;ля&shy;ют&shy;ся<span class="spacer"> </span>ра&shy;бо&shy;чи&shy;ми:</p>
<div class="paragraph-right-side">12</div>
</div>
<div class="lang-csharp editor-colors"><div style="color:Black;background-color:White;"><pre>
<span style="color:Blue;">static</span> <span style="color:Blue;">void</span>  Main()
{
    <span style="color:Blue;">using</span> (ApplicationLogger.Go(AppDomain.CurrentDomain))
    {
        <span style="color:Blue;">throw</span> <span style="color:Blue;">new</span> Exception(<span style="color:#A31515;">&quot;Hello!&quot;</span>);
    }
}

<span style="color:Blue;">public</span> <span style="color:Blue;">class</span> ApplicationLogger : MarshalByRefObject
{
    ConcurrentQueue&lt;Exception&gt; queue = <span style="color:Blue;">new</span> ConcurrentQueue&lt;Exception&gt;();
    CancellationTokenSource cancellation;
    ManualResetEvent @<span style="color:Blue;">event</span>;

    <span style="color:Blue;">public</span> <span style="color:Blue;">void</span> LogFCE(Exception message)
    {
        queue.Enqueue(message);
    }

    <span style="color:Blue;">private</span> <span style="color:Blue;">void</span> StartThread()
    {
        cancellation = <span style="color:Blue;">new</span> CancellationTokenSource();
        @<span style="color:Blue;">event</span> = <span style="color:Blue;">new</span> ManualResetEvent(<span style="color:Blue;">false</span>);
        <span style="color:Blue;">var</span> thread = <span style="color:Blue;">new</span> Thread(() =&gt;
        {
            <span style="color:Blue;">while</span> (!cancellation.IsCancellationRequested)
            {
                <span style="color:Blue;">if</span> (queue.TryDequeue(<span style="color:Blue;">out</span> <span style="color:Blue;">var</span> exception))
                {
                    Console.WriteLine(exception.Message);
                }
                Thread.Yield();
            }
            @<span style="color:Blue;">event</span>.Set();
        });
        thread.Start();
    }

    <span style="color:Blue;">private</span> <span style="color:Blue;">void</span> StopAndWait()
    {
        cancellation.Cancel();
        @<span style="color:Blue;">event</span>.WaitOne();
    }

    <span style="color:Blue;">public</span> <span style="color:Blue;">static</span> IDisposable Go(AppDomain observable)
    {
        <span style="color:Blue;">var</span> dom = AppDomain.CreateDomain(<span style="color:#A31515;">&quot;ApplicationLogger&quot;</span>, <span style="color:Blue;">null</span>, <span style="color:Blue;">new</span> AppDomainSetup
        {
            ApplicationBase = AppDomain.CurrentDomain.BaseDirectory,
        });

        <span style="color:Blue;">var</span> proxy = (ApplicationLogger)dom.CreateInstanceAndUnwrap(<span style="color:Blue;">typeof</span>(ApplicationLogger).Assembly.FullName, <span style="color:Blue;">typeof</span>(ApplicationLogger).FullName);
        proxy.StartThread();

        <span style="color:Blue;">var</span> subscription = <span style="color:Blue;">new</span> EventHandler&lt;FirstChanceExceptionEventArgs&gt;((_, args) =&gt;
        {
            proxy.LogFCE(args.Exception);
        });
        observable.FirstChanceException += subscription;

        <span style="color:Blue;">return</span> <span style="color:Blue;">new</span> Subscription(() =&gt; {
            observable.FirstChanceException -= subscription;
            proxy.StopAndWait();
        });
    }

    <span style="color:Blue;">private</span> <span style="color:Blue;">class</span> Subscription : IDisposable
    {
        Action act;
        <span style="color:Blue;">public</span> Subscription (Action act) {
            <span style="color:Blue;">this</span>.act = act;
        }
        <span style="color:Blue;">public</span> <span style="color:Blue;">void</span> Dispose()
        {
            act();
        }
    }
}
</pre></div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">13</div>
<p>В<span class="spacer"> </span>дан&shy;ном<span class="spacer"> </span>слу&shy;чае<span class="spacer"> </span>об&shy;раб&shy;от&shy;ка<span class="spacer"> </span><code>First&shy;Chance&shy;Exception</code><span class="spacer"> </span>про&shy;ис&shy;хо&shy;дит<span class="spacer"> </span>мак&shy;сим&shy;аль&shy;но<span class="spacer"> </span>бе&shy;зоп&shy;ас&shy;но:<span class="spacer"> </span>в<span class="spacer"> </span>сос&shy;ед&shy;нем<span class="spacer"> </span>по&shy;то&shy;ке,<span class="spacer"> </span>при&shy;над&shy;ле&shy;жа&shy;щем<span class="spacer"> </span>сос&shy;ед&shy;не&shy;му<span class="spacer"> </span>до&shy;ме&shy;ну.<span class="spacer"> </span>Ошиб&shy;ки<span class="spacer"> </span>об&shy;раб&shy;от&shy;ки<span class="spacer"> </span>со&shy;об&shy;ще&shy;ния<span class="spacer"> </span>при<span class="spacer"> </span>этом<span class="spacer"> </span>не<span class="spacer"> </span>мо&shy;гут<span class="spacer"> </span>об&shy;ру&shy;шить<span class="spacer"> </span>ра&shy;бо&shy;чие<span class="spacer"> </span>по&shy;то&shy;ки<span class="spacer"> </span>при&shy;ло&shy;же&shy;ния.<span class="spacer"> </span>Плюс<span class="spacer"> </span>от&shy;дель&shy;но<span class="spacer"> </span>мож&shy;но<span class="spacer"> </span>пос&shy;лу&shy;шать<span class="spacer"> </span>Unhandled&shy;Exception<span class="spacer"> </span>до&shy;ме&shy;на<span class="spacer"> </span>ло&shy;ги&shy;ро&shy;ва&shy;ния<span class="spacer"> </span>со&shy;об&shy;ще&shy;ний:<span class="spacer"> </span>фат&shy;аль&shy;ные<span class="spacer"> </span>ошибки<span class="spacer"> </span>при<span class="spacer"> </span>ло&shy;ги&shy;ро&shy;ва&shy;нии<span class="spacer"> </span>не<span class="spacer"> </span>об&shy;ру&shy;шат<span class="spacer"> </span>все<span class="spacer"> </span>при&shy;ло&shy;же&shy;ние.</p>
<div class="paragraph-right-side">13</div>
</div>
<h3 id="appdomain.unhandledexception">App&shy;Domain&shy;.Unhandled&shy;Exception</h3>
<div class="paragraph-container">
<div class="paragraph-left-side">14</div>
<p>Вто&shy;рое<span class="spacer"> </span>со&shy;об&shy;ще&shy;ние,<span class="spacer"> </span>ко&shy;то&shy;рое<span class="spacer"> </span>мы<span class="spacer"> </span>мо&shy;жем<span class="spacer"> </span>пер&shy;ех&shy;ва&shy;тить<span class="spacer"> </span>и<span class="spacer"> </span>ко&shy;то&shy;рое<span class="spacer"> </span>ка&shy;са&shy;ет&shy;ся<span class="spacer"> </span>об&shy;раб&shy;от&shy;ки<span class="spacer"> </span>ис&shy;клю&shy;чит&shy;ель&shy;ных<span class="spacer"> </span>си&shy;ту&shy;а&shy;ций<span class="spacer"> </span> &mdash; <span class="spacer"> </span>это<span class="spacer"> </span><code>App&shy;Domain&shy;.Unhandled&shy;Exception</code>.<span class="spacer"> </span>Это<span class="spacer"> </span>со&shy;об&shy;ще&shy;ние<span class="spacer"> </span> &mdash; <span class="spacer"> </span>очень<span class="spacer"> </span>пло&shy;хая<span class="spacer"> </span>нов&shy;ость<span class="spacer"> </span>для<span class="spacer"> </span>нас<span class="spacer"> </span>пос&shy;коль&shy;ку<span class="spacer"> </span>обоз&shy;на&shy;чает<span class="spacer"> </span>что<span class="spacer"> </span>не<span class="spacer"> </span>наш&shy;лось<span class="spacer"> </span>ни&shy;ко&shy;го<span class="spacer"> </span>кто<span class="spacer"> </span>смог<span class="spacer"> </span>бы<span class="spacer"> </span>най&shy;ти<span class="spacer"> </span>спо&shy;соб<span class="spacer"> </span>об&shy;раб&shy;от&shy;ки<span class="spacer"> </span>воз&shy;ник&shy;шей<span class="spacer"> </span>ошибки<span class="spacer"> </span>в<span class="spacer"> </span>не&shy;ко&shy;то&shy;ром<span class="spacer"> </span>по&shy;то&shy;ке.<span class="spacer"> </span>Так&shy;же,<span class="spacer"> </span>ес&shy;ли<span class="spacer"> </span>про&shy;и&shy;зош&shy;ла<span class="spacer"> </span>та&shy;кая<span class="spacer"> </span>си&shy;ту&shy;а&shy;ция,<span class="spacer"> </span>все<span class="spacer"> </span>что<span class="spacer"> </span>мы<span class="spacer"> </span>мо&shy;жем<span class="spacer"> </span>сде&shy;лать<span class="spacer"> </span> &mdash; <span class="spacer"> </span>это<span class="spacer"> </span>&laquo;разг&shy;рес&shy;ти&raquo;<span class="spacer"> </span>пос&shy;л&shy;едствия<span class="spacer"> </span>та&shy;кой<span class="spacer"> </span>ошибки.<span class="spacer"> </span>Т.е.<span class="spacer"> </span>ка&shy;ким-ли&shy;бо<span class="spacer"> </span>об&shy;ра&shy;зом<span class="spacer"> </span>зач&shy;ис&shy;тить<span class="spacer"> </span>рес&shy;ур&shy;сы,<span class="spacer"> </span>при&shy;над&shy;ле&shy;жа&shy;щие<span class="spacer"> </span>толь&shy;ко<span class="spacer"> </span>этому<span class="spacer"> </span>по&shy;то&shy;ку,<span class="spacer"> </span>ес&shy;ли<span class="spacer"> </span>та&shy;ко&shy;вые<span class="spacer"> </span>соз&shy;да&shy;ва&shy;лись.<span class="spacer"> </span>Одна&shy;ко,<span class="spacer"> </span>ещё<span class="spacer"> </span>бо&shy;лее<span class="spacer"> </span>луч&shy;шая<span class="spacer"> </span>си&shy;ту&shy;а&shy;ция<span class="spacer"> </span> &mdash; <span class="spacer"> </span>об&shy;ра&shy;ба&shy;ты&shy;вать<span class="spacer"> </span>ис&shy;клю&shy;че&shy;ния,<span class="spacer"> </span>на&shy;хо&shy;дясь<span class="spacer"> </span>в<span class="spacer"> </span>&laquo;кор&shy;не&raquo;<span class="spacer"> </span>по&shy;то&shy;ков<span class="spacer"> </span>не<span class="spacer"> </span>за&shy;ва&shy;ли&shy;вая<span class="spacer"> </span>по&shy;ток.<span class="spacer"> </span>Т.е.<span class="spacer"> </span>по<span class="spacer"> </span>су&shy;ти<span class="spacer"> </span>ста&shy;вить<span class="spacer"> </span><code>try-catch</code>.<span class="spacer"> </span>Дав&shy;ай&shy;те<span class="spacer"> </span>поп&shy;ро&shy;бу&shy;ем<span class="spacer"> </span>расс&shy;мот&shy;реть<span class="spacer"> </span>це&shy;ле&shy;со&shy;об&shy;раз&shy;ность<span class="spacer"> </span>та&shy;ко&shy;го<span class="spacer"> </span>по&shy;ве&shy;де&shy;ния.</p>
<div class="paragraph-right-side">14</div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">15</div>
<p>Пусть<span class="spacer"> </span>мы<span class="spacer"> </span>имеем<span class="spacer"> </span>биб&shy;ли&shy;о&shy;те&shy;ку,<span class="spacer"> </span>ко&shy;то&shy;рой<span class="spacer"> </span>не&shy;об&shy;хо&shy;ди&shy;мо<span class="spacer"> </span>соз&shy;да&shy;вать<span class="spacer"> </span>по&shy;то&shy;ки<span class="spacer"> </span>и<span class="spacer"> </span>осущ&shy;е&shy;ствлять<span class="spacer"> </span>ка&shy;кую-то<span class="spacer"> </span>ло&shy;ги&shy;ку<span class="spacer"> </span>в<span class="spacer"> </span>этих<span class="spacer"> </span>по&shy;то&shy;ках.<span class="spacer"> </span>Мы,<span class="spacer"> </span>как<span class="spacer"> </span>поль&shy;зо&shy;ва&shy;те&shy;ли<span class="spacer"> </span>этой<span class="spacer"> </span>биб&shy;ли&shy;о&shy;те&shy;ки<span class="spacer"> </span>ин&shy;те&shy;ре&shy;су&shy;ем&shy;ся<span class="spacer"> </span>толь&shy;ко<span class="spacer"> </span>гар&shy;ан&shy;ти&shy;ей<span class="spacer"> </span>вы&shy;зо&shy;вов<span class="spacer"> </span>API<span class="spacer"> </span>а<span class="spacer"> </span>так&shy;же<span class="spacer"> </span>по&shy;лу&shy;че&shy;ни&shy;ем<span class="spacer"> </span>со&shy;об&shy;ще&shy;ний<span class="spacer"> </span>об<span class="spacer"> </span>ошиб&shy;ках.<span class="spacer"> </span>Если<span class="spacer"> </span>биб&shy;ли&shy;о&shy;те&shy;ка<span class="spacer"> </span>бу&shy;дет<span class="spacer"> </span>ру&shy;шить<span class="spacer"> </span>по&shy;то&shy;ки<span class="spacer"> </span>не<span class="spacer"> </span>но&shy;ти&shy;фи&shy;ци&shy;руя<span class="spacer"> </span>об<span class="spacer"> </span>этом,<span class="spacer"> </span>нам<span class="spacer"> </span>это<span class="spacer"> </span>ма&shy;ло<span class="spacer"> </span>чем<span class="spacer"> </span>мо&shy;жет<span class="spacer"> </span>по&shy;мочь.<span class="spacer"> </span>Ма&shy;ло<span class="spacer"> </span>то&shy;го<span class="spacer"> </span>об&shy;ру&shy;ше&shy;ние<span class="spacer"> </span>по&shy;то&shy;ка<span class="spacer"> </span>при&shy;ведёт<span class="spacer"> </span>к<span class="spacer"> </span>со&shy;об&shy;ще&shy;нию<span class="spacer"> </span><code>App&shy;Domain&shy;.Unhandled&shy;Exception</code>,<span class="spacer"> </span>в<span class="spacer"> </span>ко&shy;то&shy;ром<span class="spacer"> </span>нет<span class="spacer"> </span>ин&shy;фор&shy;ма&shy;ции<span class="spacer"> </span>о<span class="spacer"> </span>том,<span class="spacer"> </span>ка&shy;кой<span class="spacer"> </span>конк&shy;рет&shy;но<span class="spacer"> </span>по&shy;ток<span class="spacer"> </span>лёг<span class="spacer"> </span>на<span class="spacer"> </span>бок.<span class="spacer"> </span>Если<span class="spacer"> </span>же<span class="spacer"> </span>речь<span class="spacer"> </span>идёт<span class="spacer"> </span>о<span class="spacer"> </span>на&shy;шем<span class="spacer"> </span>ко&shy;де,<span class="spacer"> </span>об&shy;ру&shy;ши&shy;ва&shy;ю&shy;щий&shy;ся<span class="spacer"> </span>по&shy;ток<span class="spacer"> </span>нам<span class="spacer"> </span>то&shy;же<span class="spacer"> </span>вряд-ли<span class="spacer"> </span>бу&shy;дет<span class="spacer"> </span>пол&shy;ез&shy;ным.<span class="spacer"> </span>Во<span class="spacer"> </span>вся&shy;ком<span class="spacer"> </span>слу&shy;чае<span class="spacer"> </span>не&shy;об&shy;хо&shy;дим&shy;ос&shy;ти<span class="spacer"> </span>в<span class="spacer"> </span>этом<span class="spacer"> </span>я<span class="spacer"> </span>не<span class="spacer"> </span>встр&shy;ечал.<span class="spacer"> </span>На&shy;ша<span class="spacer"> </span>за&shy;да&shy;ча<span class="spacer"> </span> &mdash; <span class="spacer"> </span>об&shy;ра&shy;бо&shy;тать<span class="spacer"> </span>ошибки<span class="spacer"> </span>пра&shy;виль&shy;но,<span class="spacer"> </span>от&shy;дать<span class="spacer"> </span>ин&shy;фор&shy;ма&shy;цию<span class="spacer"> </span>об<span class="spacer"> </span>их<span class="spacer"> </span>воз&shy;ник&shy;но&shy;ве&shy;нии<span class="spacer"> </span>в<span class="spacer"> </span>жур&shy;нал<span class="spacer"> </span>оши&shy;бок<span class="spacer"> </span>и<span class="spacer"> </span>кор&shy;рек&shy;т&shy;но<span class="spacer"> </span>зав&shy;ер&shy;шить<span class="spacer"> </span>ра&shy;бо&shy;ту<span class="spacer"> </span>по&shy;то&shy;ка.<span class="spacer"> </span>Т.е.<span class="spacer"> </span>по<span class="spacer"> </span>су&shy;ти,<span class="spacer"> </span>обер&shy;нуть<span class="spacer"> </span>ме&shy;тод,<span class="spacer"> </span>с<span class="spacer"> </span>ко&shy;то&shy;ро&shy;го<span class="spacer"> </span>стар&shy;ту&shy;ет<span class="spacer"> </span>по&shy;ток<span class="spacer"> </span>в<span class="spacer"> </span><code>try-catch</code>:</p>
<div class="paragraph-right-side">15</div>
</div>
<div class="lang-csharp editor-colors"><div style="color:Black;background-color:White;"><pre>
    ThreadPool.QueueUserWorkitem(_ =&gt; {
        <span style="color:Blue;">using</span>(Disposables aggregator = ...){
            <span style="color:Blue;">try</span> {
                <span style="color:Green;">// do work here, plus:</span>
                aggregator.Add(subscriptions);
                aggregator.Add(dependantResources);
            } <span style="color:Blue;">catch</span> (Exception ex)
            {
                logger.Error(ex, <span style="color:#A31515;">&quot;Unhandled exception&quot;</span>);
            }
        }
    });
</pre></div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">16</div>
<p>В<span class="spacer"> </span>та&shy;кой<span class="spacer"> </span>схе&shy;ме<span class="spacer"> </span>мы<span class="spacer"> </span>по&shy;лу&shy;чим<span class="spacer"> </span>то,<span class="spacer"> </span>что<span class="spacer"> </span>на&shy;до:<span class="spacer"> </span>с<span class="spacer"> </span>од&shy;ной<span class="spacer"> </span>сто&shy;ро&shy;ны<span class="spacer"> </span>мы<span class="spacer"> </span>не<span class="spacer"> </span>об&shy;ру&shy;шим<span class="spacer"> </span>по&shy;ток.<span class="spacer"> </span>С<span class="spacer"> </span>дру&shy;гой<span class="spacer"> </span> &mdash; <span class="spacer"> </span>кор&shy;рек&shy;т&shy;но<span class="spacer"> </span>очис&shy;тим<span class="spacer"> </span>лок&shy;аль&shy;ные<span class="spacer"> </span>рес&shy;ур&shy;сы,<span class="spacer"> </span>ес&shy;ли<span class="spacer"> </span>они<span class="spacer"> </span>бы&shy;ли<span class="spacer"> </span>соз&shy;да&shy;ны.<span class="spacer"> </span>Ну<span class="spacer"> </span>и<span class="spacer"> </span>в<span class="spacer"> </span>до&shy;ве&shy;сок<span class="spacer"> </span> &mdash; <span class="spacer"> </span>ор&shy;га&shy;ни&shy;зу&shy;ем<span class="spacer"> </span>жур&shy;на&shy;ли&shy;ро&shy;ва&shy;ние<span class="spacer"> </span>по&shy;луч&shy;ен&shy;ной<span class="spacer"> </span>ошибки.<span class="spacer"> </span>Но<span class="spacer"> </span>пос&shy;той&shy;те,<span class="spacer"> </span>ска&shy;же&shy;те<span class="spacer"> </span>вы.<span class="spacer"> </span>Как-то<span class="spacer"> </span>вы<span class="spacer"> </span>ли&shy;хо<span class="spacer"> </span>сос&shy;ко&shy;чи&shy;ли<span class="spacer"> </span>с<span class="spacer"> </span>воп&shy;ро&shy;са<span class="spacer"> </span>со&shy;бы&shy;тия<span class="spacer"> </span><code>App&shy;Domain&shy;.Unhandled&shy;Exception</code>.<span class="spacer"> </span>Не&shy;у&shy;же&shy;ли<span class="spacer"> </span>оно<span class="spacer"> </span>сов&shy;сем<span class="spacer"> </span>не<span class="spacer"> </span>нуж&shy;но?<span class="spacer"> </span>Нуж&shy;но.<span class="spacer"> </span>Но<span class="spacer"> </span>толь&shy;ко<span class="spacer"> </span>для<span class="spacer"> </span>то&shy;го<span class="spacer"> </span>что&shy;бы<span class="spacer"> </span>со&shy;об&shy;щить,<span class="spacer"> </span>что<span class="spacer"> </span>мы<span class="spacer"> </span>за&shy;бы&shy;ли<span class="spacer"> </span>обер&shy;нуть<span class="spacer"> </span>ка&shy;кие-то<span class="spacer"> </span>по&shy;то&shy;ки<span class="spacer"> </span>в<span class="spacer"> </span><code>try-catch</code><span class="spacer"> </span>со<span class="spacer"> </span>всей<span class="spacer"> </span>не&shy;об&shy;хо&shy;ди&shy;мой<span class="spacer"> </span>ло&shy;ги&shy;кой.<span class="spacer"> </span>Имен&shy;но<span class="spacer"> </span>со<span class="spacer"> </span>всей:<span class="spacer"> </span>с<span class="spacer"> </span>ло&shy;ги&shy;ро&shy;ва&shy;ни&shy;ем<span class="spacer"> </span>и<span class="spacer"> </span>очист&shy;кой<span class="spacer"> </span>рес&shy;ур&shy;сов.<span class="spacer"> </span>Ина&shy;че<span class="spacer"> </span>это<span class="spacer"> </span>бу&shy;дет<span class="spacer"> </span>сов&shy;ер&shy;шен&shy;но<span class="spacer"> </span>не<span class="spacer"> </span>пра&shy;виль&shy;но:<span class="spacer"> </span>брать<span class="spacer"> </span>и<span class="spacer"> </span>га&shy;сить<span class="spacer"> </span>все<span class="spacer"> </span>ис&shy;клю&shy;че&shy;ния,<span class="spacer"> </span>как<span class="spacer"> </span>буд&shy;то<span class="spacer"> </span>их<span class="spacer"> </span>и<span class="spacer"> </span>не<span class="spacer"> </span>бы&shy;ло<span class="spacer"> </span>вов&shy;се.</p>
<div class="paragraph-right-side">16</div>
</div>

        </div>
    </div>
    <footer>
        <div class="footer-container">
            <div class="footer-wrap">
                <img src="../../../ru/res/img/logo-w-noindex.svg">
                <p>
                    <a class="footer-link" target="_blank" href="mailto:sidristij@clrium.ru"><i class="far fa-envelope" aria-hidden="true"></i></a>
                    <a class="footer-link" target="_blank" href="https://vk.com/clrium"><i class="fab fa-vk" aria-hidden="true"></i></a>
                    <a class="footer-link" target="_blank" href="https://youtube.com/clrium"><i class="fab fa-youtube" aria-hidden="true"></i></a>
                    <a class="footer-link" target="_blank" href="https://github.com/clrium"><i class="fab fa-github" aria-hidden="true"></i></a>
                    <a class="footer-link" target="_blank" href="skype:stanislav.sidristyi"><i class="fab fa-skype" aria-hidden="true"></i></a>
                    <a class="footer-link" target="_blank" href="https://t.me/clrium_group"><i class="fab fa-telegram" aria-hidden="true"></i></a>
                </p>
            </div>
        </div>
    </footer>
</body>
</html>