<!DOCTYPE html>
<html lang="ru">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>.NET Platform Architecture</title>
</head>
<body>
    <script src="../../res/jquery.js"></script>
    <link rel="stylesheet" href="../../res/bootstrap.css">
    <link rel="stylesheet" href="../../res/awesome.css">
    <style>

body {
    font-family: PF Regal,Georgia,serif;
    font-size: 16pt;
    font-weight: 300;
    padding-top: 4em;
    background-color: #fdfdfd;
}

.book-title-container {
    width: 100%;
    text-align: center;
    margin: 73px 0 110px 0;
}

.book-title {
    font-size: 57pt;
    margin: 50px 0 70px 0;
    user-select: none;
}
.book-part-title-block {
    display: inline-block;
}
.book-part-title {
    font-size: 21pt;
    color: #656ab6;
    margin: 0 7px;
}

.book-part-title:hover {
    box-shadow: inset 0 -1px #007bff;
    text-decoration: none;
}

.book-superheading-title {
    font-size: 15pt;
    margin: 0 7px;
    color: #656ab6;
}

.article-container
{
    width: 62%;
}

strong {
    font-weight: 500;
}

p, li {
    margin: 0 0 1em;
    line-height: 1.5em;
    font-family: inherit;
}

ol, li {
    margin-top: 1em;
    margin-bottom: 1em;
}

ol {
    padding-left: 1.21em;
}

ul  {
    padding-left: 1em;
}

ol li, ul li {
    padding-left: 0.5em;	
    font-family: inherit;
    text-align: justify;
}

table {
    margin: 30px 0;
    width: 100%;
}

thead {
    background-color: aliceblue;
}

table th {
    font-weight: 400;
}

table td, table th {
    padding: 7px;
    border-top: solid darkgrey 1px;
    border-bottom: solid darkgrey 1px;
    border-right: dotted darkgray 1px;
    border-left: dotted darkgray 1px;
    font-size: smaller;
}

code, *[class*='lang-'] span, *[class*='lang-'] pre {
    font-family: JB Mono, monospace !important;
}

*[class*='lang-'] {
    padding: 0px 0px 25px 0px;
    font-size: 0.75em;
}


*[class*='lang-'] > div, pre > code {
    border-left-color: #eee;
    border-left-style: dotted;
    border-left-width: 3px;
    padding-left: 25px;
    display: block;
    padding-top: 20px;
    padding-bottom: 20px;
}

*[class*='lang-'] > div pre, pre > code pre {
    margin-bottom: 0;
}

p code:not(.highlight), li code:not(.highlight) {
    font-size: 0.7em;
    color: darkslateblue;
}

/* style for manual selecting */
.box {
    padding: 3px;
    border: gainsboro;
    border-width: 1px;
    border-style: solid;
}

code.highlight {
    font-family: inherit !important;
    font-size: inherit;
    font-weight: inherit;
    color: inherit;
}

p code.highlight, li code.highlight {
    padding: 4px;
    background-color: #ffffa1;
}

.wide {
    width:140%;
}

p a, li a {
    text-decoration: none;
    color: inherit;
    box-shadow: inset 0 -1px #b88b59;
}

p a:hover, li a:hover {
    text-decoration: none;
    color: inherit;
    box-shadow: inset 0 -1px #0056b3;
}

blockquote h5 {
    background-color: aquamarine;
    margin: 16px 0 16px -20px;
    padding: 15px 30px 15px;
}

p img {
    width: 95%;
}

blockquote 
{
    padding-left: 0.4em;
    border-left: 0.5em solid rgba(0,0,0,.08);
    font-style: italic;
}

blockquote.big-quote, 
blockquote.breadcrumbs 
{
    background-color: transparent;
    padding: 0;
    border-left: none;
    font-style: normal;
}

blockquote.breadcrumbs, blockquote.breadcrumbs  p
{
    margin: 0;
    padding: 0;
}

blockquote p {
    padding: 1em 1em 1em 0.6em;
    font-family: inherit;
}

blockquote p code {
    font-family: consolas, monospace;
    font-size: 17px;
    padding: 4px 6px;
}

blockquote p em {
    font-weight: 400;
}

blockquote.big-quote > p {
    margin: 0.7em 0 0.7em 0;
    font-family: Charter;
    font-size: 2.5em;
    padding: 0;
    width: 130%;
    line-height: 1em;
}

h1, h2, h3, h4, h5, h6 {
    margin: 0;
    padding: 0;
    font-weight: 400;
    font-family: inherit;
    hyphens: none;
}

h1 {
    font-size: 2.2em;
    font-family: Charter,Georgia,serif;
    font-weight: 300;
    margin: 1.8em 0 1.8em 0;
    text-align: center;
    width: 140%;
}

h2 {
    padding-top: 1.5em;
    padding-left: 1.5em;
    padding-right: 1.5em;
    margin-bottom: 0.5em;
    font-family: Charter, Arial, Helvetica Neue, sans-serif;
    font-size: 1.4em;
    text-align: center;
}

h3 {
    padding-top: 1.2em;
    font-family: Charter, Arial, Helvetica Neue, sans-serif;
    font-size: 1.15em;
    width: 70%;
}

h4 {
    padding: 1em 0 0 0;
    font-size: 1.2em;
    font-weight: 300;
    font-style: italic;
}

h5 {
    padding: 0.6em 0 0 0;
    font-weight: 300;
    font-size: 1.1em;
}

/* Sidenotes */

.aside-container {
    position: relative;
}
.aside-container p {
    position: relative;
    top: 9px;
}

.aside-container > .aside-side-container {
    display: block;
    position: absolute;
    top: 12px;
    left: 96%;
    width: 34%;
    font-size: 12pt;
    line-height: 20px;
    margin-left: 100px;
    z-index: 1000;
}

.aside-container > .aside-side-container p {
    line-height: 24px;
    font-size: 13pt;
    margin: 0 0 13px 0;
}

.side-regular-block p {
    top: 0;
}

/* Music side player */
.aside-side-container .music-player {
    width: 100%;
    height: 400px;
}

/* media block after h1 */
.aside-container h1 + .aside-side-container.side-media-block h2 {
    margin: 7em 0 1em 0;
    font-family: Proxima Nova,Arial,Helvetica Neue,sans-serif;
    font-weight: 600;
}

.aside-side-container > li {
    display: block;
    font-family: Charter;
}

.aside-side-container > li ul, .aside-side-container > li ol {
    padding-left: 30px;
    margin-top: 0.5em;
    margin-bottom: 0.5em;
}
.aside-side-container > li li {
    padding-left: 6px;
    margin: 0 0 6px;
    line-height: 22px;

    font-family: Charter;
}

.aside-side-container p {
    line-height: 25px;
    font-size: 13pt;
    margin: 0 0 15px 0;
}

.aside-side-container blockquote {
    border: aliceblue;
    border-left-style: solid;
}

/* Paragraphs numbering */
.paragraph-container {
    position: relative;
}
.paragraph-container p {
    position: relative;
    top: 9px;
}

.paragraph-container p, .aside-container > p {
    text-align: justify;
}

.paragraph-container > .paragraph-left-side, .paragraph-container > .paragraph-right-side  {
    font-family: JB Mono, consolas;
    display: block;
    position: absolute;
    top: 17px;
    font-size: 10pt;
    line-height: 20px;
    color: #86abc473;
    z-index: 1000;
}
.paragraph-container > .paragraph-left-side {
    display: none;
    left: -2.1cm;
    width: 35px;
    user-select: none;
}

.paragraph-container > .paragraph-right-side  {
    display: none;
    left: 100%;
    width: 35px;
    padding-left: 45px;
    user-select: none;
}

.article-container
{
    width: 70%;
}

/* X_MENU */
.menu-title {
    text-align: center;
    margin: 35px 50px 35px 50px;
    font-size: 24pt;
    font-family: Charter;
}

.menu-container ol {
    margin: 0;
    padding: 0;
}

.menu-container ol li {
    margin: 0;
    padding: 0;
}

.header {
    height: 2.5em;
    background-color: white;
    position: relative;
    z-index: 1500;
    width: 100%;
    display: flex;
    justify-content: space-between;
    transition: all 1s;
    top: 0;
    box-shadow: 1px -4px 20px rgba(0, 0, 0, .1);
}

.fixed {
    position: fixed !important;
}

.header > .menu {
    pointer-events: auto;
    float: right;
    height: 40px;
    font-family: Charter, 'Helvetica Neue', Arial, sans-serif;
    font-size: 1em;
    color: #fff;
    margin-top:40px;
    margin-right:40px;
}

.menu a {
    color: #fff;
}
.menu a:hover {
    text-decoration: none;
    color: #fff;
}

#menu__toggle {
    opacity: 0;
}

#menu__toggle:checked ~ .menu__btn > span {
    transform: rotate(45deg);
}
#menu__toggle:checked ~ .menu__btn > span::before {
    top: 0;
    transform: rotate(0);
    background-color: black
}
#menu__toggle:checked ~ .menu__btn > span::after {
    top: 0;
    transform: rotate(90deg);
    background-color: black
}
#menu__toggle:checked ~ .menu__box {
    visibility: visible;
    right: 0;
}

.menu__btn {
    display: flex;
    align-items: center;
    position: fixed;
    top: 0;
    right: 0;
    width: 2.5em;
    height: 2.5em;
    cursor: pointer;
    z-index: 1;
    margin: 0;
    padding: 0.7em;
}

.menu__btn > span,
.menu__btn > span::before,
.menu__btn > span::after {
    display: block;
    position: absolute;

    width: 1.1em;
    height: 1px;

    border-bottom: 1px black solid;

    transition-duration: .25s;
}
.menu__btn > span::before {
    content: '';
    top: -7px;
}
.menu__btn > span::after {
    content: '';
    top: 7px;
}

.menu__box {
    display: block;
    position: fixed;
    visibility: hidden;
    top: 0;
    right: -100%;

    width: 100%;
    height: 100%;

    margin: 0;
    padding: 80px 0;

    list-style: none;

    background-color: white;
    box-shadow: 1px 0px 6px rgba(0, 0, 0, .2);

    transition-duration: .25s;

    overflow-y: auto;
}
.menu__box li a:hover {
    text-decoration: none;
    color: inherit;
}
.menu__list {
    font-size: 0.9em;
    margin: 0 2em 0 2em;
}
.menu__list li {
    text-align: left;
}

/* X_HEADER */

.conflogo {
    margin: 0.5em 0 0 0.8em;
    font-size: 1.1em;
    font-family: Charter;
    user-select: none;
}

.invisible {
    display: none;
}

.header > .menu > div {
    display: inline;
    margin-left: 10px;
    margin-right: 10px;
}

.menu__header_current
{
    text-align: center;
    font-size: 2em;
    margin: 0 0 1em 0;
}

.menu__header_total
{
    text-align: center;
    font-size: 2.4em;
    margin: 1.7em 0 0.3em 0;
}
.menu__header_list 
{
    padding: 0;
    margin-top: 0;
    margin-left: 0;
    margin-right: 0;
}
.menu__header_list > li 
{
    display: inline-block;
    width: 100%;
    margin: 0;
    text-align: center;
    font-family: charter;
}
.menu__header_total_sub
{
    font-size: 1.4em;
    margin: 2em 0 1em 0;
}
.menu__header_total_sub2
{
    font-size: 1.1em;
    margin: 1.5em 0 0.6em 1em;
    text-align: left;
}
/* X_FOOTER */

footer {
    margin-top: 2em;
    background-color: black;
    height: 4em;
}

footer > div {
    box-shadow: 0px 2px 2px rgb(0, 0, 0);
}

.footer-container {
    height: 100%;
}

.footer-wrap {
    color: #fff;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 25px 0;
}

.footer-wrap p {
    margin: 0;
    padding: 0px;
    line-height: 1em;
}

.footer-container img {
    height: 1.6em;
    margin-top: auto;
    margin-bottom: auto;
}

.footer-link {
    color: white;
    margin: 0 7px;
    font-size: 1em;
    box-shadow: none;
}

.footer-link:hover {
    color: salmon;
    box-shadow: none;
}

/* MEDIA */
/* XXL */
@media (min-width: 1601px) {
    .book-container
    {
        max-width: 1200px;
        margin-left: auto;
        margin-right: auto;
    }
}

/* XL */
@media (max-width: 1600px) {
    .book-container
    {
        margin-left: 4cm;
        margin-right: 4cm;
    }
}

/* LG */
@media (max-width: 1400px) {
    .book-container
    {
        margin-left: 4cm;
        margin-right: 4cm;
    }

    blockquote.big-quote > p {
        font-size: 2em;
    }
}

/* > MD */
@media (min-width: 992px) {
    .hamburger-menu {
        display: none;
    }
}

/* MD */
@media (max-width: 991px) {
    
    h3 {
        width:80%;
    }

    .book-container
    {
        margin-left: 3cm;
        margin-right: 3cm;
    }
    
    .book-title-container {
        margin: 73px 0 110px 0;
    }

    .book-title {
        font-size: 50pt;
        margin: 50px 0 70px 0;
    }

    .book-part-title {
        font-size: 19pt;
    }

    .book-part-title:hover {
        box-shadow: inset 0 -1px #007bff;
    }

    .book-superheading-title {
        font-size: 15pt;
    }                                     

    .article-container, h1 {
        width: 100%;
    }

    .aside-container p {
        top: 0;
    }

    .aside-container h1 + .aside-side-container.side-media-block h2 {
        display: none;
    }

    .wide {
        width: 100%;     
    }

    .side-regular-block {
        margin: 40px 10px;
        padding-left: 100px;
    }
    .aside-side-container .music-player {
        width: 100%;
        height: 100px;
    }
    .aside-side-container.side-media-block {
        padding: 17px 0;
    }
    .aside-side-container.side-media-block h2 {
        margin-top: 20px;
        font-size: 13pt;
        border: none;
    }

    .aside-container > .aside-side-container
    {
        position: relative;
        top: auto;
        left: auto;
        width: auto;
        height: auto;
        margin: 0;
        padding: 17px;
    }

    blockquote.big-quote > p {
        width: 100%;
        font-size: 2em;
    }

    .paragraph-container .paragraph-left-side {
        left: -55px;
    }

    body {
        font-size: 15pt;
    }

    p code:not(.highlight), li code:not(.highlight) {
        font-size: 11pt;
    }

    p, li {
        line-height: 30px;
    }
    
    li {
        margin: 0 0 10px 0;
    }

    .side-regular-block {
        border-radius: 5px;
        background-image: linear-gradient(180deg,hsla(0,0%,100%,0) 60%,#fff),linear-gradient(70deg,#dbedff 32%,#ebfff0);
        padding: 22px;
    }    

    .menu__list
    {
        margin-top: 0;
        margin-bottom: 0;
    }

    .menu__list, .menu__header_total_sub2
    {
        margin-left: auto;
        margin-right: auto;
        max-width: 800px;
        width: 80%;
    }

    .book-container 
    {
        position: absolute;
        padding: 0 3cm 0 3cm;
        overflow: scroll;
        overflow-x: auto;
        top: 2.5em;
        bottom: 0;
        width: 100%;
        margin: 0;
    }

    footer {
        margin-top: 2em;
        background-color: black;
        height: 4em;
    }

    footer > div {
        position: relative;
        margin: 0 -3cm;
        background: black;
        padding: 0 3cm;
    }
}

/* Smartphone horizontal - SM */
@media (max-width: 767px) {
    .book-title-container {
        margin: 73px 0 110px 0;
    }

    h1 {
        margin: 1.8em 0em 1.8em 0.3em;
    }

    .book-title {
        font-size: 40pt;
        margin: 50px 0 70px 0;
    }

    .book-part-title {
        font-size: 19pt;
    }

    .book-part-title:hover {
        box-shadow: inset 0 -1px #007bff;
    }

    .book-superheading-title {
        font-size: 17pt;
    }

    .book-container {
        padding: 0 2.5cm;
    }
    ul {
        margin-left: 30px;
        margin-right: 30px;
        padding-left: 25px;
    }
    .paragraph-container > .paragraph-left-side {
	    display: block;
        top: 14px;
        font-size: 9pt;
    }
    .paragraph-container > .paragraph-right-side {
    	display: block;
        padding-left: 40px;
        top: 14px;
        font-size: 9pt;
    }
    .footer-container img {
        height: 1.3em;
    } 
}

@media (max-width: 630px) {
    .book-container {
        padding: 0 1.5cm;
    }
    .paragraph-container > .paragraph-left-side {
        left: -33px;
    }
    .paragraph-container > .paragraph-right-side {
        padding-left: 24px;
    }
}
/* Smartphone - XS */
@media (max-width: 575px) {
    .book-container {
        padding: 0 50px 0 30px;
    }
    ul {
        margin: 0;
        padding-left: 20px;
    }

    body {
        font-size: 13pt;
    }

    p code:not(.highlight), li code:not(.highlight) 
    {
        font-size: 10pt;
        padding: 3px;
    }

    *[class*='lang-'] > div, pre > code {
        padding-left: 15px;
        padding-top: 15px;
        padding-bottom: 15px;
    }
    
    ol li, ul li {
        padding-left: 0.2em;	
    }
    
    p, li {
        line-height: 24px;
    }    
    
    .paragraph-container .paragraph-left-side 
    {
        display: none;        
    }
    .paragraph-container .paragraph-right-side 
    {
        padding-left: 21px;
        top: 14px;
	    font-size: 8pt;
    }
    .footer-container img {
        height: 1em;
    } 
    .menu__list {
        margin: 0 1em 0 1em;
    }
    .menu__header_total_sub2
    {
        margin: 1.5em 0 0.6em 1em;
    }
}

/* Fonts */

@font-face {
    font-family: 'PF Regal';
    src: url('../../res/fonts/PFRegalTextPro-Bold.eot');
    src: local('../../res/fonts/PFRegalTextPro-Bold'),
        url('../../res/fonts/PFRegalTextPro-Bold.woff2') format('woff2'),
        url('../../res/fonts/PFRegalTextPro-Bold.woff') format('woff'),
        url('../../res/fonts/PFRegalTextPro-Bold.ttf') format('truetype');
    font-weight: bold;
    font-style: normal;
}

@font-face {
    font-family: 'PF Regal';
    src: url('../../res/fonts/PFRegalTextPro-Medium.eot');
    src: local('../../res/fonts/PFRegalTextPro-Medium'),
        url('../../res/fonts/PFRegalTextPro-Medium.woff2') format('woff2'),
        url('../../res/fonts/PFRegalTextPro-Medium.woff') format('woff'),
        url('../../res/fonts/PFRegalTextPro-Medium.ttf') format('truetype');
    font-weight: 500;
    font-style: normal;
}

@font-face {
    font-family: 'PF Regal';
    src: url('../../res/fonts/PFRegalTextPro-BlackItalic.eot');
    src: local('../../res/fonts/PFRegalTextPro-BlackItalic'),
        url('../../res/fonts/PFRegalTextPro-BlackItalic.woff2') format('woff2'),
        url('../../res/fonts/PFRegalTextPro-BlackItalic.woff') format('woff'),
        url('../../res/fonts/PFRegalTextPro-BlackItalic.ttf') format('truetype');
    font-weight: 900;
    font-style: italic;
}

@font-face {
    font-family: 'PF Regal';
    src: url('../../res/fonts/PFRegalTextPro-Black.eot');
    src: local('../../res/fonts/PFRegalTextPro-Black'),
        url('../../res/fonts/PFRegalTextPro-Black.woff2') format('woff2'),
        url('../../res/fonts/PFRegalTextPro-Black.woff') format('woff'),
        url('../../res/fonts/PFRegalTextPro-Black.ttf') format('truetype');
    font-weight: 900;
    font-style: normal;
}

@font-face {
    font-family: 'PF Regal UBlack';
    src: url('../../res/fonts/PFRegalTextPro-UBlack.eot');
    src: local('../../res/fonts/PFRegalTextPro-UBlack'),
        url('../../res/fonts/PFRegalTextPro-UBlack.woff2') format('woff2'),
        url('../../res/fonts/PFRegalTextPro-UBlack.woff') format('woff'),
        url('../../res/fonts/PFRegalTextPro-UBlack.ttf') format('truetype');
    font-weight: 900;
    font-style: normal;
}

@font-face {
    font-family: 'PF Regal';
    src: url('../../res/fonts/PFRegalTextPro-MediumItalic.eot');
    src: local('../../res/fonts/PFRegalTextPro-MediumItalic'),
        url('../../res/fonts/PFRegalTextPro-MediumItalic.woff2') format('woff2'),
        url('../../res/fonts/PFRegalTextPro-MediumItalic.woff') format('woff'),
        url('../../res/fonts/PFRegalTextPro-MediumItalic.ttf') format('truetype');
    font-weight: 500;
    font-style: italic;
}

@font-face {
    font-family: 'PF Regal';
    src: url('../../res/fonts/PFRegalTextPro-UBlackItalic.eot');
    src: local('../../res/fonts/PFRegalTextPro-UBlackItalic'),
        url('../../res/fonts/PFRegalTextPro-UBlackItalic.woff2') format('woff2'),
        url('../../res/fonts/PFRegalTextPro-UBlackItalic.woff') format('woff'),
        url('../../res/fonts/PFRegalTextPro-UBlackItalic.ttf') format('truetype');
    font-weight: 900;
    font-style: italic;
}

@font-face {
    font-family: 'PF Regal';
    src: url('../../res/fonts/PFRegalTextPro-RegularAItalic.eot');
    src: local('../../res/fonts/PFRegalTextPro-RegularAItalic'),
        url('../../res/fonts/PFRegalTextPro-RegularAItalic.woff2') format('woff2'),
        url('../../res/fonts/PFRegalTextPro-RegularAItalic.woff') format('woff'),
        url('../../res/fonts/PFRegalTextPro-RegularAItalic.ttf') format('truetype');
    font-weight: 300;
    font-style: italic;
}

@font-face {
    font-family: 'PF Regal';
    src: url('../../res/fonts/PFRegalTextPro-BoldItalic.eot');
    src: local('../../res/fonts/PFRegalTextPro-BoldItalic'),
        url('../../res/fonts/PFRegalTextPro-BoldItalic.woff2') format('woff2'),
        url('../../res/fonts/PFRegalTextPro-BoldItalic.woff') format('woff'),
        url('../../res/fonts/PFRegalTextPro-BoldItalic.ttf') format('truetype');
    font-weight: bold;
    font-style: italic;
}

@font-face {
    font-family: 'Charter';
    src: url('../../res/fonts/charter-regular.woff2') format('woff2');
    font-weight: normal;
    font-style: normal;
}

/*  Regular B */
@font-face {
    font-family: 'PF Regal';
    src: url('../../res/fonts/PFRegalTextPro-RegularBItalic.eot');
    src: local('../../res/fonts/PFRegalTextPro-RegularBItalic'),
        url('../../res/fonts/PFRegalTextPro-RegularBItalic.woff2') format('woff2'),
        url('../../res/fonts/PFRegalTextPro-RegularBItalic.woff') format('woff'),
        url('../../res/fonts/PFRegalTextPro-RegularBItalic.ttf') format('truetype');
    font-weight: 300;
    font-style: italic;
}

@font-face {
    font-family: 'PF Regal';
    src: url('../../res/fonts/PFRegalTextPro-RegularB.eot');
    src: local('../../res/fonts/PFRegalTextPro-RegularB'),
        url('../../res/fonts/PFRegalTextPro-RegularB.woff2') format('woff2'),
        url('../../res/fonts/PFRegalTextPro-RegularB.woff') format('woff'),
        url('../../res/fonts/PFRegalTextPro-RegularB.ttf') format('truetype');
    font-weight: 300;
    font-style: normal;
}

@font-face {
    font-family: 'JB Mono';
    src: url('../../res/fonts/JetBrainsMono-Regular.eot');
    src: local('../../res/fonts/JetBrainsMono-Regular'),
        url('../../res/fonts/JetBrainsMono-Regular.woff2') format('woff2'),
        url('../../res/fonts/JetBrainsMono-Regular.woff') format('woff'),
        url('../../res/fonts/JetBrainsMono-Regular.ttf') format('truetype');
    font-weight: 300;
    font-style: normal;
}
@font-face {
    font-family: 'JB Mono';
    src: url('../../res/fonts/JetBrainsMono-Italic.eot');
    src: local('../../res/fonts/JetBrainsMono-Italic'),
        url('../../res/fonts/JetBrainsMono-Italic.woff2') format('woff2'),
        url('../../res/fonts/JetBrainsMono-Italic.woff') format('woff'),
        url('../../res/fonts/JetBrainsMono-Italic.ttf') format('truetype');
    font-weight: 300;
    font-style: italic;
}

@font-face {
    font-family: 'JB Mono';
    src: url('../../res/fonts/JetBrainsMono-Medium.eot');
    src: local('../../res/fonts/JetBrainsMono-Medium'),
        url('../../res/fonts/JetBrainsMono-Medium.woff2') format('woff2'),
        url('../../res/fonts/JetBrainsMono-Medium.woff') format('woff'),
        url('../../res/fonts/JetBrainsMono-Medium.ttf') format('truetype');
    font-weight: 500;
    font-style: normal;
}
@font-face {
    font-family: 'JB Mono';
    src: url('../../res/fonts/JetBrainsMono-Medium-Italic.eot');
    src: local('../../res/fonts/JetBrainsMono-Medium-Italic'),
        url('../../res/fonts/JetBrainsMono-Medium-Italic.woff2') format('woff2'),
        url('../../res/fonts/JetBrainsMono-Medium-Italic.woff') format('woff'),
        url('../../res/fonts/JetBrainsMono-Medium-Italic.ttf') format('truetype');
    font-weight: 500;
    font-style: italic;
}
@font-face {
    font-family: 'Font Awesome 5 Free';
    font-style: normal;
    font-weight: 400;
    font-display: swap;
    src: url("../../res/fonts/webfonts/fa-regular-400.eot");
    src: url("../../res/fonts/webfonts/fa-regular-400.eot?#iefix") format("embedded-opentype"), 
         url("../../res/fonts/webfonts/fa-regular-400.woff2") format("woff2"), 
         url("../../res/fonts/webfonts/fa-regular-400.woff") format("woff"), 
         url("../../res/fonts/webfonts/fa-regular-400.ttf") format("truetype"), 
         url("../../res/fonts/webfonts/fa-regular-400.svg#fontawesome") format("svg"); 
    font-display: swap;
}
    
.fa {
    font-family: 'Font Awesome 5 Free';
    font-weight: 400;
    font-display: swap;
}
@font-face {
  font-family: 'Font Awesome 5 Brands';
  font-style: normal;
  font-weight: 400;
  font-display: auto;
  src: url("../../res/fonts/fa-brands-400.eot");
  src: url("../../res/fonts/fa-brands-400.eot?#iefix") format("embedded-opentype"), url("../../res/fonts/fa-brands-400.woff2") format("woff2"), url("../../res/fonts/fa-brands-400.woff") format("woff"), url("../../res/fonts/fa-brands-400.ttf") format("truetype"), url("../../res/fonts/fa-brands-400.svg#fontawesome") format("svg"); 
}

.fab {
  font-family: 'Font Awesome 5 Brands';
  font-weight: 400; 
}

@font-face {
  font-family: 'Font Awesome 5 Free';
  font-style: normal;
  font-weight: 400;
  font-display: auto;
  src: url("../../res/fonts/fa-regular-400.eot");
  src: url("../../res/fonts/fa-regular-400.eot?#iefix") format("embedded-opentype"), url("../../res/fonts/fa-regular-400.woff2") format("woff2"), url("../../res/fonts/fa-regular-400.woff") format("woff"), url("../../res/fonts/fa-regular-400.ttf") format("truetype"), url("../../res/fonts/fa-regular-400.svg#fontawesome") format("svg"); 
}

.far {
  font-family: 'Font Awesome 5 Free';
  font-weight: 400; 
}

@font-face {
  font-family: 'Font Awesome 5 Free';
  font-style: normal;
  font-weight: 900;
  font-display: auto;
  src: url("../../res/fonts/fa-solid-900.eot");
  src: url("../../res/fonts/fa-solid-900.eot?#iefix") format("embedded-opentype"), url("../../res/fonts/fa-solid-900.woff2") format("woff2"), url("../../res/fonts/fa-solid-900.woff") format("woff"), url("../../res/fonts/fa-solid-900.ttf") format("truetype"), url("../../res/fonts/fa-solid-900.svg#fontawesome") format("svg"); 
}
</style>  
    <div class="book-title-container d-none d-lg-block">
        <div class="book-title">Knowledge Base</div>
        <div class="book-part-title-block">pt.1 <a href="../..//ru/Memory/01-00-MemoryManagement-Intro.html" class="book-part-title">Управление памятью</a></div>
        <div class="book-part-title-block">pt.2 <a href="../..//ru/Execution/02-00-ExecutionFlow-Intro.html" class="book-part-title">Поток исполнения команд</a></div>
        <br><a href="#" class="book-superheading-title">Обоснование выбора</a>
        / <a href="#" class="book-superheading-title">Упрощенное описание</a>
        / <a href="#" class="book-superheading-title">Подробное описание</a>
    </div>
    <header class="header fixed d-block d-lg-none">
        <p class="conflogo">KB</p> 

        <!-- mobile-menu -->

        <div class="hamburger-menu">
            <input id="menu__toggle" type="checkbox" />
            <label class="menu__btn" for="menu__toggle">
              <span></span>
            </label>
        
            <div class="menu__box">
                <p class="menu__header_current">На странице</p>
                <ol class="menu__list">
                    <li><a href="#based-on-a-theoretical-possibility-to-catch-a-future-exception" onclick="$('#menu__toggle').click(); return true;">
Based on a theoretical possibility to catch a future exception.</a></li>
<li><a href="#based-on-the-area-where-an-exceptional-situation-is-actually-catched" onclick="$('#menu__toggle').click(); return true;">
Based on the area where an exceptional situation is actually catched</a></li>
<li><a href="#based-on-reuse-issues" onclick="$('#menu__toggle').click(); return true;">
Based on reuse issues</a></li>
<li><a href="#based-on-belonging-to-a-specific-group-of-behavioral-situations" onclick="$('#menu__toggle').click(); return true;">
Based on belonging to a specific group of behavioral situations</a></li>
<li><a href="#based-on-the-source-of-an-error" onclick="$('#menu__toggle').click(); return true;">
Based on the source of an error</a></li>

                </ol>
                <p class="menu__header_total">Содержание</p>
                <ul class="menu__header_list">
                    <li>
                        <p class="menu__header_total_sub">
                            Управление памятью
                        </p>
                        <p class="menu__header_total_sub2">
                            Теоретические вопросы:
                        </p>
                        <ol class="menu__list">
                            <li><p><a href="../..//ru/Memory/01-00-MemoryManagement-Intro.html">
                                Общие слова
                            </a></p></li>
                            <li>
                                <p>
                                <a href="../..//ru/Memory/01-02-MemoryManagement-Basics.html">Введение в управление памятью</a></p>
                            </li>
                            <li>
                                <p>
                                <a href="../..//ru/Memory/01-04-MemoryManagement-ThreadStack.html">Стек потока</a></p>
                            </li>
                            <li>
                                <p>
                                <a href="../..//ru/Memory/01-06-MemoryManagement-EntitiesLifetime.html">Время жизни сущности</a></p>
                            </li>
                            <li>
                                <p>
                                <a href="../..//ru/Memory/01-08-MemoryManagement-RefVsValueTypes.html">RefTypes, ValueTypes, Boxing &amp; Unboxing</a></p>
                            </li>
                            <li>
                                <p>
                                <a href="../..//ru/Memory/01-10-MemoryManagement-IDisposable.html">Шаблон IDisposable</a></p>
                            </li>
                            <li>
                                <p>
                                <a href="../..//ru/Memory/01-12-MemoryManagement-Finalizer.html">Финализация</a></p>
                            </li>
                            <li>
                                <p>
                                <a href="../..//ru/Memory/01-14-MemoryManagement-Results.html">Выводы</a></p>
                            </li>
                        </ol>
                        <p class="menu__header_total_sub2">
                            Практические вопросы:
                        </p>
                        <ol class="menu__list" start="9">
                            <li><p><a href="../..//ru/Memory/02-02-MemoryManagement-MemorySpan.html">
                                Memory&lt;T&gt;, Span&lt;T&gt;
                            </a></p></li>
                        </ol> 
                    </li>
                    <li>
                        <p class="menu__header_total_sub">
                            Поток исполнения команд
                        </p>
                        <p class="menu__header_total_sub2">
                            Многопоточность:
                        </p>
                        <ol class="menu__list">
                            <li><p><a href="../..//ru/Execution/1-Threads/1-OS/1-threadsScheduling.html">
                                Потоки и планирование потоков
                            </a></p></li>
                        </ol>
                        <p class="menu__header_total_sub2">
                            Искл­юч­ител­ьные си­ту­а­ции:
                        </p>
                        <ol class="menu__list" start="2">
                            <li><p><a href="../..//ru/Execution/2-ExceptionalFlow/1-Exceptions-Intro.html">
                                Введение в исключительные ситуации
                            </a></p></li>
                            <li><p><a href="../..//ru/Execution/2-ExceptionalFlow/2-Exceptions-Architecture.html">
                                Архитектура исключительной ситуации
                            </a></p></li>
                            <li><p><a href="../..//ru/Execution/2-ExceptionalFlow/3-Exceptions-Events.html">
                                События об исключительных ситуациях
                            </a></p></li>
                            <li><p><a href="../..//ru/Execution/2-ExceptionalFlow/4-Exceptions-Types.html">
                                Виды исключительных ситуаций
                            </a></p></li>
                        </ol>
                    </li>
                </ul>
            </div>
        </div>
    </header>

    <div class="book-container">
        <div class="article-container">
            <!--<p class="d-xs-block d-sm-none">XS</p>
            <p class="d-none d-xs-block d-sm-none">SM</p>
            <p class="d-none d-sm-block d-md-none">MD</p>
            <p class="d-none d-lg-block d-xl-none">LG</p>
            <p class="d-none d-xl-block">XL</p> -->
            <h2 id="the-architecture-of-an-exceptional-situation">The arch&shy;it&shy;ecture of an excep&shy;ti&shy;onal situ&shy;a&shy;tion</h2>
<blockquote>
<p><a href="https://github.com/sidristij/dotnetbook/issues/51">A link to the discus&shy;sion</a></p>
</blockquote>
<div class="paragraph-container">
<div class="paragraph-left-side">01</div>
<p>I guess one of the most impor&shy;tant issues in this topic is buil&shy;ding an excep&shy;tion han&shy;dling arch&shy;it&shy;ecture in your appli&shy;ca&shy;tion. This is inte&shy;res&shy;ting for many rea&shy;sons. And the main reason, I think, is an appa&shy;rent simp&shy;li&shy;city, which you don’t always know what to do with. All the basic constructs such as <code>IEnu&shy;me&shy;rable</code>, <code>IDis&shy;po&shy;sable</code>, <code>IObse&shy;rvable</code>, etc. have this property and use it everywhere. On the one hand, their simp&shy;li&shy;city tempts to use these constructs in diffe&shy;rent situ&shy;a&shy;tions. On the other hand, they are full of traps which you might not get out. It is possible that loo&shy;king at the amount of infor&shy;ma&shy;tion we will cover you’ve got a ques&shy;tion: what is so special about excep&shy;ti&shy;onal situ&shy;a&shy;tions?</p>
<div class="paragraph-right-side">01</div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">02</div>
<p>However&shy;, to make conc&shy;lu&shy;sions about buil&shy;ding the arch&shy;it&shy;ecture of excep&shy;tion classes we should learn some details about their clas&shy;si&shy;fi&shy;ca&shy;tion. Because before buil&shy;ding a system of types that would be clear for the user of code, a prog&shy;rammer should deter&shy;mine when to choose the type of error and when to catch or skip excep&shy;tions. So&shy;, let’s clas&shy;sify the excep&shy;ti&shy;onal situ&shy;a&shy;tions (not the types of excep&shy;tions) based on various fea&shy;tures.</p>
<div class="paragraph-right-side">02</div>
</div>
<h3 id="based-on-a-theoretical-possibility-to-catch-a-future-exception">Based on a the&shy;or&shy;etical possi&shy;bi&shy;lity to catch a future excep&shy;tion.</h3>
<div class="paragraph-container">
<div class="paragraph-left-side">03</div>
<p>Based on this fea&shy;ture we can divide excep&shy;tions into those that will be defi&shy;ni&shy;tely caught and those that highly likely won’t be caught. Why do I say <em>highly likely</em>? Because there always be someone who will try to catch an excep&shy;tion while this is unne&shy;ces&shy;sary.</p>
<div class="paragraph-right-side">03</div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">04</div>
<p>First&shy;, let’s desc&shy;ribe the first group of excep&shy;tions – those that should be caught.</p>
<div class="paragraph-right-side">04</div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">05</div>
<p>In case of such excep&shy;tions we, on the one hand, say to our subsystem that we came to a state when there is no point in further actions with our data. On the other hand, we mean that nothing disas&shy;trous happ&shy;ened and we can find the way out of the situ&shy;a&shy;tion by simply catching the excep&shy;tion. This property is very impor&shy;tant as it defines the criti&shy;ca&shy;lity of an error and gives confi&shy;dence that if we catch an excep&shy;tion and clear reso&shy;urces, we can simply proceed with the code.</p>
<div class="paragraph-right-side">05</div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">06</div>
<p>The second group deals with excep&shy;tions that, although it may sound strange, don’t have to be caught. They can be used only for error logging, but not for correc&shy;ting a situ&shy;a&shy;tion. The simp&shy;lest example is <code>Argument&shy;Exception</code> and <code>Null&shy;Reference&shy;Exception</code>. In fact, in an ordi&shy;nary situ&shy;a&shy;tion you don’t need to catch, for example, <code>Argument&shy;Null&shy;Exception</code> because in this case the source of an error is exactly you. If you catch such an excep&shy;tion, you admit that you made an error and passed something unac&shy;cep&shy;table to a method:</p>
<div class="paragraph-right-side">06</div>
</div>
<div class="lang-csharp editor-colors"><div style="color:Black;background-color:White;"><pre>
<span style="color:Blue;">void</span> SomeMethod(<span style="color:Blue;">object</span> argument)
{
    <span style="color:Blue;">try</span> {
        AnotherMethod(argument);
    } <span style="color:Blue;">catch</span> (ArgumentNullException exception)
    {
        <span style="color:Green;">// Log it</span>
    }
}
</pre></div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">07</div>
<p>In this method we try to catch <code>Argument&shy;Null&shy;Exception</code>. But I think this is strange as passing right argu&shy;ments to a method is enti&shy;rely our concern. Reac&shy;ting after the event would be incor&shy;rect: the best thing you can do in such a situ&shy;a&shy;tion is to check the passed data in advance before calling a method or even to build such code where getting wrong para&shy;me&shy;ters is impos&shy;sible.</p>
<div class="paragraph-right-side">07</div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">08</div>
<p>Another group of excep&shy;ti&shy;onal situ&shy;a&shy;tions is fatal errors. If some cache is faulty and the work of a subsystem is anyway incor&shy;rect, then it is a fatal error and the nea&shy;rest code on the stack will not catch it for sure:</p>
<div class="paragraph-right-side">08</div>
</div>
<div class="lang-csharp editor-colors"><div style="color:Black;background-color:White;"><pre>
T GetFromCacheOrCalculate()
{
    <span style="color:Blue;">try</span> {
        <span style="color:Blue;">if</span>(_cache.TryGetValue(Key, <span style="color:Blue;">out</span> <span style="color:Blue;">var</span> result))
        {
            <span style="color:Blue;">return</span> result;
        } <span style="color:Blue;">else</span> {
            T res = Strategy(Key);
            _cache[Key] = res;
            <span style="color:Blue;">return</span> res;
        }
    } cache (CacheCorruptedException exception)
    {
        RecreateCache();
        <span style="color:Blue;">return</span> GetFromCacheOrCalculate();
    }
}
</pre></div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">09</div>
<p><code>Cache&shy;Corrupted&shy;Exception</code> is an excep&shy;tion mea&shy;ning that &laquo;hard drive cache is incon&shy;sis&shy;tent&raquo;. Then&shy;, if the cause of such an error is fatal for the cache subsystem (for example there are no cache file access rights), the follo&shy;wing code can’t recreate cache using <code>Recreate&shy;Cache</code> instr&shy;uc&shy;tion and the&shy;re&shy;fore catching this excep&shy;tion is an error itself.</p>
<div class="paragraph-right-side">09</div>
</div>
<h3 id="based-on-the-area-where-an-exceptional-situation-is-actually-catched">Based on the area where an excep&shy;ti&shy;onal situ&shy;a&shy;tion is actu&shy;ally catched</h3>
<div class="paragraph-container">
<div class="paragraph-left-side">10</div>
<p>Another issue is whether we should catch some excep&shy;tions or pass them to some&shy;body who unders&shy;tands the situ&shy;a&shy;tion better. In other words, we should estab&shy;lish areas of respon&shy;si&shy;bi&shy;lity. Let’s exa&shy;mine the follo&shy;wing code:</p>
<div class="paragraph-right-side">10</div>
</div>
<div class="lang-csharp editor-colors"><div style="color:Black;background-color:White;"><pre>

<span style="color:Blue;">namespace</span> JetFinance.Strategies
{
    <span style="color:Blue;">public</span> <span style="color:Blue;">class</span> WildStrategy : StrategyBase
    {
        <span style="color:Blue;">private</span> Random random =  <span style="color:Blue;">new</span> Random();

        <span style="color:Blue;">public</span> <span style="color:Blue;">void</span> PlayRussianRoulette()
        {
            <span style="color:Blue;">if</span>(DateTime.Now.Second == (random.Next() % 60))
            {
                <span style="color:Blue;">throw</span> <span style="color:Blue;">new</span> StrategyException();
            }
        }
    }

    <span style="color:Blue;">public</span> <span style="color:Blue;">class</span> StrategyException : Exception { <span style="color:Green;">/* .. */</span> }
}

<span style="color:Blue;">namespace</span> JetFinance.Investments
{
    <span style="color:Blue;">public</span> <span style="color:Blue;">class</span> WildInvestment
    {
        WildStrategy _strategy;

        <span style="color:Blue;">public</span> WildInvestment(WildStrategy strategy)
        {
            _strategy = strategy;
        }

        <span style="color:Blue;">public</span> <span style="color:Blue;">void</span> DoSomethingWild()
        {
            ?<span style="color:Blue;">try</span>?
            {
                _strategy.PlayRussianRoulette();
            }
            <span style="color:Blue;">catch</span>(StrategyException exception)
            {
            }
        }
    }
}

<span style="color:Blue;">using</span> JetFinance.Strategies;
<span style="color:Blue;">using</span> JetFinance.Investments;

<span style="color:Blue;">void</span> Main()
{
    <span style="color:Blue;">var</span> foo = <span style="color:Blue;">new</span> WildStrategy();
    <span style="color:Blue;">var</span> boo = <span style="color:Blue;">new</span> WildInvestment(foo);

    ?<span style="color:Blue;">try</span>?
    {
        boo.DoSomethingWild();
    }
    <span style="color:Blue;">catch</span>(StrategyException exception)
    {
    }
}

</pre></div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">11</div>
<p>Which of the two stra&shy;te&shy;gies is more approp&shy;riate? The area of respon&shy;si&shy;bi&shy;lity is very impor&shy;tant. Initially&shy;, it may seem that the work and consis&shy;tency of <code>Wild&shy;Investment</code> fully depend on <code>Wild&shy;Strategy</code>. Thus&shy;, if <code>Wild&shy;Investment</code> simply ignores this excep&shy;tion, it will go to the upper level and we shouldn’t do anything. However&shy;, note that in terms of arch&shy;it&shy;ecture the <code>Main</code> method catches an excep&shy;tion from one level while calling the method from another. How does it look in terms of use? Well&shy;, that’s how it looks:</p>
<div class="paragraph-right-side">11</div>
</div>
<ul>
<li>the respon&shy;si&shy;bi&shy;lity for this excep&shy;tion was handed over to us;</li>
<li>the user of this class is not sure that this excep&shy;tion was previously passed through a set of methods on purpose;</li>
<li>we start to create new depen&shy;den&shy;cies which we got rid of by calling an inter&shy;me&shy;diate layer.</li>
</ul>
<div class="paragraph-container">
<div class="paragraph-left-side">12</div>
<p>However&shy;, there is another conc&shy;lu&shy;sion resul&shy;ting from this one: we should use <code>catch</code> in the <code>Do&shy;Something&shy;Wild</code> method. And this is slightly strange for us: <code>Wild&shy;Investment</code> is sort of hardly depen&shy;dent on something. I mean if <code>Play&shy;Russian&shy;Roulette</code> didn’t work, the same will happen to <code>Do&shy;Something&shy;Wild</code>: it doesn’t have return codes, but it has to play the roulette. So&shy;, what we can do in such a see&shy;mingly hop&shy;eless situ&shy;a&shy;tion? The answer is actu&shy;ally simple: being on another level <code>Do&shy;Something&shy;Wild</code> should throw its own excep&shy;tion that belongs to this level and wrap it in <code>Inner&shy;Exception</code> as the ori&shy;ginal source of a problem:</p>
<div class="paragraph-right-side">12</div>
</div>
<div class="lang-csharp editor-colors"><div style="color:Black;background-color:White;"><pre>

<span style="color:Blue;">namespace</span> JetFinance.Strategies
{
    pubilc <span style="color:Blue;">class</span> WildStrategy
    {
        <span style="color:Blue;">private</span> Random random =  <span style="color:Blue;">new</span> Random();

        <span style="color:Blue;">public</span> <span style="color:Blue;">void</span> PlayRussianRoulette()
        {
            <span style="color:Blue;">if</span>(DateTime.Now.Second == (random.Next() % 60))
            {
                <span style="color:Blue;">throw</span> <span style="color:Blue;">new</span> StrategyException();
            }
        }
    }

    <span style="color:Blue;">public</span> <span style="color:Blue;">class</span> StrategyException : Exception { <span style="color:Green;">/* .. */</span> }
}

<span style="color:Blue;">namespace</span> JetFinance.Investments
{
    <span style="color:Blue;">public</span> <span style="color:Blue;">class</span> WildInvestment
    {
        WildStrategy _strategy;

        <span style="color:Blue;">public</span> WildInvestment(WildStrategy strategy)
        {
            _strategy = strategy;
        }

        <span style="color:Blue;">public</span> <span style="color:Blue;">void</span> DoSomethingWild()
        {
            <span style="color:Blue;">try</span>
            {
                _strategy.PlayRussianRoulette();
            }
            <span style="color:Blue;">catch</span>(StrategyException exception)
            {
                <span style="color:Blue;">throw</span> <span style="color:Blue;">new</span> FailedInvestmentException(<span style="color:#A31515;">&quot;Oops&quot;</span>, exception);
            }
        }
    }

    <span style="color:Blue;">public</span> <span style="color:Blue;">class</span> InvestmentException : Exception { <span style="color:Green;">/* .. */</span> }

    <span style="color:Blue;">public</span> <span style="color:Blue;">class</span> FailedInvestmentException : Exception { <span style="color:Green;">/* .. */</span> }
}

<span style="color:Blue;">using</span> JetFinance.Investments;

<span style="color:Blue;">void</span> Main()
{
    <span style="color:Blue;">var</span> foo = <span style="color:Blue;">new</span> WildStrategy();
    <span style="color:Blue;">var</span> boo = <span style="color:Blue;">new</span> WildInvestment(foo);

    <span style="color:Blue;">try</span>
    {
        boo.DoSomethingWild();
    }
    <span style="color:Blue;">catch</span>(FailedInvestmentException exception)
    {
    }
}
</pre></div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">13</div>
<p>By wrap&shy;ping one excep&shy;tion in another we transfer the problem form one level of appli&shy;ca&shy;tion to another and make its work more predic&shy;table in terms of a consumer of this class: the <code>Main</code> method.</p>
<div class="paragraph-right-side">13</div>
</div>
<h3 id="based-on-reuse-issues">Based on reuse issues</h3>
<div class="paragraph-container">
<div class="paragraph-left-side">14</div>
<p>Often we feel too lazy to create a new type of excep&shy;tion but when we decide to do it, it is not always clear which type to base on. But it is preci&shy;sely these deci&shy;sions that define the whole arch&shy;it&shy;ecture of excep&shy;ti&shy;onal situ&shy;a&shy;tions. Let’s have a look at some popular solu&shy;tions and make some conc&shy;lu&shy;sions.</p>
<div class="paragraph-right-side">14</div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">15</div>
<p>When choosing the type of excep&shy;tion we can use a previously made solu&shy;tion, i.e. to find an excep&shy;tion with the name that contains similar sense and use it. For example, if we got an entity via a para&shy;meter and we don’t like this entity, we can throw <code>Invalid&shy;Argument&shy;Exception</code>, indi&shy;ca&shy;ting the cause of an error in Message&shy;. This scenario looks good espe&shy;ci&shy;ally since <code>Invalid&shy;Argument&shy;Exception</code> is in the group of excep&shy;tions that may not be caught. However&shy;, the choice of <code>Invalid&shy;Data&shy;Exception</code> will be wrong if you work with some data types. It is because this type is in <code>System&shy;.IO</code> area, which is probably isn’t what you deal with. Thus&shy;, it will almost always be wrong to search for an exis&shy;ting type instead of deve&shy;lo&shy;ping one by your&shy;self. There are almost no excep&shy;tions for a general range of tasks. Virtu&shy;ally all of them are for specific situ&shy;a&shy;tions and if you reuse them in other cases, it will gravely vio&shy;late the arch&shy;it&shy;ecture of excep&shy;ti&shy;onal situ&shy;a&shy;tions. Moreover&shy;, an excep&shy;tion of a parti&shy;cular type (for example, <code>System&shy;.IO.Invalid&shy;Data&shy;Exception</code>) can confuse a user: on the one hand, he will see that excep&shy;tion belongs to the <code>System&shy;.IO</code> names&shy;pace, while on the other hand it is thrown from a comp&shy;le&shy;tely diffe&shy;rent names&shy;pace. If this user starts thinking about the rules of throwing this excep&shy;tion, he may go to <a href="https://referencesource.microsoft.com/">refe&shy;ren&shy;ce&shy;so&shy;urce.micro&shy;soft.com</a> and find <a href="https://referencesource.microsoft.com/#System/sys/System/IO/compression/InvalidDataException.cs,2b389f14fb01ad1b,references">all the places where it is thrown</a>:</p>
<div class="paragraph-right-side">15</div>
</div>
<ul>
<li><code>internal class System&shy;.IO.Compression&shy;.Inflater</code></li>
</ul>
<div class="paragraph-container">
<div class="paragraph-left-side">16</div>
<p>The user will unders&shy;tand that <del>some&shy;body is all thumbs</del> this type of excep&shy;tion confused him as the method that threw this excep&shy;tion didn’t deal with comp&shy;res&shy;sion.</p>
<div class="paragraph-right-side">16</div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">17</div>
<p>Also&shy;, in terms of reuse, you can simply create one excep&shy;tion and declare the <code>Error&shy;Code</code> field in it. That seems like a good idea. You just throw the same excep&shy;tion, setting the code, and use just one <code>catch</code> to deal with excep&shy;tions, incre&shy;a&shy;sing the stabi&shy;lity of an appli&shy;ca&shy;tion, nothing more. However&shy;, I believe you should rethink this posi&shy;tion. Of course, this approach makes life easier on the one hand. However&shy;, on the other hand, you dismiss the possi&shy;bi&shy;lity to catch a subgroup of excep&shy;tions that have some common fea&shy;ture. For example, <code>Argument&shy;Exception</code> that unites a bunch of excep&shy;tions by inhe&shy;ri&shy;tance. Another serious disad&shy;van&shy;tage is an exces&shy;si&shy;vely large and unre&shy;adable code that must arrange error code based filte&shy;ring. However&shy;, intro&shy;du&shy;cing an encom&shy;pas&shy;sing type with an error code will be more approp&shy;riate when a user doesn’t have to care about specif&shy;ying an error.</p>
<div class="paragraph-right-side">17</div>
</div>
<div class="lang-csharp editor-colors"><div style="color:Black;background-color:White;"><pre>
<span style="color:Blue;">public</span> <span style="color:Blue;">class</span> ParserException
{
    <span style="color:Blue;">public</span> ParserError ErrorCode { <span style="color:Blue;">get</span>; }

    <span style="color:Blue;">public</span> ParserException(ParserError errorCode)
    {
        ErrorCode = errorCode;
    }

    <span style="color:Blue;">public</span> <span style="color:Blue;">override</span> <span style="color:Blue;">string</span> Message
    {
        <span style="color:Blue;">get</span> {
            <span style="color:Blue;">return</span> Resources.GetResource($<span style="color:#A31515;">&quot;{nameof(ParserException)}{Enum.GetName(typeof(ParserError), ErrorCode)}&quot;</span>);
        }
    }
}

<span style="color:Blue;">public</span> <span style="color:Blue;">enum</span> ParserError
{
    MissingModifier,
    MissingBracket,
    <span style="color:Green;">// ...</span>
}

<span style="color:Green;">// Usage</span>
<span style="color:Blue;">throw</span> <span style="color:Blue;">new</span> ParserException(ParserError.MissingModifier);
</pre></div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">18</div>
<p>The code that protects the parser call doesn’t care why parsing failed: it is inte&shy;rested in the error as such. However&shy;, if the cause of fail becomes impor&shy;tant after all, a user can always get the error code from the <code>Error&shy;Code</code> property. And you really don’t have to search for neces&shy;sary words in a substring of <code>Message</code>.</p>
<div class="paragraph-right-side">18</div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">19</div>
<p>If we don’t choose to reuse, we can create a type of excep&shy;tion for every situ&shy;a&shy;tion. On the one hand, it sounds logical: one type of error – one type of excep&shy;tion. However&shy;, don’t overdo: having too many types of excep&shy;tions will cause the problem of catching them as the code of a calling method will be over&shy;lo&shy;aded with <code>catch</code> blocks. Because it needs to process all types of excep&shy;tions that you want to pass to it. Another disad&shy;van&shy;tage is purely arch&shy;it&shy;ectural. If you don’t use excep&shy;tions, you confuse those who will use these excep&shy;tions: they may have many things in common but will be caught sepa&shy;ra&shy;tely.</p>
<div class="paragraph-right-side">19</div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">20</div>
<p>However&shy;, there are great scena&shy;rios to intro&shy;duce sepa&shy;rate types for specific situ&shy;a&shy;tions. For example, when the error affects not a whole entity, but a specific method. Then this error type should take such a place in the hierarchy of inhe&shy;ri&shy;tance that no one would ever think to catch it together with something else: for example, through a sepa&shy;rate branch of inhe&shy;ri&shy;tance.</p>
<div class="paragraph-right-side">20</div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">21</div>
<p>Also&shy;, if you combine both of these appro&shy;aches, you can get a powerful set of inst&shy;ruments to work with a group of errors: you can intro&shy;duce a common abstract type and inherit specific cases from it. The base class (our common type) must get an abstract property, designed to store an error code while inhe&shy;ri&shy;tors will specify this code by over&shy;ri&shy;ding this property.</p>
<div class="paragraph-right-side">21</div>
</div>
<div class="lang-csharp editor-colors"><div style="color:Black;background-color:White;"><pre>
<span style="color:Blue;">public</span> <span style="color:Blue;">abstract</span> <span style="color:Blue;">class</span> ParserException
{
    <span style="color:Blue;">public</span> <span style="color:Blue;">abstract</span> ParserError ErrorCode { <span style="color:Blue;">get</span>; }

    <span style="color:Blue;">public</span> <span style="color:Blue;">override</span> <span style="color:Blue;">string</span> Message
    {
        <span style="color:Blue;">get</span> {
            <span style="color:Blue;">return</span> Resources.GetResource($<span style="color:#A31515;">&quot;{nameof(ParserException)}{Enum.GetName(typeof(ParserError), ErrorCode)}&quot;</span>);
        }
    }
}

<span style="color:Blue;">public</span> <span style="color:Blue;">enum</span> ParserError
{
    MissingModifier,
    MissingBracket
}

<span style="color:Blue;">public</span> <span style="color:Blue;">class</span> MissingModifierParserException : ParserException
{
    <span style="color:Blue;">public</span> <span style="color:Blue;">override</span> ParserError ErrorCode { <span style="color:Blue;">get</span>; } =&gt; ParserError.MissingModifier;
}

<span style="color:Blue;">public</span> <span style="color:Blue;">class</span> MissingBracketParserException : ParserException
{
    <span style="color:Blue;">public</span> <span style="color:Blue;">override</span> ParserError ErrorCode { <span style="color:Blue;">get</span>; } =&gt; ParserError.MissingBracket;
}

<span style="color:Green;">// Usage</span>
<span style="color:Blue;">throw</span> <span style="color:Blue;">new</span> MissingModifierParserException(ParserError.MissingModifier);
</pre></div>
</div>
<p>Using this approach we get some wonderful proper&shy;ties:</p>
<ul>
<li>on the one hand, we keep catching excep&shy;tions using a base (common) type;</li>
<li>on the other hand, even catching excep&shy;tions with this base type we are still able to iden&shy;tify a specific situ&shy;a&shy;tion;</li>
<li>plus, we can catch excep&shy;tions via a specific type instead of a base type without using the flat struc&shy;ture of classes.</li>
</ul>
<p>I think it is very conve&shy;nient.</p>
<h3 id="based-on-belonging-to-a-specific-group-of-behavioral-situations">Based on belon&shy;ging to a specific group of beh&shy;a&shy;vioral situ&shy;a&shy;tions</h3>
<div class="paragraph-container">
<div class="paragraph-left-side">22</div>
<p>What conc&shy;lu&shy;sions can we make based on the previous rea&shy;so&shy;ning? Let’s try to define them.</p>
<div class="paragraph-right-side">22</div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">23</div>
<p>First of all, let’s decide what means a situ&shy;a&shy;tion? Usually&shy;, we talk about classes and objects in terms of enti&shy;ties with some internal state and we can perform actions on these enti&shy;ties. Thus&shy;, the first type of beh&shy;a&shy;vioral situ&shy;a&shy;tion includes actions on some entity. Next&shy;, if we look at an object graph from the outside we will see that it is logi&shy;cally repre&shy;sented as a combi&shy;na&shy;tion of functi&shy;onal groups: the first group deals with caching, the second works with data&shy;bases, the third performs math&shy;em&shy;at&shy;ical calcu&shy;la&shy;tions. Diffe&shy;rent layers can go through all these groups, e.g. layers of internal states logging, process logging, and method calls’ tracing. Layers can encom&shy;pass several functi&shy;onal groups. For example, there can be a layer of a model, a layer of cont&shy;rol&shy;lers and a presen&shy;ta&shy;tion layer. These groups can be in one assembly or in diffe&shy;rent ones, but each group can create its own excep&shy;ti&shy;onal situ&shy;a&shy;tions.</p>
<div class="paragraph-right-side">23</div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">24</div>
<p>So&shy;, we can build a hierarchy for the types of excep&shy;ti&shy;onal situ&shy;a&shy;tions based on the belon&shy;ging of these types to one or another group or layer. Thus&shy;, we allow a catching code to easily navi&shy;gate among these types in the hierarchy.</p>
<div class="paragraph-right-side">24</div>
</div>
<p>Let’s exa&shy;mine the follo&shy;wing code:</p>
<div class="lang-csharp editor-colors"><div style="color:Black;background-color:White;"><pre>

<span style="color:Blue;">namespace</span> JetFinance
{
    <span style="color:Blue;">namespace</span> FinancialPipe
    {
        <span style="color:Blue;">namespace</span> Services
        {
            <span style="color:Blue;">namespace</span> XmlParserService
            {
            }

            <span style="color:Blue;">namespace</span> JsonCompilerService
            {
            }

            <span style="color:Blue;">namespace</span> TransactionalPostman
            {
            }
        }
    }

    <span style="color:Blue;">namespace</span> Accounting
    {
        <span style="color:Green;">/* ... */</span>
    }
}

</pre></div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">25</div>
<p>What’s it like? I think the names&shy;pace is a perfect way to natu&shy;rally group the types of excep&shy;tions based on the beh&shy;a&shy;vioral situ&shy;a&shy;tions: everything that belongs to parti&shy;cular groups should stay there, inclu&shy;ding excep&shy;tions. Moreover&shy;, when you get a parti&shy;cular excep&shy;tion, you will see the name of its type and also its names&shy;pace that will specify a group it belongs to. Do you remember the bad reuse of <code>Invalid&shy;Data&shy;Exception</code> which is actu&shy;ally defined in the <code>System&shy;.IO</code> names&shy;pace? The fact that it belongs to this names&shy;pace means this type of excep&shy;tion can be thrown from classes that are in the <code>System&shy;.IO</code> names&shy;pace or in a more nested one. But the actual excep&shy;tion was thrown from a comp&shy;le&shy;tely diffe&shy;rent space, confu&shy;sing a person that han&shy;dles the issue. However&shy;, if you put the types of excep&shy;tions and the types that throw these excep&shy;tions in the same names&shy;paces you keep the arch&shy;it&shy;ecture of types consis&shy;tent and make it easier for deve&shy;lo&shy;pers to unders&shy;tand the rea&shy;sons for what happens.</p>
<div class="paragraph-right-side">25</div>
</div>
<p>What is the second way for grou&shy;ping on the level of code? Inheritance&shy;:</p>
<div class="lang-csharp editor-colors"><div style="color:Black;background-color:White;"><pre>

<span style="color:Blue;">public</span> <span style="color:Blue;">abstract</span> <span style="color:Blue;">class</span> LoggerExceptionBase : Exception
{
    <span style="color:Blue;">protected</span> LoggerException(..);
}

<span style="color:Blue;">public</span> <span style="color:Blue;">class</span> IOLoggerException : LoggerExceptionBase
{
    <span style="color:Blue;">internal</span> IOLoggerException(..);
}

<span style="color:Blue;">public</span> <span style="color:Blue;">class</span> ConfigLoggerException : LoggerExceptionBase
{
    <span style="color:Blue;">internal</span> ConfigLoggerException(..);
}

</pre></div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">26</div>
<p>Note that for usual appli&shy;ca&shy;tion enti&shy;ties, they inherit both beh&shy;avior and data and group types that belong to a <em>single group of enti&shy;ties</em>. However&shy;, for excep&shy;tions, they inherit and are grouped based on a <em>single group of situ&shy;a&shy;tions</em>, because the essence of an excep&shy;tion is not an entity but a problem.</p>
<div class="paragraph-right-side">26</div>
</div>
<p>Combi&shy;ning these two grou&shy;ping methods we can make the follo&shy;wing conc&shy;lu&shy;sions:</p>
<ul>
<li>there should be a base type of excep&shy;tions inside <code>Assembly</code> that will be thrown by this assembly. This type of excep&shy;tions should be in a root names&shy;pace of the assembly. This will be the first layer of grou&shy;ping.</li>
<li>further, there can be one or several names&shy;paces inside an assembly. Each of them divides the assembly into functi&shy;onal zones, defi&shy;ning the groups of situ&shy;a&shy;tions, that appear in this assembly. These may be zones of cont&shy;rol&shy;lers, data&shy;base enti&shy;ties, data proces&shy;sing algo&shy;rithms, etc. For us, these names&shy;paces mean grou&shy;ping types based on their function. However&shy;, in terms of excep&shy;tions they are grouped based on prob&shy;lems within the same assembly;</li>
<li>excep&shy;tions must be inhe&shy;rited from types in the same upper-level names&shy;pace. This ensures that end user will unam&shy;bi&shy;guously unders&shy;tand situ&shy;a&shy;tions and won’t catch <em>wrong</em> type based excep&shy;tions. Admit&shy;, it would be strange to catch <code>global::Finiki&shy;.Logistics&shy;.Oh&shy;My&shy;Exception</code> by <code>catch(global::Legacy&shy;.Logger&shy;Exeption excep&shy;tion)</code>, while the follo&shy;wing code looks abso&shy;lu&shy;tely approp&shy;riate:</li>
</ul>
<div class="lang-csharp editor-colors"><div style="color:Black;background-color:White;"><pre>
<span style="color:Blue;">namespace</span> JetFinance.FinancialPipe
{
    <span style="color:Blue;">namespace</span> Services.XmlParserService
    {
        <span style="color:Blue;">public</span> <span style="color:Blue;">class</span> XmlParserServiceException : FinancialPipeExceptionBase
        {
            <span style="color:Green;">// ..</span>
        }

        <span style="color:Blue;">public</span> <span style="color:Blue;">class</span> Parser
        {
            <span style="color:Blue;">public</span> <span style="color:Blue;">void</span> Parse(<span style="color:Blue;">string</span> input)
            {
                <span style="color:Green;">// ..</span>
            }
        }
    }

    <span style="color:Blue;">public</span> <span style="color:Blue;">abstract</span> <span style="color:Blue;">class</span> FinancialPipeExceptionBase : Exception
    {

    }
}

<span style="color:Blue;">using</span> JetFinance.FinancialPipe;
<span style="color:Blue;">using</span> JetFinance.FinancialPipe.Services.XmlParserService;

<span style="color:Blue;">var</span> parser = <span style="color:Blue;">new</span> Parser();

<span style="color:Blue;">try</span> {
    parser.Parse();
}
<span style="color:Blue;">catch</span> (XmlParserServiceException exception)
{
    <span style="color:Green;">// Something is wrong in the parser</span>
}
<span style="color:Blue;">catch</span> (FinancialPipeExceptionBase exception)
{
    <span style="color:Green;">// Something else is wrong. Looks critical because we don&#39;t know the real reason</span>
}

</pre></div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">27</div>
<p>Here&shy;, the user code calls a library method that, as we know, can throw <code>Xml&shy;Parser&shy;Service&shy;Exception</code> in some situ&shy;a&shy;tion. And&shy;, as we know, this excep&shy;tion refers to the inhe&shy;rited names&shy;pace <code>Jet&shy;Finance&shy;.Financial&shy;Pipe&shy;.Financial&shy;Pipe&shy;Exception&shy;Base</code>, which means that there may be some other excep&shy;tions — this time <code>Xml&shy;Parser&shy;Service</code> micro&shy;ser&shy;vice creates only one excep&shy;tion but other excep&shy;tions may appear in future. As we have a conven&shy;tion for crea&shy;ting types of excep&shy;tions, we know what entity this new excep&shy;tion will be inhe&shy;rited from and put an encom&shy;pas&shy;sing <code>catch</code> in advance. That enables us to skip all things irre&shy;le&shy;vant to us.</p>
<div class="paragraph-right-side">27</div>
</div>
<p>How to build such a hierarchy of types?</p>
<ul>
<li>First of all, we should create a base class for a domain. Let’s call it a domain base class. In this case, a domain is a word that encom&shy;passes a number of assem&shy;blies, combi&shy;ning them based on some fea&shy;ture: logging, busi&shy;ness-logic, UI. I mean functi&shy;onal zones of an appli&shy;ca&shy;tion that are as large as possible.</li>
<li>Next&shy;, we should intro&shy;duce an addi&shy;ti&shy;onal base class for excep&shy;tions which must be caught: all the excep&shy;tions that will be caught using the <code>catch</code> keyword will be inhe&shy;rited from this base class;</li>
<li>All the excep&shy;tions indi&shy;ca&shy;ting fatal errors should be inhe&shy;rited directly from a domain base class. Thus we will sepa&shy;rate them from those caught on the arch&shy;it&shy;ecture level;
– Divide the domain into functi&shy;onal areas based on names&shy;paces and declare the base type of excep&shy;tions that will be thrown from each area. Here it is neces&shy;sary to use common sense: if an appli&shy;ca&shy;tion has a high degree of names&shy;pace nesting, you shouldn’t do a base type for each nesting level. However&shy;, if there is branching at a nesting level when one group of excep&shy;tions goes to one names&shy;pace and another group goes to another names&shy;pace, it is neces&shy;sary to use two base types for each subgroup;</li>
<li>Special excep&shy;tions should be inhe&shy;rited from the types of excep&shy;tions belon&shy;ging to functi&shy;onal areas</li>
<li>If a group of special excep&shy;tions can be combined, it is neces&shy;sary to do it in one more base type: thus you can catch them easier;</li>
<li>If you suppose the group will be more often caught using a base class, intro&shy;duce Mixed Mode with Error&shy;Code&shy;.</li>
</ul>
<h3 id="based-on-the-source-of-an-error">Based on the source of an error</h3>
<div class="paragraph-container">
<div class="paragraph-left-side">28</div>
<p>The source of an error can be another basis to combine excep&shy;tions in a group. For example, if you design a class library, the follo&shy;wing things can form groups of sources:</p>
<div class="paragraph-right-side">28</div>
</div>
<ul>
<li>unsafe code call with an error. This situ&shy;a&shy;tion can be dealt with by wrap&shy;ping an excep&shy;tion or an error code in its own type of excep&shy;tion while saving returned data (for example the ori&shy;ginal error code) in a public property of the excep&shy;tion;</li>
<li>a call of code by external depen&shy;den&shy;cies, which has thrown excep&shy;tions that can’t be caught by our library as they are beyond its area of respon&shy;si&shy;bi&shy;lity. This group can include excep&shy;tions from the methods of those enti&shy;ties that were accepted as the para&shy;me&shy;ters of a current method or excep&shy;tions from the const&shy;ructor of a class which method has called an external depen&shy;dence. For example, a method of our class has called a method of another class, the instance of which was returned via para&shy;me&shy;ters of another method. If an excep&shy;tion indi&shy;cates that we are the source of a problem, we should gene&shy;rate our own excep&shy;tion while reta&shy;i&shy;ning the ori&shy;ginal one in <code>Inner&shy;Excepton</code>. However&shy;, if we unders&shy;tand that the problem has been caused by an external depen&shy;dency we ignore this excep&shy;tion as belon&shy;ging to a group of external depen&shy;den&shy;cies beyond our control;</li>
<li>our own code that was acci&shy;den&shy;tally put in an incon&shy;sis&shy;tent state. A good example is text parsing — no external depen&shy;den&shy;cies, no transfer to <code>unsafe</code> world, but a problem of parsing occurs.</li>
</ul>

        </div>
        <footer>
            <div class="footer-container">
                <div class="footer-wrap">
                    <img src="../../res/img/logo-w-noindex.svg">
                    <p>
                        <a class="footer-link" target="_blank" href="mailto:sidristij@clrium.ru"><i class="far fa-envelope" aria-hidden="true"></i></a>
                        <a class="footer-link" target="_blank" href="https://vk.com/clrium"><i class="fab fa-vk" aria-hidden="true"></i></a>
                        <a class="footer-link" target="_blank" href="https://youtube.com/clrium"><i class="fab fa-youtube" aria-hidden="true"></i></a>
                        <a class="footer-link" target="_blank" href="https://github.com/clrium"><i class="fab fa-github" aria-hidden="true"></i></a>
                        <a class="footer-link" target="_blank" href="skype:stanislav.sidristyi"><i class="fab fa-skype" aria-hidden="true"></i></a>
                        <a class="footer-link" target="_blank" href="https://t.me/clrium_group"><i class="fab fa-telegram" aria-hidden="true"></i></a>
                    </p>
                </div>
            </div>
        </footer>
    </div>
</body>
</html>