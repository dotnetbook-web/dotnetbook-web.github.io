<!DOCTYPE html>
<html lang="ru">
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>.NET Platform Architecture</title>
</head>
<body>
    <link rel="stylesheet" href="../../res/bootstrap.css">
    <link rel="stylesheet" href="../../res/awesome.css">
    <style>
        body {
    font-family: PF Regal,Georgia,serif;
    font-size: 16pt;
    font-weight: 300;
    padding-top: 4em;
}

.book-title-container {
    width: 100%;
    text-align: center;
    margin: 73px 0 110px 0;
}

.book-title {
    font-size: 57pt;
    margin: 50px 0 70px 0;
    user-select: none;
}
.book-part-title-block {
    display: inline-block;
}
.book-part-title {
    font-size: 21pt;
    color: #656ab6;
    margin: 0 7px;
}

.book-part-title:hover {
    box-shadow: inset 0 -1px #007bff;
    text-decoration: none;
}

.book-superheading-title {
    font-size: 15pt;
    margin: 0 7px;
    color: #656ab6;
}

.article-container
{
    width: 62%;
}

strong {
    font-weight: 500;
}

p, li {
    margin: 0 0 1em;
    line-height: 1.5em;
    font-family: inherit;
}

ol, li {
    margin-top: 1em;
    margin-bottom: 1em;
}

ol {
    padding-left: 1.21em;
}

ul  {
    padding-left: 1em;
}

ol li, ul li {
    padding-left: 0.5em;	
    font-family: inherit;
    text-align: justify;
}

table {
    margin: 30px 0;
    width: 100%;
}

thead {
    background-color: aliceblue;
}

table th {
    font-weight: 400;
}

table td, table th {
    padding: 7px;
    border-top: solid darkgrey 1px;
    border-bottom: solid darkgrey 1px;
    border-right: dotted darkgray 1px;
    border-left: dotted darkgray 1px;
    font-size: smaller;
}

code, *[class*='lang-'] span, *[class*='lang-'] pre {
    font-family: JB Mono, monospace !important;
}

*[class*='lang-'] {
    padding: 0px 0px 25px 0px;
    font-size: 0.75em;
}


*[class*='lang-'] > div, pre > code {
    border-left-color: #eee;
    border-left-style: dotted;
    border-left-width: 3px;
    padding-left: 25px;
    display: block;
    padding-top: 20px;
    padding-bottom: 20px;
}

*[class*='lang-'] > div pre, pre > code pre {
    margin-bottom: 0;
}

p code:not(.highlight), li code:not(.highlight) {
    font-size: 0.7em;
    border: gainsboro;
    border-width: 1px;
    border-style: solid;
    padding: 3px;
    color: darkslateblue;
}

code.highlight {
    font-family: inherit !important;
    font-size: inherit;
    font-weight: inherit;
    color: inherit;
}

p code.highlight, li code.highlight {
    padding: 4px;
    background-color: #ffffa1;
}

.wide {
    width:140%;
}

p a, li a {
    text-decoration: none;
    color: inherit;
    box-shadow: inset 0 -1px #b88b59;
}

p a:hover, li a:hover {
    text-decoration: none;
    color: inherit;
    box-shadow: inset 0 -1px #0056b3;
}

blockquote h5 {
    background-color: aquamarine;
    margin: 16px 0 16px -20px;
    padding: 15px 30px 15px;
}

p img {
    width: 95%;
}

blockquote 
{
    padding-left: 0.4em;
    border-left: 0.5em solid rgba(0,0,0,.08);
    font-style: italic;
}

blockquote.big-quote, 
blockquote.breadcrumbs 
{
    background-color: transparent;
    padding: 0;
    border-left: none;
    font-style: normal;
}

blockquote.breadcrumbs, blockquote.breadcrumbs  p
{
    margin: 0;
    padding: 0;
}

blockquote p {
    padding: 1em 1em 1em 0.6em;
    font-family: inherit;
}

blockquote p code {
    font-family: consolas, monospace;
    font-size: 17px;
    padding: 4px 6px;
}

blockquote p em {
    font-weight: 400;
}

blockquote.big-quote > p {
    margin: 0.7em 0 0.7em 0;
    font-family: Charter;
    font-size: 2.5em;
    padding: 0;
    width: 130%;
    line-height: 1em;
}

h1, h2, h3, h4, h5, h6 {
    margin: 0;
    padding: 0;
    font-weight: 400;
    font-family: inherit;
}

h1 {
    font-size: 2.2em;
    font-family: Charter,Georgia,serif;
    font-weight: 300;
    margin: 1.8em 0 1.8em 0;
    text-align: center;
    width: 140%;
}

h2 {
    margin-top: 2em;
    font-family: Charter,Arial,Helvetica Neue,sans-serif;
    font-size: 1.25em;
    width: 70%;
}

h3 {
    margin: 30px 0 15px 0;
    font-size: 17pt;
    font-weight: 500;
}

h4 {
    margin: 20px 0 10px 0;
    font-size: 16pt;
    font-weight: 500;
    font-style: italic;
}

/* Sidenotes */

.aside-container {
    position: relative;
}
.aside-container p {
    position: relative;
    top: 9px;
}

.aside-container > .aside-side-container {
    display: block;
    position: absolute;
    top: 12px;
    left: 96%;
    width: 34%;
    font-size: 12pt;
    line-height: 20px;
    margin-left: 100px;
    z-index: 1000;
}

.aside-container > .aside-side-container p {
    line-height: 24px;
    font-size: 13pt;
    margin: 0 0 13px 0;
}

.side-regular-block p {
    top: 0;
}

/* Music side player */
.aside-side-container .music-player {
    width: 100%;
    height: 400px;
}

/* media block after h1 */
.aside-container h1 + .aside-side-container.side-media-block h2 {
    margin: 7em 0 1em 0;
    font-family: Proxima Nova,Arial,Helvetica Neue,sans-serif;
    font-weight: 600;
}

.aside-side-container > li {
    display: block;
    font-family: Charter;
}

.aside-side-container > li ul, .aside-side-container > li ol {
    padding-left: 30px;
    margin-top: 0.5em;
    margin-bottom: 0.5em;
}
.aside-side-container > li li {
    padding-left: 6px;
    margin: 0 0 6px;
    line-height: 22px;

    font-family: Charter;
}

.aside-side-container p {
    line-height: 25px;
    font-size: 13pt;
    margin: 0 0 15px 0;
}

.aside-side-container blockquote {
    border: aliceblue;
    border-left-style: solid;
}

/* Paragraphs numbering */
.paragraph-container {
    position: relative;
}
.paragraph-container p {
    position: relative;
    top: 9px;
}

.paragraph-container p, .aside-container > p {
    text-align: justify;
}

.paragraph-container > .paragraph-left-side, .paragraph-container > .paragraph-right-side  {
    font-family: JB Mono, consolas;
    display: block;
    position: absolute;
    top: 17px;
    font-size: 10pt;
    line-height: 20px;
    color: #86abc473;
    z-index: 1000;
}
.paragraph-container > .paragraph-left-side {
    display: none;
    left: -2.1cm;
    width: 35px;
    user-select: none;
}

.paragraph-container > .paragraph-right-side  {
    display: none;
    left: 100%;
    width: 35px;
    padding-left: 45px;
    user-select: none;
}

.article-container
{
    width: 70%;
}

.menu-title {
    text-align: center;
    margin: 35px 50px 35px 50px;
    font-size: 24pt;
    font-family: Charter;
}

.menu-container ol {
    margin: 0;
    padding: 0;
}

.menu-container ol li {
    margin: 0;
    padding: 0;
}

.header {
    height: 4em;
    background-color: white;
    position: relative;
    z-index: 10;
    width: 100%;
    display: flex;
    justify-content: space-between;
    transition: all 1s;
    top: 0;
    box-shadow: 1px -4px 20px rgba(0, 0, 0, .1);
}

.fixed {
    position: fixed !important;
}

.header > .menu {
    pointer-events: auto;
    float: right;
    height: 40px;
    font-family: Charter, 'Helvetica Neue', Arial, sans-serif;
    font-size: 1em;
    color: #fff;
    margin-top:40px;
    margin-right:40px;
}

.menu a {
    color: #fff;
}
.menu a:hover {
    text-decoration: none;
    color: #fff;
}

#menu__toggle {
    opacity: 0;
}

#menu__toggle:checked ~ .menu__btn > span {
    transform: rotate(45deg);
}
#menu__toggle:checked ~ .menu__btn > span::before {
    top: 0;
    transform: rotate(0);
    background-color: black
}
#menu__toggle:checked ~ .menu__btn > span::after {
    top: 0;
    transform: rotate(90deg);
    background-color: black
}
#menu__toggle:checked ~ .menu__box {
    visibility: visible;
    right: 0;
}

.menu__btn {
    display: flex;
    align-items: center;
    position: fixed;
    top: 0;
    right: 0;
    width: 1.4em;
    height: 1.0em;
    cursor: pointer;
    z-index: 1;
    margin: 1.5em;
}

.menu__btn > span,
.menu__btn > span::before,
.menu__btn > span::after {
    display: block;
    position: absolute;

    width: 100%;
    height: 1px;

    background-color: black;

    transition-duration: .25s;
}
.menu__btn > span::before {
    content: '';
    top: -8px;
}
.menu__btn > span::after {
    content: '';
    top: 8px;
}

.menu__box {
    display: block;
    position: fixed;
    visibility: hidden;
    top: 0;
    right: -100%;

    width: 100%;
    height: 100%;

    margin: 0;
    padding: 80px 0;

    list-style: none;

    background-color: white;
    box-shadow: 1px 0px 6px rgba(0, 0, 0, .2);

    transition-duration: .25s;
}
.menu__box li a:hover {
    text-decoration: none;
    color: inherit;
}
.menu__item {
    display: block;
    padding: 12px 24px;

    color: #333;

    font-family: 'Gotham Pro','Roboto', sans-serif;
    font-size: 20px;
    font-weight: 600;

    text-decoration: none;

    transition-duration: .25s;
}
.menu__item:hover {
    background-color: #CFD8DC;
}


.conflogo {
    height: 1.2em;
    margin-top: 1.4em;
    margin-left: 1em;
}

.invisible {
    display: none;
}

.header > .menu > div {
    display: inline;
    margin-left: 10px;
    margin-right: 10px;
}

footer {
    margin-top: 2em;
    background-color: black;
    height: 4em;
}

.footer-container {
    height: 100%;
}

.footer-wrap {
    color: #fff;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 25px 0;
}

.footer-wrap p {
    margin: 0;
    padding: 0px;
    line-height: 1em;
}

.footer-container img {
    height: 1.6em;
    margin-top: auto;
    margin-bottom: auto;
}

.footer-link {
    color: white;
    margin: 0 7px;
    font-size: 1em;
    box-shadow: none;
}
.footer-link:hover {
    color: salmon;
    box-shadow: none;
}

/* MEDIA */
/* XXL */
@media (min-width: 1601px) {
    .book-container
    {
        max-width: 1200px;
        margin-left: auto;
        margin-right: auto;
    }
}

/* XL */
@media (max-width: 1600px) {
    .book-container
    {
        margin-left: 4cm;
        margin-right: 4cm;
    }
}

/* LG */
@media (max-width: 1400px) {
    .book-container
    {
        margin-left: 4cm;
        margin-right: 4cm;
    }

    blockquote.big-quote > p {
        font-size: 2em;
    }
}

/* > MD */
@media (min-width: 992px) {
    .hamburger-menu {
        display: none;
    }
}

/* MD */
@media (max-width: 991px) {
    
    h2 {
        width:80%;
    }

    .book-container
    {
        margin-left: 3cm;
        margin-right: 3cm;
    }
    
    .book-title-container {
        margin: 73px 0 110px 0;
    }

    .book-title {
        font-size: 50pt;
        margin: 50px 0 70px 0;
    }

    .book-part-title {
        font-size: 19pt;
    }

    .book-part-title:hover {
        box-shadow: inset 0 -1px #007bff;
    }

    .book-superheading-title {
        font-size: 15pt;
    }                                     

    .article-container, h1 {
        width: 100%;
    }

    .aside-container p {
        top: 0;
    }

    .aside-container h1 + .aside-side-container.side-media-block h2 {
        display: none;
    }

    .wide {
        width: 100%;     
    }

    .side-regular-block {
        margin: 40px 10px;
        padding-left: 100px;
    }
    .aside-side-container .music-player {
        width: 100%;
        height: 100px;
    }
    .aside-side-container.side-media-block {
        padding: 17px 0;
    }
    .aside-side-container.side-media-block h2 {
        margin-top: 20px;
        font-size: 13pt;
        border: none;
    }

    .aside-container > .aside-side-container
    {
        position: relative;
        top: auto;
        left: auto;
        width: auto;
        height: auto;
        margin: 0;
        padding: 17px;
    }

    blockquote.big-quote > p {
        width: 100%;
        font-size: 2em;
    }

    .paragraph-container .paragraph-left-side {
        left: -55px;
    }

    body {
        font-size: 15pt;
    }

    p code:not(.highlight), li code:not(.highlight) {
        font-size: 11pt;
    }

    p, li {
        line-height: 30px;
    }
    
    li {
        margin: 0 0 10px 0;
    }

    .side-regular-block {
        border-radius: 5px;
        background-image: linear-gradient(180deg,hsla(0,0%,100%,0) 60%,#fff),linear-gradient(70deg,#dbedff 32%,#ebfff0);
        padding: 22px;
    }    
}

/* Smartphone horizontal - SM */
@media (max-width: 767px) {
    .book-title-container {
        margin: 73px 0 110px 0;
    }

    h1 {
        margin: 1.8em 0em 1.8em 0.3em;
    }

    .book-title {
        font-size: 40pt;
        margin: 50px 0 70px 0;
    }

    .book-part-title {
        font-size: 19pt;
    }

    .book-part-title:hover {
        box-shadow: inset 0 -1px #007bff;
    }

    .book-superheading-title {
        font-size: 17pt;
    }

    .book-container {
        margin: 0 2.5cm;
    }
    ul {
        margin-left: 30px;
        margin-right: 30px;
        padding-left: 25px;
    }
    .paragraph-container > .paragraph-left-side {
	    display: block;
        top: 14px;
        font-size: 9pt;
    }
    .paragraph-container > .paragraph-right-side {
    	display: block;
        padding-left: 40px;
        top: 14px;
        font-size: 9pt;
    }
    .footer-container img {
        height: 1.3em;
    } 
}

@media (max-width: 630px) {
    .book-container {
        margin: 0 1.5cm;
    }
    .paragraph-container > .paragraph-left-side {
        left: -33px;
    }
    .paragraph-container > .paragraph-right-side {
        padding-left: 24px;
    }
}
/* Smartphone - XS */
@media (max-width: 575px) {
    .book-container {
        margin: 0 50px 0 30px;
    }
    ul {
        margin: 0;
        padding-left: 20px;
    }

    body {
        font-size: 13pt;
    }

    p code:not(.highlight), li code:not(.highlight) 
    {
        font-size: 10pt;
        padding: 3px;
    }
   
    p, li {
        line-height: 24px;
    }    
    
    .paragraph-container .paragraph-left-side 
    {
        display: none;        
    }
    .paragraph-container .paragraph-right-side 
    {
        padding-left: 21px;
        top: 14px;
	    font-size: 8pt;
    }
    .footer-container img {
        height: 1em;
    } 
}

/* Fonts */

@font-face {
    font-family: 'PF Regal';
    src: url('../../res/fonts/PFRegalTextPro-Bold.eot');
    src: local('../../res/fonts/PFRegalTextPro-Bold'),
        url('../../res/fonts/PFRegalTextPro-Bold.woff2') format('woff2'),
        url('../../res/fonts/PFRegalTextPro-Bold.woff') format('woff'),
        url('../../res/fonts/PFRegalTextPro-Bold.ttf') format('truetype');
    font-weight: bold;
    font-style: normal;
}

@font-face {
    font-family: 'PF Regal';
    src: url('../../res/fonts/PFRegalTextPro-Medium.eot');
    src: local('../../res/fonts/PFRegalTextPro-Medium'),
        url('../../res/fonts/PFRegalTextPro-Medium.woff2') format('woff2'),
        url('../../res/fonts/PFRegalTextPro-Medium.woff') format('woff'),
        url('../../res/fonts/PFRegalTextPro-Medium.ttf') format('truetype');
    font-weight: 500;
    font-style: normal;
}

@font-face {
    font-family: 'PF Regal';
    src: url('../../res/fonts/PFRegalTextPro-BlackItalic.eot');
    src: local('../../res/fonts/PFRegalTextPro-BlackItalic'),
        url('../../res/fonts/PFRegalTextPro-BlackItalic.woff2') format('woff2'),
        url('../../res/fonts/PFRegalTextPro-BlackItalic.woff') format('woff'),
        url('../../res/fonts/PFRegalTextPro-BlackItalic.ttf') format('truetype');
    font-weight: 900;
    font-style: italic;
}

@font-face {
    font-family: 'PF Regal';
    src: url('../../res/fonts/PFRegalTextPro-Black.eot');
    src: local('../../res/fonts/PFRegalTextPro-Black'),
        url('../../res/fonts/PFRegalTextPro-Black.woff2') format('woff2'),
        url('../../res/fonts/PFRegalTextPro-Black.woff') format('woff'),
        url('../../res/fonts/PFRegalTextPro-Black.ttf') format('truetype');
    font-weight: 900;
    font-style: normal;
}

@font-face {
    font-family: 'PF Regal UBlack';
    src: url('../../res/fonts/PFRegalTextPro-UBlack.eot');
    src: local('../../res/fonts/PFRegalTextPro-UBlack'),
        url('../../res/fonts/PFRegalTextPro-UBlack.woff2') format('woff2'),
        url('../../res/fonts/PFRegalTextPro-UBlack.woff') format('woff'),
        url('../../res/fonts/PFRegalTextPro-UBlack.ttf') format('truetype');
    font-weight: 900;
    font-style: normal;
}

@font-face {
    font-family: 'PF Regal';
    src: url('../../res/fonts/PFRegalTextPro-MediumItalic.eot');
    src: local('../../res/fonts/PFRegalTextPro-MediumItalic'),
        url('../../res/fonts/PFRegalTextPro-MediumItalic.woff2') format('woff2'),
        url('../../res/fonts/PFRegalTextPro-MediumItalic.woff') format('woff'),
        url('../../res/fonts/PFRegalTextPro-MediumItalic.ttf') format('truetype');
    font-weight: 500;
    font-style: italic;
}

@font-face {
    font-family: 'PF Regal';
    src: url('../../res/fonts/PFRegalTextPro-UBlackItalic.eot');
    src: local('../../res/fonts/PFRegalTextPro-UBlackItalic'),
        url('../../res/fonts/PFRegalTextPro-UBlackItalic.woff2') format('woff2'),
        url('../../res/fonts/PFRegalTextPro-UBlackItalic.woff') format('woff'),
        url('../../res/fonts/PFRegalTextPro-UBlackItalic.ttf') format('truetype');
    font-weight: 900;
    font-style: italic;
}

@font-face {
    font-family: 'PF Regal';
    src: url('../../res/fonts/PFRegalTextPro-RegularAItalic.eot');
    src: local('../../res/fonts/PFRegalTextPro-RegularAItalic'),
        url('../../res/fonts/PFRegalTextPro-RegularAItalic.woff2') format('woff2'),
        url('../../res/fonts/PFRegalTextPro-RegularAItalic.woff') format('woff'),
        url('../../res/fonts/PFRegalTextPro-RegularAItalic.ttf') format('truetype');
    font-weight: 300;
    font-style: italic;
}

@font-face {
    font-family: 'PF Regal';
    src: url('../../res/fonts/PFRegalTextPro-BoldItalic.eot');
    src: local('../../res/fonts/PFRegalTextPro-BoldItalic'),
        url('../../res/fonts/PFRegalTextPro-BoldItalic.woff2') format('woff2'),
        url('../../res/fonts/PFRegalTextPro-BoldItalic.woff') format('woff'),
        url('../../res/fonts/PFRegalTextPro-BoldItalic.ttf') format('truetype');
    font-weight: bold;
    font-style: italic;
}

@font-face {
    font-family: 'Charter';
    src: url('../../res/fonts/charter-regular.woff2') format('woff2');
    font-weight: normal;
    font-style: normal;
}

/*  Regular B */
@font-face {
    font-family: 'PF Regal';
    src: url('../../res/fonts/PFRegalTextPro-RegularBItalic.eot');
    src: local('../../res/fonts/PFRegalTextPro-RegularBItalic'),
        url('../../res/fonts/PFRegalTextPro-RegularBItalic.woff2') format('woff2'),
        url('../../res/fonts/PFRegalTextPro-RegularBItalic.woff') format('woff'),
        url('../../res/fonts/PFRegalTextPro-RegularBItalic.ttf') format('truetype');
    font-weight: 300;
    font-style: italic;
}

@font-face {
    font-family: 'PF Regal';
    src: url('../../res/fonts/PFRegalTextPro-RegularB.eot');
    src: local('../../res/fonts/PFRegalTextPro-RegularB'),
        url('../../res/fonts/PFRegalTextPro-RegularB.woff2') format('woff2'),
        url('../../res/fonts/PFRegalTextPro-RegularB.woff') format('woff'),
        url('../../res/fonts/PFRegalTextPro-RegularB.ttf') format('truetype');
    font-weight: 300;
    font-style: normal;
}

@font-face {
    font-family: 'JB Mono';
    src: url('../../res/fonts/JetBrainsMono-Regular.eot');
    src: local('../../res/fonts/JetBrainsMono-Regular'),
        url('../../res/fonts/JetBrainsMono-Regular.woff2') format('woff2'),
        url('../../res/fonts/JetBrainsMono-Regular.woff') format('woff'),
        url('../../res/fonts/JetBrainsMono-Regular.ttf') format('truetype');
    font-weight: 300;
    font-style: normal;
}
@font-face {
    font-family: 'JB Mono';
    src: url('../../res/fonts/JetBrainsMono-Italic.eot');
    src: local('../../res/fonts/JetBrainsMono-Italic'),
        url('../../res/fonts/JetBrainsMono-Italic.woff2') format('woff2'),
        url('../../res/fonts/JetBrainsMono-Italic.woff') format('woff'),
        url('../../res/fonts/JetBrainsMono-Italic.ttf') format('truetype');
    font-weight: 300;
    font-style: italic;
}

@font-face {
    font-family: 'JB Mono';
    src: url('../../res/fonts/JetBrainsMono-Medium.eot');
    src: local('../../res/fonts/JetBrainsMono-Medium'),
        url('../../res/fonts/JetBrainsMono-Medium.woff2') format('woff2'),
        url('../../res/fonts/JetBrainsMono-Medium.woff') format('woff'),
        url('../../res/fonts/JetBrainsMono-Medium.ttf') format('truetype');
    font-weight: 500;
    font-style: normal;
}
@font-face {
    font-family: 'JB Mono';
    src: url('../../res/fonts/JetBrainsMono-Medium-Italic.eot');
    src: local('../../res/fonts/JetBrainsMono-Medium-Italic'),
        url('../../res/fonts/JetBrainsMono-Medium-Italic.woff2') format('woff2'),
        url('../../res/fonts/JetBrainsMono-Medium-Italic.woff') format('woff'),
        url('../../res/fonts/JetBrainsMono-Medium-Italic.ttf') format('truetype');
    font-weight: 500;
    font-style: italic;
}
@font-face {
    font-family: 'Font Awesome 5 Free';
    font-style: normal;
    font-weight: 400;
    font-display: swap;
    src: url("../../res/fonts/webfonts/fa-regular-400.eot");
    src: url("../../res/fonts/webfonts/fa-regular-400.eot?#iefix") format("embedded-opentype"), 
         url("../../res/fonts/webfonts/fa-regular-400.woff2") format("woff2"), 
         url("../../res/fonts/webfonts/fa-regular-400.woff") format("woff"), 
         url("../../res/fonts/webfonts/fa-regular-400.ttf") format("truetype"), 
         url("../../res/fonts/webfonts/fa-regular-400.svg#fontawesome") format("svg"); 
    font-display: swap;
}
    
.fa {
    font-family: 'Font Awesome 5 Free';
    font-weight: 400;
    font-display: swap;
}
@font-face {
  font-family: 'Font Awesome 5 Brands';
  font-style: normal;
  font-weight: 400;
  font-display: auto;
  src: url("../../res/fonts/fa-brands-400.eot");
  src: url("../../res/fonts/fa-brands-400.eot?#iefix") format("embedded-opentype"), url("../../res/fonts/fa-brands-400.woff2") format("woff2"), url("../../res/fonts/fa-brands-400.woff") format("woff"), url("../../res/fonts/fa-brands-400.ttf") format("truetype"), url("../../res/fonts/fa-brands-400.svg#fontawesome") format("svg"); 
}

.fab {
  font-family: 'Font Awesome 5 Brands';
  font-weight: 400; 
}

@font-face {
  font-family: 'Font Awesome 5 Free';
  font-style: normal;
  font-weight: 400;
  font-display: auto;
  src: url("../../res/fonts/fa-regular-400.eot");
  src: url("../../res/fonts/fa-regular-400.eot?#iefix") format("embedded-opentype"), url("../../res/fonts/fa-regular-400.woff2") format("woff2"), url("../../res/fonts/fa-regular-400.woff") format("woff"), url("../../res/fonts/fa-regular-400.ttf") format("truetype"), url("../../res/fonts/fa-regular-400.svg#fontawesome") format("svg"); 
}

.far {
  font-family: 'Font Awesome 5 Free';
  font-weight: 400; 
}

@font-face {
  font-family: 'Font Awesome 5 Free';
  font-style: normal;
  font-weight: 900;
  font-display: auto;
  src: url("../../res/fonts/fa-solid-900.eot");
  src: url("../../res/fonts/fa-solid-900.eot?#iefix") format("embedded-opentype"), url("../../res/fonts/fa-solid-900.woff2") format("woff2"), url("../../res/fonts/fa-solid-900.woff") format("woff"), url("../../res/fonts/fa-solid-900.ttf") format("truetype"), url("../../res/fonts/fa-solid-900.svg#fontawesome") format("svg"); 
}
  
    </style>
    <!--
    <div class="book-title-container d-none d-md-block">
        <div class="book-title">Knowledge Base</div>
        <div class="book-part-title-block">pt.1 <a href="../..//ru/Memory/01-00-MemoryManagement-Intro.html" class="book-part-title">Управление памятью</a></div>
        <div class="book-part-title-block">pt.2 <a href="../..//ru/Execution/02-00-ExecutionFlow-Intro.html" class="book-part-title">Поток исполнения команд</a></div>
        <br><a href="#" class="book-superheading-title">Обоснование выбора</a>
        / <a href="#" class="book-superheading-title">Упрощенное описание</a>
        / <a href="#" class="book-superheading-title">Подробное описание</a>
    </div>
    -->
    <header class="header fixed">
        <a href="#">
            <img class="conflogo" src="../../res/img/logo-b-noindex.svg"/> 
        </a>
        <div class="menu">
            <div><a href="index.html">О конференции</a></div>
            <div><a href="mentor.html">Ментор</a></div>
            <div><a href="practice.html">Практика</a></div>
            <div><a href="matrix.html">Доклады</a></div>
            <a href="register.html" class="register_button">РЕГИСТРАЦИЯ</a>
        </div>

        <!-- mobile-menu -->

        <div class="hamburger-menu">
            <input id="menu__toggle" type="checkbox" />
            <label class="menu__btn" for="menu__toggle">
              <span></span>
            </label>
        
            <ul class="menu__box">
                <li><a class="menu__item" href="index.html">О семинаре</a></li>
                <li><a class="menu__item" href="mentor.html">Ментор</a></li>
                <li><a class="menu__item" href="matrix.html">Доклады</a></li>
                <li><a class="menu__item" href="practice.html">Практика</a></li>
                <li><a class="menu__item" href="register.html">Регистрация</a></li>
           </ul>
        </div>
    </header>

    <div class="book-container">
        <div class="article-container">
            <!--<p class="d-xs-block d-sm-none">XS</p>
            <p class="d-none d-xs-block d-sm-none">SM</p>
            <p class="d-none d-sm-block d-md-none">MD</p>
            <p class="d-none d-lg-block d-xl-none">LG</p>
            <p class="d-none d-xl-block">XL</p> -->
            <h3 id="clr-exceptions">CLR Exceptions</h3>
<blockquote>
<p >
<a href="https://github.com/sidristij/dotnetbook/issues/51">A link to the discussion</a></p>
</blockquote>
<div class="paragraph-container">
<div class="paragraph-left-side">01</div>
<p >
There are some exceptional situations that, let’s say, more exceptional than others. In terms of classification, as it was said at the beginning of this chapter, we can divide them into ones that belong to a .NET application and others that belong to the unsafe world. The latter group consists of two subcategories: the exceptions of the CLR core (which is essentially unsafe) and any unsafe code of external libraries.</p>
<div class="paragraph-right-side">01</div>
</div>
<p >
[todo]</p>
<h4 id="threadabortexception">ThreadAbortException</h4>
<p >
Although it may seem not so obvious, there are four types of Thread Abort.</p>
<ul>
<li>
<p >
Rough <code>ThreadAbort</code> which gets unstoppable when activated and which doesn’t call exception handlers at all, including <code>finally</code> sections.</p>
</li>
<li>
<p >
<code>Thread.Abort()</code> method, invoked on a current thread.</p>
</li>
<li>
<p >
Asynchronous <code>ThreadAbortException</code> which is thrown from some other thread.</p>
</li>
<li>
<p >
<code>ThreadAbort</code> invoked on the threads which are initiated when the <code>AppDomain</code> is being unloaded and which contains running methods compiled for this domain.</p>
</li>
</ul>
<blockquote>
<p >
It should be noted that <code>ThreadAbortException</code> is often used in <em>big</em> .NET Framework, yet doesn’t exist for CoreCLR, .NET Core or for Windows 8 &laquo;Modern app profile&raquo;. Let’s figure out why.</p>
</blockquote>
<div class="paragraph-container">
<div class="paragraph-left-side">02</div>
<p >
For the second, third or fourth variant of a thread abort, when we are still able to do something, a virtual machine starts going through all exception handlers and look up those that correspond to the type of a thrown exception or for a higher exception level. In our case these are: <code>ThreadAbortException</code>, <code>Exception</code> and <code>object</code> (don’t forget that Exception is essentially a data set and our search may end up with any type of exception, even with <code>int</code>). By handling <em>all</em> suitable <code>catch</code> blocks, the virtual machine successively forwards <code>ThreadAbortException</code> along the entire chain of exception handling and enters all <code>finally</code> blocks. In general, the situations described below are identical:</p>
<div class="paragraph-right-side">02</div>
</div>
<div class="lang-csharp editor-colors"><div style="color:Black;background-color:White;"><pre>
<span style="color:Blue;">var</span> thread = <span style="color:Blue;">new</span> Thread(() =&gt;
{
    <span style="color:Blue;">try</span> {
        <span style="color:Green;">// ...</span>
    } <span style="color:Blue;">catch</span> (Exception ex)
    {
        <span style="color:Green;">// ...</span>
    }
});
thread.Start();
<span style="color:Green;">//...</span>
thread.Abort();

<span style="color:Blue;">var</span> thread = <span style="color:Blue;">new</span> Thread(() =&gt;
{
    <span style="color:Blue;">try</span> {
        <span style="color:Green;">// ...</span>
    } <span style="color:Blue;">catch</span> (Exception ex)
    {
        <span style="color:Green;">// ...</span>
        <span style="color:Blue;">if</span>(ex <span style="color:Blue;">is</span> ThreadAbortException)
        {
            <span style="color:Blue;">throw</span>;
        }
    }
});
thread.Start();
<span style="color:Green;">//...</span>
thread.Abort();
</pre></div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">03</div>
<p >
Sometimes, we definitely may expect <code>ThreadAbort</code> and  have an understandable desire to handle it. For these cases there is <code>Thread.ResetAbort()</code> method which does what we need: stops forwarding an exception through the chain of handlers, thus making this exception handled:</p>
<div class="paragraph-right-side">03</div>
</div>
<div class="lang-csharp editor-colors"><div style="color:Black;background-color:White;"><pre>
<span style="color:Blue;">void</span> Main()
{
    <span style="color:Blue;">var</span> barrier = <span style="color:Blue;">new</span> Barrier(2);

    <span style="color:Blue;">var</span> thread = <span style="color:Blue;">new</span> Thread(() =&gt;
    {
        <span style="color:Blue;">try</span> {
            barrier.SignalAndWait();  <span style="color:Green;">// Breakpoint #1</span>
            Thread.Sleep(TimeSpan.FromSeconds(30));
        }
        <span style="color:Blue;">catch</span> (ThreadAbortException exception)
        {
            <span style="color:#A31515;">&quot;Resetting abort&quot;</span>.Dump();
            Thread.ResetAbort();
        }

        <span style="color:#A31515;">&quot;Caught successfully&quot;</span>.Dump();
        barrier.SignalAndWait();     <span style="color:Green;">// Breakpoint #2</span>
    });

    thread.Start();
    barrier.SignalAndWait();         <span style="color:Green;">// Breakpoint #1</span>

    thread.Abort();
    barrier.SignalAndWait();         <span style="color:Green;">// Breakpoint #2</span>
}

Output:
Resetting abort
Catched successfully
</pre></div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">04</div>
<p >
But should we really use it? And should we be mad at CoreCLR developers because they got rid of this code? Assume you are a user of code and you think it is &laquo;stuck&raquo;. You have a sharp desire to call <code>ThreadAbortException</code>. When you want to terminate a thread, all you really want is that this thread really stops running. Moreover, it rarely happens when an algorithm aborts the thread and leaves it. Normally, it waits for correct termination of operations. Alternatively, it decides that the thread is dead, decrements some internal counters and forgets that there is some multithread processing of some code. You’ll never know which one is worse. Moreover, after many years of being a programmer I still can’t offer a great way to call and handle it. Imagine—you throw <code>ThreadAbort</code> not <em>right away</em> but in any case some time after having understood that the situation is hopeless. So sometimes you hit <code>ThreadAbortException</code> handler and sometimes you miss it: &laquo;stuck code&raquo; may be in fact not stuck but a too long executed one. And in that very moment you wanted to kill it, this code could have started working correctly again,  i.e. exited <code>try-catch(ThreadAbortException) { Thread.ResetAbort(); }</code> block. What will we get in this case? An aborted thread that happened to stuck through no fault of its own. For example, a janitor could have passed by, unplugged the cable and brought the network down. A method was waiting for a timeout and when the janitor has plugged the cable back, everything started working again, but your controlling code had already killed the thread. Is it OK? No. Can we safeguard from this? No. But let’s get back to our idea of legalizing <code>Thread.Abort()</code>: we have thrown a hammer at the thread and now expect the latter to be inevitably aborted, but it may never happen. Firstly, it is not clear how to abort it in this case. Things may be more complicated here: a stuck thread can have logic inside which catches <code>ThreadAbortException</code>, terminates it using <code>ResetAbort</code>, but remains stuck because of broken logic. What’s then? Should we use <code>thread.Interrupt()</code>? It seems like an attempt to bypass a program logic error using brute force methods. Also, I guarantee you will get resource leaks: <code>thread.Interrupt()</code> won’t call <code>catch</code> and <code>finally</code> which means you can’t clean up resources. Your thread will simply disappear and if you are in an adjacent thread you won’t know the references to all resources, allocated to the aborted thread. Also, note that if <code>ThreadAbortException</code> misses <code>catch(ThreadAbortException) { Thread.ResetAbort(); }</code> you will get resource leaks too.</p>
<div class="paragraph-right-side">04</div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">05</div>
<p >
I hope that after having read the information above you will feel some confusion and intention to reread the paragraph. And this would be a good idea that proves you mustn’t use <code>Thread.Abort()</code>  as well as <code>thread.Interrupt();</code>. Both methods make the behavior of your application uncontrolled. They violate the integrity principle, which is the main principle of the .NET Framework.</p>
<div class="paragraph-right-side">05</div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">06</div>
<p >
However, to understand why developers introduced this method you should have a look at the .NET Framework source code and find where <code>Thread.ResetAbort()</code> is invoked. Because this method makes <code>thread.Abort()</code> legitimate.</p>
<div class="paragraph-right-side">06</div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">07</div>
<p >
<strong>ISAPIRuntime class</strong> <a href="https://referencesource.microsoft.com/#System.Web/Hosting/ISAPIRuntime.cs,192">ISAPIRuntime.cs</a></p>
<div class="paragraph-right-side">07</div>
</div>
<div class="lang-csharp editor-colors"><div style="color:Black;background-color:White;"><pre>
<span style="color:Blue;">try</span> {

    <span style="color:Green;">// ...</span>

}
<span style="color:Blue;">catch</span>(Exception e) {
    <span style="color:Blue;">try</span> {
        WebBaseEvent.RaiseRuntimeError(e, <span style="color:Blue;">this</span>);
    } <span style="color:Blue;">catch</span> {}

    <span style="color:Green;">// Have we called HSE_REQ_DONE_WITH_SESSION?  If so, don&#39;t re-throw.</span>
    <span style="color:Blue;">if</span> (wr != <span style="color:Blue;">null</span> &amp;&amp; wr.Ecb == IntPtr.Zero) {
        <span style="color:Blue;">if</span> (pHttpCompletion != IntPtr.Zero) {
            UnsafeNativeMethods.SetDoneWithSessionCalled(pHttpCompletion);
        }
        <span style="color:Green;">// if this is a thread abort exception, cancel the abort</span>
        <span style="color:Blue;">if</span> (e <span style="color:Blue;">is</span> ThreadAbortException) {
            Thread.ResetAbort();
        }
        <span style="color:Green;">// IMPORTANT: if this thread is being aborted because of an AppDomain.Unload,</span>
        <span style="color:Green;">// the CLR will still throw an AppDomainUnloadedException. The native caller</span>
        <span style="color:Green;">// must special case COR_E_APPDOMAINUNLOADED(0x80131014) and not</span>
        <span style="color:Green;">// call HSE_REQ_DONE_WITH_SESSION more than once.</span>
        <span style="color:Blue;">return</span> 0;
    }

    <span style="color:Green;">// re-throw if we have not called HSE_REQ_DONE_WITH_SESSION</span>
    <span style="color:Blue;">throw</span>;
}
</pre></div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">08</div>
<p >
This example calls some external code and if it was terminated incorrectly with <code>ThreadAbortException</code>, we mark the thread under certain circumstances as non-abortable anymore. In fact, we handle <code>ThreadAbort</code>. Why do we abort <code>Thread.Abort</code> in this case? Because here, we deal with server code which must return correct error codes to a calling party regardless of our errors. A thread abort would prevent a server to return a necessary error code to user, which is absolutely inappropriate. Also, there is a comment about <code>Thread.Abort()</code> during <code>AppDomain.Unload()</code> which is an extreme situation for <code>Thread.Abort</code> as you can’t stop such a process even if you use <code>Thread.ResetAbort</code>. Though it will stop abort handling, it won’t stop the unloading of a thread inside a domain: a thread can’t execute code instructions from the domain being currently unloaded.</p>
<div class="paragraph-right-side">08</div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">09</div>
<p >
<strong>HttpContext class</strong> <a href="https://referencesource.microsoft.com/#System.Web/HttpContext.cs,1864">HttpContext.cs</a></p>
<div class="paragraph-right-side">09</div>
</div>
<div class="lang-csharp editor-colors"><div style="color:Black;background-color:White;"><pre>
<span style="color:Blue;">internal</span> <span style="color:Blue;">void</span> InvokeCancellableCallback(WaitCallback callback, Object state) {
    <span style="color:Green;">// ...</span>
 
    <span style="color:Blue;">try</span> {
        BeginCancellablePeriod();  <span style="color:Green;">// request can be cancelled from this point</span>
        <span style="color:Blue;">try</span> {
            callback(state);
        }
        <span style="color:Blue;">finally</span> {
            EndCancellablePeriod();  <span style="color:Green;">// request can be cancelled until this point</span>
        }
        WaitForExceptionIfCancelled();  <span style="color:Green;">// wait outside of finally</span>
    }
    <span style="color:Blue;">catch</span> (ThreadAbortException e) {
        <span style="color:Blue;">if</span> (e.ExceptionState != <span style="color:Blue;">null</span> &amp;&amp;
            e.ExceptionState <span style="color:Blue;">is</span> HttpApplication.CancelModuleException &amp;&amp;
            ((HttpApplication.CancelModuleException)e.ExceptionState).Timeout) {

            Thread.ResetAbort();
            PerfCounters.IncrementCounter(AppPerfCounter.REQUESTS_TIMED_OUT);

            <span style="color:Blue;">throw</span> <span style="color:Blue;">new</span> HttpException(SR.GetString(SR.Request_timed_out),
                                <span style="color:Blue;">null</span>, WebEventCodes.RuntimeErrorRequestAbort);
        }
    }
}
</pre></div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">10</div>
<p >
This is a great example of transfer from unmanaged asynchronous <code>ThreadAbortException</code> to managed <code>HttpException</code> with recording the case to the Performance Counters Log.</p>
<div class="paragraph-right-side">10</div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">11</div>
<p >
<strong>HttpApplication class</strong> <a href="https://referencesource.microsoft.com/#System.Web/HttpApplication.cs,2270">HttpApplication.cs</a></p>
<div class="paragraph-right-side">11</div>
</div>
<div class="lang-csharp editor-colors"><div style="color:Black;background-color:White;"><pre>
 <span style="color:Blue;">internal</span> Exception ExecuteStep(IExecutionStep step, <span style="color:Blue;">ref</span> <span style="color:Blue;">bool</span> completedSynchronously) 
 {
    Exception error = <span style="color:Blue;">null</span>;

    <span style="color:Blue;">try</span> {
        <span style="color:Blue;">try</span> {

        <span style="color:Green;">// ...</span>

        }
        <span style="color:Blue;">catch</span> (Exception e) {
            error = e;

            <span style="color:Green;">// ...</span>

            <span style="color:Green;">// This might force ThreadAbortException to be thrown</span>
            <span style="color:Green;">// automatically, because we consumed an exception that was</span>
            <span style="color:Green;">// hiding ThreadAbortException behind it</span>

            <span style="color:Blue;">if</span> (e <span style="color:Blue;">is</span> ThreadAbortException &amp;&amp;
                ((Thread.CurrentThread.ThreadState &amp; ThreadState.AbortRequested) == 0))  {
                <span style="color:Green;">// Response.End from a COM+ component that re-throws ThreadAbortException</span>
                <span style="color:Green;">// It is not a real ThreadAbort</span>
                <span style="color:Green;">// VSWhidbey 178556</span>
                error = <span style="color:Blue;">null</span>;
                _stepManager.CompleteRequest();
            }
        }
        <span style="color:Blue;">catch</span> {
            <span style="color:Green;">// ignore non-Exception objects that could be thrown</span>
        }
    }
    <span style="color:Blue;">catch</span> (ThreadAbortException e) {
        <span style="color:Green;">// ThreadAbortException could be masked as another one</span>
        <span style="color:Green;">// the try-catch above consumes all exceptions, only</span>
        <span style="color:Green;">// ThreadAbortException can filter up here because it gets</span>
        <span style="color:Green;">// auto rethrown if no other exception is thrown on catch</span>
        <span style="color:Blue;">if</span> (e.ExceptionState != <span style="color:Blue;">null</span> &amp;&amp; e.ExceptionState <span style="color:Blue;">is</span> CancelModuleException) {
            <span style="color:Green;">// one of ours (Response.End or timeout) -- cancel abort</span>

            <span style="color:Green;">// ...</span>

            Thread.ResetAbort();
        }
    }
}
</pre></div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">12</div>
<p >
You can see an interesting scenario here—to expect a false <code>ThreadAbort</code> (I feel sympathy with CLR and .NET Framework team in  how unbelievably many unusual scenarios they have to handle). This time a scenario is handled in two stages: initially, using an internal handler, we catch <code>ThreadAbortException</code> and then check whether our thread is marked for abort.  If it is not, the <code>ThreadAbortException</code> is false. We should address these scenarios accordingly: catch an exception and handle it. If we get a true <code>ThreadAbort</code>, it will go to an external <code>catch</code> because <code>ThreadAbortException</code> should enter all suitable handlers. If it meets necessary conditions, it will also be handled by removing the <code>ThreadState.AbortRequested</code> flag using the <code>Thread.ResetAbort()</code>.</p>
<div class="paragraph-right-side">12</div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">13</div>
<p >
In terms of <code>Thread.Abort()</code> calls, all the examples of code in .NET Framework may be rewritten without using it. Just one example for clarity:</p>
<div class="paragraph-right-side">13</div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">14</div>
<p >
<strong>QueuePathDialog class</strong> <a href="https://referencesource.microsoft.com/#System.Messaging/System/Messaging/Design/QueuePathDialog.cs,364">QueuePathDialog.cs</a></p>
<div class="paragraph-right-side">14</div>
</div>
<div class="lang-csharp editor-colors"><div style="color:Black;background-color:White;"><pre>
<span style="color:Blue;">protected</span> <span style="color:Blue;">override</span> <span style="color:Blue;">void</span> OnHandleCreated(EventArgs e)
{
    <span style="color:Blue;">if</span> (!populateThreadRan)
    {
        populateThreadRan = <span style="color:Blue;">true</span>;
        populateThread = <span style="color:Blue;">new</span> Thread(<span style="color:Blue;">new</span> ThreadStart(<span style="color:Blue;">this</span>.PopulateThread));
        populateThread.Start();
    }

    <span style="color:Blue;">base</span>.OnHandleCreated(e);
}

<span style="color:Blue;">protected</span> <span style="color:Blue;">override</span> <span style="color:Blue;">void</span> OnFormClosing(FormClosingEventArgs e)
{
    <span style="color:Blue;">this</span>.closed = <span style="color:Blue;">true</span>;

    <span style="color:Blue;">if</span> (populateThread != <span style="color:Blue;">null</span>)
    {
        populateThread.Abort();
    }

    <span style="color:Blue;">base</span>.OnFormClosing(e);
}

<span style="color:Blue;">private</span> <span style="color:Blue;">void</span> PopulateThread()
{
    <span style="color:Blue;">try</span>
    {
        IEnumerator messageQueues = MessageQueue.GetMessageQueueEnumerator();
        <span style="color:Blue;">bool</span> locate = <span style="color:Blue;">true</span>;
        <span style="color:Blue;">while</span> (locate)
        {
            <span style="color:Green;">// ...</span>
            <span style="color:Blue;">this</span>.BeginInvoke(<span style="color:Blue;">new</span> FinishPopulateDelegate(<span style="color:Blue;">this</span>.OnPopulateTreeview), <span style="color:Blue;">new</span> <span style="color:Blue;">object</span>[] { queues });
        }
    }
    <span style="color:Blue;">catch</span>
    {
        <span style="color:Blue;">if</span> (!<span style="color:Blue;">this</span>.closed)
            <span style="color:Blue;">this</span>.BeginInvoke(<span style="color:Blue;">new</span> ShowErrorDelegate(<span style="color:Blue;">this</span>.OnShowError), <span style="color:Blue;">null</span>);
    }

    <span style="color:Blue;">if</span> (!<span style="color:Blue;">this</span>.closed)
        <span style="color:Blue;">this</span>.BeginInvoke(<span style="color:Blue;">new</span> SelectQueueDelegate(<span style="color:Blue;">this</span>.OnSelectQueue), <span style="color:Blue;">new</span> <span style="color:Blue;">object</span>[] { <span style="color:Blue;">this</span>.selectedQueue, 0 });
}
</pre></div>
</div>
<h5 id="threadabortexception-during-appdomain.unload">ThreadAbortException during AppDomain.Unload</h5>
<div class="paragraph-container">
<div class="paragraph-left-side">15</div>
<p >
Let’s unload AppDomain while executing code that is loaded into it. To do this we create an unnatural, yet interesting situation in terms of running code. Here we have two threads: one is <code>main</code> and the other one is created to get <code>ThreadAbortException</code>. In the <code>main</code> thread, we create a new domain and start a new thread in it. This thread must go to the <code>main</code> domain, so that child domain methods remain just in Stack Trace. Then, the <code>main</code> domain unloads the child one:</p>
<div class="paragraph-right-side">15</div>
</div>
<div class="lang-csharp editor-colors"><div style="color:Black;background-color:White;"><pre>
<span style="color:Blue;">class</span> Program : MarshalByRefObject
{
    <span style="color:Blue;">static</span> <span style="color:Blue;">void</span> Main()
    {
        <span style="color:Blue;">try</span>
        {
            <span style="color:Blue;">var</span> domain = ApplicationLogger.Go(<span style="color:Blue;">new</span> Program());
            Thread.Sleep(300);
            AppDomain.Unload(domain);

        } <span style="color:Blue;">catch</span> (ThreadAbortException exception)
        {
            Console.WriteLine(<span style="color:#A31515;">&quot;Main AppDomain aborted too, {0}&quot;</span>, exception.Message);
        }
    }

    <span style="color:Blue;">public</span> <span style="color:Blue;">void</span> InsideMainAppDomain()
    {
        <span style="color:Blue;">try</span>
        {
            Console.WriteLine($<span style="color:#A31515;">&quot;InsideMainAppDomain() called inside {AppDomain.CurrentDomain.FriendlyName} domain&quot;</span>);

            <span style="color:Green;">// AppDomain.Unload will be called while this Sleep</span>
            Thread.Sleep(-1);
        }
        <span style="color:Blue;">catch</span> (ThreadAbortException exception)
        {
            Console.WriteLine(<span style="color:#A31515;">&quot;Subdomain aborted, {0}&quot;</span>, exception.Message);

            <span style="color:Green;">// This sleep to allow user to see console contents</span>
            Thread.Sleep(-1);
        }
    }

    <span style="color:Blue;">public</span> <span style="color:Blue;">class</span> ApplicationLogger : MarshalByRefObject
    {
        <span style="color:Blue;">private</span> <span style="color:Blue;">void</span> StartThread(Program pro)
        {
            <span style="color:Blue;">var</span> thread = <span style="color:Blue;">new</span> Thread(() =&gt;
            {
                pro.InsideMainAppDomain();
            });
            thread.Start();
        }

        <span style="color:Blue;">public</span> <span style="color:Blue;">static</span> AppDomain Go(Program pro)
        {
            <span style="color:Blue;">var</span> dom = AppDomain.CreateDomain(<span style="color:#A31515;">&quot;ApplicationLogger&quot;</span>, <span style="color:Blue;">null</span>, <span style="color:Blue;">new</span> AppDomainSetup
            {
                ApplicationBase = AppDomain.CurrentDomain.BaseDirectory,
            });

            <span style="color:Blue;">var</span> proxy = (ApplicationLogger)dom.CreateInstanceAndUnwrap(<span style="color:Blue;">typeof</span>(ApplicationLogger).Assembly.FullName, <span style="color:Blue;">typeof</span>(ApplicationLogger).FullName);
            proxy.StartThread(pro);

            <span style="color:Blue;">return</span> dom;
        }
    }

}
</pre></div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">16</div>
<p >
Exciting things happen here. The code that unloads a domain also looks up methods called in this domain that didn’t finish their work yet, including those in the depth of the method call stack, and invokes <code>ThreadAbortException</code> on these threads. This is important, yet not obvious. If a domain is unloaded, it’s impossible to return to a method from which the main domain method is called, but which exists in the unloaded domain. In other words, <code>AppDomain.Unload</code> may get rid of those threads that run code from other domains. In this case, it is not possible to abort <code>Thread.Abort</code>: you can’t execute the code of an unloaded domain which means <code>Thread.Abort</code> will finish its work even if you call <code>Thread.ResetAbort</code>.</p>
<div class="paragraph-right-side">16</div>
</div>
<h5 id="conclusions-on-threadabortexception">Conclusions on ThreadAbortException</h5>
<ul>
<li>
<p >
It’s an asynchronous exception, therefore it can appear anywhere in your code (though you should make efforts for it).</p>
</li>
<li>
<p >
Normally, code handles only expected errors, such as a file access error, a string parsing error, etc. An asynchronous exception (which can appear anywhere) creates a scenario when <code>try-catch</code> may not be handled: you can’t be ready for ThreadAbort at every place in an application. It turns out this exception will cause resource leaks, anyway.</p>
</li>
<li>
<p >
A thread may be aborted because of some domain unloading. If there are calls of unloaded domain methods in Stack Trace of a thread, this thread will get <code>ThreadAbortException</code> without <code>ResetAbort</code>.</p>
</li>
<li>
<p >
In general, there shouldn’t be situations when you need to call <code>Thread.Abort()</code> as the result is almost always unpredictable.</p>
</li>
<li>
<p >
CoreCLR doesn’t have a <code>Thread.Abort()</code> manual call option: it was eliminated from the class. But it doesn’t mean you can’t get it.</p>
</li>
</ul>
<h4 id="executionengineexception">ExecutionEngineException</h4>
<p >
This exception is marked as <code>Obsolete</code> and has the following comment:</p>
<blockquote>
<p >
This type previously indicated an unspecified fatal error in the runtime. The runtime no longer raises this exception so this type is obsolete</p>
</blockquote>
<div class="paragraph-container">
<div class="paragraph-left-side">17</div>
<p >
And this is not true. I guess the author of this comment would really want this to become true. However, let’s get back to the example of an exception in <code>FirstChanceException</code> and see it’s not true:</p>
<div class="paragraph-right-side">17</div>
</div>
<div class="lang-csharp editor-colors"><div style="color:Black;background-color:White;"><pre>
<span style="color:Blue;">void</span> Main()
{
    <span style="color:Blue;">var</span> counter = 0;

    AppDomain.CurrentDomain.FirstChanceException += (_, args) =&gt; {
        Console.WriteLine(args.Exception.Message);
        <span style="color:Blue;">if</span>(++counter == 1) {
            <span style="color:Blue;">throw</span> <span style="color:Blue;">new</span> ArgumentOutOfRangeException();
        }
    };

    <span style="color:Blue;">throw</span> <span style="color:Blue;">new</span> Exception(<span style="color:#A31515;">&quot;Hello!&quot;</span>);
}
</pre></div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">18</div>
<p >
The execution of this code will cause <code>ExecutionEngineException</code>, though I would expect the <code>ArgumentOutOfRangeException</code> by Unhandled Exception from the <code>throw new Exception(&quot;Hello!&quot;)</code> instruction.  Maybe this seemed strange to the core developers, and they thought it would be more correct to throw <code>ExecutionEngineException</code>.</p>
<div class="paragraph-right-side">18</div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">19</div>
<p >
Another simple way to get <code>ExecutionEngineException</code> is to  customize marshaling to the unsafe world incorrectly. If you get wrong sizes of types or pass more than it is necessary, ruining, for example, the stack of a thread, you will get <code>ExecutionEngineException</code>. This is expectable, as here the CLR entered the state which it finds inconsistent. And it doesn’t know how to recover consistency. As a result, you get <code>ExecutionEngineException</code>.</p>
<div class="paragraph-right-side">19</div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">20</div>
<p >
Another thing that needs special attention is the diagnostics of <code>ExecutionEngineException</code>. Why is this exception thrown? If it suddenly appeared in your code, answer several questions.</p>
<div class="paragraph-right-side">20</div>
</div>
<ul>
<li>
<p >
Does your application use unsafe libraries? Is it you or third-party who use them? First, try to find where this error occurs in the application. If the code goes to the unsafe world and gets <code>ExecutionEngineException</code> there, carefully check the convergence of methods signatures both in your code and in imported one. Remember that if modules written in Delphi or other variants of Pascal are imported, arguments should be reversed (configured in <code>DllImport</code>: <code>CallingConvention.StdCall</code>).</p>
</li>
<li>
<p >
Are you subscribed to <code>FirstChanceException</code>? Its code might cause an exception. In this case, just wrap a handler in <code>try-catch(Exception)</code> and write events to the error log.</p>
</li>
<li>
<p >
Is it possible that your application is built partially for one platform and partially for another? Try to clear the nuget packages cache and rebuild the application from scratch with obj/bin folders emptied manually.</p>
</li>
<li>
<p >
Is there a problem with the framework itself? This may happen in the early versions of .NET Framework 4.0.  In this case, test a separate piece of code that causes an error in a newer version of the framework.</p>
</li>
</ul>
<div class="paragraph-container">
<div class="paragraph-left-side">21</div>
<p >
In general, don’t be afraid of this exception: it’s so rare that you may even forget about it till you meet it next time.</p>
<div class="paragraph-right-side">21</div>
</div>
<h4 id="nullreferenceexception">NullReferenceException</h4>
<blockquote>
<p >
TODO</p>
</blockquote>
<h4 id="securityexception">SecurityException</h4>
<blockquote>
<p >
TODO</p>
</blockquote>
<h4 id="outofmemoryexception">OutOfMemoryException</h4>
<blockquote>
<p >
TODO</p>
</blockquote>
<h3 id="corrupted-state-exceptions">Corrupted State Exceptions</h3>
<div class="paragraph-container">
<div class="paragraph-left-side">22</div>
<p >
Once the platform was established and gets popular, programmers started massively migrating from C/C++ and MFC (Microsoft Foundation Classes) to more easy-to-develop environments. Besides .NET Framework, those environments included Qt, Java and С++ Builder—the mainstream was a movement towards virtualized execution of application code. Eventually, the thoughtfully designed .NET Framework started filling up its niche. Matured over the years, the platform turned from a shy newcomer into a key player. If previously we mostly had to deal with far too many components written in COM/ATL/ActiveX (Do you remember dragging COM/ActiveX components onto icon forms in Borland C++ Builder?), now life became much easier. Today the corresponding technologies are <em>quite</em> rare to worry about and there is a chance to make them slightly uncomfortable so that people get rid of them and use state-of-the-art .NET Framework. We perceive old technologies that still exist and do well as archaic, forgotten, "faulty”, and old-fashioned. That’s why it is possible to make another step towards a closed sandbox: make it more impenetrable, more managed.</p>
<div class="paragraph-right-side">22</div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">23</div>
<p >
One of these steps is to introduce the notion of <code>Corrupted State Exceptions</code> which declares some exceptional situations illegitimate. Let’s see which exceptions are these and trace the history once again based on one of them – <code>AccessViolationException</code>:</p>
<div class="paragraph-right-side">23</div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">24</div>
<p >
<strong>Util.cpp file</strong> <a href="https://github.com/dotnet/coreclr/blob/479b1e654cd5a13bb1ce47288cf78776b858bced/src/utilcode/util.cpp#L3163-L3197">util.cpp</a></p>
<div class="paragraph-right-side">24</div>
</div>
<div class="lang-cpp editor-colors"><div style="color:Black;background-color:White;"><pre>
BOOL IsProcessCorruptedStateException(DWORD dwExceptionCode, BOOL fCheckForSO <span style="color:Green;">/*=TRUE*/</span>)
{
    <span style="color:Green;">// ...</span>

    <span style="color:Green;">// If we have been asked not to include SO in the CSE check</span>
    <span style="color:Green;">// and the code represent SO, then exit now.</span>
    <span style="color:Blue;">if</span> ((fCheckForSO == FALSE) &amp;&amp; (dwExceptionCode == STATUS_STACK_OVERFLOW))
    {
        <span style="color:Blue;">return</span> fIsCorruptedStateException;
    }

    <span style="color:Blue;">switch</span>(dwExceptionCode)
    {
        <span style="color:Blue;">case</span> STATUS_ACCESS_VIOLATION:
        <span style="color:Blue;">case</span> STATUS_STACK_OVERFLOW:
        <span style="color:Blue;">case</span> EXCEPTION_ILLEGAL_INSTRUCTION:
        <span style="color:Blue;">case</span> EXCEPTION_IN_PAGE_ERROR:
        <span style="color:Blue;">case</span> EXCEPTION_INVALID_DISPOSITION:
        <span style="color:Blue;">case</span> EXCEPTION_NONCONTINUABLE_EXCEPTION:
        <span style="color:Blue;">case</span> EXCEPTION_PRIV_INSTRUCTION:
        <span style="color:Blue;">case</span> STATUS_UNWIND_CONSOLIDATE:
            fIsCorruptedStateException = TRUE;
            <span style="color:Blue;">break</span>;
    }

    <span style="color:Blue;">return</span> fIsCorruptedStateException;
}
</pre></div>
</div>
<p >
Let’s look at the description of our exceptional situations:</p>
<div class="row">
<div class="offset-0 col-12">
<table>
<thead>
<tr>
<th>
<p >
Error code</p>
</th>
<th>
<p >
Description</p>
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<p >
STATUS_ACCESS_VIOLATION</p>
</td>
<td>
<p >
A quite frequent error when you try to work with a memory range without access rights. Though memory is linear in terms of a process, it’s not possible to work with its entire range. You can use only those "portions” allocated by an operating system or ranges that you have access rights to (there are ranges owned by an operating system exclusively or available for code execution, yet not for reading)</p>
</td>
</tr>
<tr>
<td>
<p >
STATUS_STACK_OVERFLOW</p>
</td>
<td>
<p >
Everybody knows this error: there is not enough memory on the thread stack to call another method</p>
</td>
</tr>
<tr>
<td>
<p >
EXCEPTION_ILLEGAL_INSTRUCTION</p>
</td>
<td>
<p >
Another code, read by a processor from a method body, wasn’t recognized as an instruction</p>
</td>
</tr>
<tr>
<td>
<p >
EXCEPTION_IN_PAGE_ERROR</p>
</td>
<td>
<p >
A thread attempted to work with a non-existing memory page</p>
</td>
</tr>
<tr>
<td>
<p >
EXCEPTION_INVALID_DISPOSITION</p>
</td>
<td>
<p >
An exception handling mechanism returned a wrong handler. Such an exception should never appear in programs written in high-level languages (e.g. С++)</p>
</td>
</tr>
<tr>
<td>
<p >
EXCEPTION_NONCONTINUABLE_EXCEPTION</p>
</td>
<td>
<p >
A thread attempted to continue the execution of a program after an exception prohibited the execution. This is not about <code>catch/fault/finally</code> blocks. It's rather about something like exception filters that allowed to fix an error (which caused an exception) and then tried to execute that code again</p>
</td>
</tr>
<tr>
<td>
<p >
EXCEPTION_PRIV_INSTRUCTION</p>
</td>
<td>
<p >
An attempt to execute a privileged instruction of a processor</p>
</td>
</tr>
<tr>
<td>
<p >
STATUS_UNWIND_CONSOLIDATE</p>
</td>
<td>
<p >
An exception connected with the stack unwind, which is beyond the scope of our discussion</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">25</div>
<p >
Note that only two of these exceptions are worth catching: <code>STATUS_ACCESS_VIOLATION</code> and <code>STATUS_STACK_OVERFLOW</code>. Other errors are exceptional even for exceptional situations. They are rather fatal errors and we can’t consider them. So, let’s discuss only these two errors in detail.</p>
<div class="paragraph-right-side">25</div>
</div>
<h4 id="accessviolationexception">AccessViolationException</h4>
<div class="paragraph-container">
<div class="paragraph-left-side">26</div>
<p >
This exception is bad news which you don’t want to get. But if you get it, it’s not clear what to do with it. <code>AccessViolationException</code> indicates that you &laquo;missed&raquo; a memory range allocated for an application and is thrown when you try to read from or write to a protected region of memory. The word "protected” rather denotes an attempt to work with a range of memory which hasn’t been allocated yet or which has been already cleared. Here I am not talking about a garbage collector that allocates and clears memory. It just assigns the chunks of allocated memory for your and its own needs. Memory has a layered structure in a way. First, there is the layer of memory management by a garbage collector. Next is the layer used by CoreCLR libraries to manage the allocation of memory which is followed by the layer used by OS to manage memory allocation from the pool of available fragments of linear address space. Thus, this exception appears when an application misses its memory range and attempts to work with a region which isn’t yet allocated or intended for this application. In this situation you don’t have many variants for analysis.</p>
<div class="paragraph-right-side">26</div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">27</div>
<p >
– If <code>StackTrace</code> goes deep into CLR, you are very unlucky, because it’s probably a core error. However, this almost never happens. You can bypass the error by updating the core version or act in another way.
– If <code>StackTrace</code> goes into the unsafe code of some library, you either got marshaling wrong or there is a serious error in the unsafe library. Check method arguments carefully: it’s possible that native method arguments have another bit size, another order or just another size. Check that structures are passed by value or by reference where appropriate.</p>
<div class="paragraph-right-side">27</div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">28</div>
<p >
To catch this exception at the moment you should show a JIT-compiler it’s really necessary. Otherwise, it won’t be caught and you will get a broken application. However, you should catch this exception only if you can handle it properly: it may indicate a leak of memory if it was allocated by an unsafe method between calling this method and throwing <code>AccessViolationException</code>. At this point, an application may still function but its work may be incorrect because if you catch an error of a method call you will definitely try to call this method again. In this case, nobody knows what may go wrong: you can’t know how the state of an application was violated previously. However, if you still want to catch this exception, pay attention to the table of possible options for doing this in different versions of .NET Framework:</p>
<div class="paragraph-right-side">28</div>
</div>
<div class="row">
<div class="offset-3 col-6">
<table>
<thead>
<tr>
<th>
<p >
.NET Framework version</p>
</th>
<th>
<p >
AccessViolationExeception</p>
</th>
</tr>
</thead>
<tbody>
<tr>
<td>
<p >
1.0</p>
</td>
<td>
<p >
NullReferenceException</p>
</td>
</tr>
<tr>
<td>
<p >
2.0, 3.5</p>
</td>
<td>
<p >
AccessViolation can be caught</p>
</td>
</tr>
<tr>
<td>
<p >
4.0+</p>
</td>
<td>
<p >
AccessViolation can be caught, but an adjustment is needed</p>
</td>
</tr>
<tr>
<td>
<p >
.NET Core</p>
</td>
<td>
<p >
AccessViolation <em>can’t</em> be caught</p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">29</div>
<p >
In other words, if you have a very old application, working under .NET Framework 1.0, <del>show it to me</del> you will get NRE which will be a sort of deception: you passed a pointer with a value greater than zero and got <code>NullReferenceException</code>. However, I think this behavior is justified: if you are in the world of managed code, you don’t want to learn the error types of unmanaged code, and NRE—which is essentially "a bad pointer to an object”  in the world of .NET—is suitable here. However, things are not that simple. Users needed this type of exception in real life and it was introduced in .NET Framework 2.0. For years this was an exception you can catch. Then, it lost this capability, but a special structure appeared that allowed activating the catch option. This sequence of the CLR team decisions at every stage looks justified. See it for yourself:</p>
<div class="paragraph-right-side">29</div>
</div>
<ul>
<li>
<p >
<code>1.0</code> Missing allocated memory ranges should be an exceptional situation because if an application works with an address it got it from some place. In the managed world this place is the <code>new</code> operator. In the unmanaged world, every piece of code can be the place for such an error. Though these two exceptions are opposed in terms of essence (NRE works with an uninitialized pointer and AVE works with an incorrectly initialized pointer), incorrectly initialized pointers don’t exist from the .NET ideology point of view. Both cases can be reduced to an incorrectly initialized pointer. So, let’s do it and throw <code>NullReferenceException</code> in both cases.</p>
</li>
<li>
<p >
<code>2.0</code> During the early stages of .NET Framework existence it turned out that there is more code which is inherited via COM libraries than native code: there is a huge code base of commercial components for networking, UI, DB, and other subsystems. It means that the possibility of getting <code>AccessViolationException</code> exactly is real: the wrong diagnostics of a problem can make it more expensive to catch. Therefore, <code>AccessViolationException</code> was introduced in .NET Framework.</p>
</li>
<li>
<p >
<code>4.0</code> .NET Framework took hold and squeezed low-level programming languages. The number of COM components decreased sharply: almost all major tasks are solved within the framework already and working with unsafe code is treated as something incorrect. In these conditions we can get back to the ideology, introduced in the framework from the very beginning: .NET is for .NET only. Unsafe code is not a norm but a least-evil state; therefore catching <code>AccessViolationException</code> contradicts the ideology of the “framework as a platform” notion, i.e. of a full-fledged simulated sandbox with its own rules. However, we still use this platform and have to catch this exception in many cases: we introduce a special catch mode only if a corresponding configuration is used.</p>
</li>
<li>
<p >
<code>.NET Core</code> The dream of the CLR team has come true: working with unsafe code beyond the law in .NET anymore, and therefore the existence of <code>AccessViolationException</code> is not legitimate even at the configuration level. .NET is mature enough to make its own rules. Now the existence of this exception in an application will crash it. That’s why any unsafe code, i.e. CLR itself, must be safe in terms of this exception. If it appears in an unsafe library, nobody will use it. It means that developers writing third-party components in unsafe languages should be careful and handle this exception on their side.</p>
</li>
</ul>
<div class="paragraph-container">
<div class="paragraph-left-side">30</div>
<p >
This is how we can follow up how .NET has become a platform using the example of one exception: from playing by imposed rules to establishing its own rules.</p>
<div class="paragraph-right-side">30</div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">31</div>
<p >
With all things said I should only show how to activate the handling of this exception in a particular method in <code>4.0+</code>. You should:</p>
<div class="paragraph-right-side">31</div>
</div>
<ul>
<li>
<p >
add the following code to the <code>configuration/runtime</code> section:  <code>&lt;legacyCorruptedStateExceptionsPolicy enabled=&quot;true|false&quot;/&gt;</code></p>
</li>
<li>
<p >
add two attributes for each method where it is <em>necessary</em> to handle <code>AccessViolationException</code>: <code>HandleProcessCorruptedStateExceptions</code> and <code>SecurityCritical</code>. These attributes allow activating the handling of Corrupted State Exceptions for <em>particular</em> methods only. This procedure is particularly appropriate as you should be sure that you want to handle these exceptions and should know where: sometimes it is more appropriate to bring an application down.</p>
</li>
</ul>
<div class="paragraph-container">
<div class="paragraph-left-side">32</div>
<p >
Let’s look at the following code to see the activating of the <code>CSE</code> handler and the example of a trivial handling:</p>
<div class="paragraph-right-side">32</div>
</div>
<div class="lang-csharp editor-colors"><div style="color:Black;background-color:White;"><pre>
[HandleProcessCorruptedStateExceptions, SecurityCritical]
<span style="color:Blue;">public</span> <span style="color:Blue;">bool</span> TryCallNativeApi()
{
    <span style="color:Blue;">try</span>
    {
        <span style="color:Green;">// Activating a method which can throw AccessViolationException</span>
    }
    <span style="color:Blue;">catch</span> (Exception e)
    {
        <span style="color:Green;">// Logging, exit</span>
        System.Console.WriteLine(e.Message);
        <span style="color:Blue;">return</span> <span style="color:Blue;">false</span>;
    }

  <span style="color:Blue;">return</span> <span style="color:Blue;">true</span>;
}
</pre></div>
</div>
<h4 id="stackoverflowexception">StackOverflowException</h4>
<div class="paragraph-container">
<div class="paragraph-left-side">33</div>
<p >
It is the last type of exception we should talk about. It appears when a memory array allocated for the stack runs out. We already discussed the structure of the stack in the corresponding chapter (<a href="./ThreadStack.html">Thread stack</a>). So, here we will discuss only the error itself.</p>
<div class="paragraph-right-side">33</div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">34</div>
<p >
When there is not enough memory for the thread stack (or the next memory range is occupied and we can’t allocate the next page of virtual memory) or a thread used the allowed memory range, there is an attempt to access the address space which is called Guard page. This range is actually a trap and doesn’t take any physical memory. Instead of real writing or reading, a processor calls a special abort which should request a new memory range from an OS to accommodate the growth of the stack. If the absolute maximum value is reached the OS generates <code>STATUS_STACK_OVERFLOW</code> exception instead of allocating a new range. This exception, forwarded in .NET via the <code>Structured Exception Handling</code> mechanism, destroys the current thread as inconsistent.</p>
<div class="paragraph-right-side">34</div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">35</div>
<p >
Note that although this exception is <code>Corrupted State Exception</code>, you can’t catch it with <code>HandleProcessCorruptedStateExceptions</code>. I mean the following code won’t work:</p>
<div class="paragraph-right-side">35</div>
</div>
<div class="lang-csharp editor-colors"><div style="color:Black;background-color:White;"><pre>
<span style="color:Green;">// Main.cs</span>
[HandleProcessCorruptedStateExceptions, SecurityCritical]
<span style="color:Blue;">static</span> <span style="color:Blue;">void</span> Main()
{
    <span style="color:Blue;">try</span>
    {
        Recursive();
    } <span style="color:Blue;">catch</span> (Exception exception)
    {
        Console.WriteLine(<span style="color:#A31515;">&quot;Catched Stack Overflow!&quot;</span>);
    }
}

<span style="color:Blue;">static</span> <span style="color:Blue;">void</span> Recursive()
{
    Recursive();
}

<span style="color:Green;">// app.config:</span>
&lt;configuration&gt;
  &lt;runtime&gt;
    &lt;legacyCorruptedStateExceptionsPolicy enabled=<span style="color:#A31515;">&quot;true&quot;</span>/&gt;
  &lt;/runtime&gt;
&lt;/configuration&gt;
</pre></div>
</div>
<div class="paragraph-container">
<div class="paragraph-left-side">36</div>
<p >
You can’t catch this exception because stack overflow can be caused by two reasons. The first is an intentional call of a recursive method which doesn’t control its own depth carefully. Here you may want to fix the situation by catching the exception. However, we therefore legalize this situation and allow it to happen again which means we are short-sighted, rather than careful. The second reason is accidental when <code>StackOverflowException</code> appears during a usual call. Just the depth of the stack at that moment was too critical. In this case, catching exceptions looks like something inappropriate at all: an application worked normally, everything was good and suddenly the legal call of a method with algorithms working correctly caused an exception, followed by unwinding stack up to the section of code that expects such behavior. Well&hellip; Once again: we expect that nothing will run in the next section as the stack will be out of memory. I think this is absurd.</p>
<div class="paragraph-right-side">36</div>
</div>

        </div>
    </div>
    <footer>
        <div class="book-container footer-container">
            <div class="footer-wrap">
                <img src="../../res/img/logo-w-noindex.svg">
                <p>
                    <a class="footer-link" target="_blank" href="mailto:sidristij@clrium.ru"><i class="far fa-envelope" aria-hidden="true"></i></a>
                    <a class="footer-link" target="_blank" href="https://vk.com/clrium"><i class="fab fa-vk" aria-hidden="true"></i></a>
                    <a class="footer-link" target="_blank" href="https://youtube.com/clrium"><i class="fab fa-youtube" aria-hidden="true"></i></a>
                    <a class="footer-link" target="_blank" href="https://github.com/clrium"><i class="fab fa-github" aria-hidden="true"></i></a>
                    <a class="footer-link" target="_blank" href="skype:stanislav.sidristyi"><i class="fab fa-skype" aria-hidden="true"></i></a>
                    <a class="footer-link" target="_blank" href="https://t.me/clrium_group"><i class="fab fa-telegram" aria-hidden="true"></i></a>
                </p>
            </div>
        </div>
    </footer>
</body>
</html>